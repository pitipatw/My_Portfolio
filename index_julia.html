<html>
    <head>
    </head>
    <body>
    
<div>
  <div class="bonito-fragment" id="593dcec5-008e-4923-9993-30795387107d" data-jscall-id="root">
    <div>
      <script src="data:application/javascript;base64,Ly8gZGVuby1mbXQtaWdub3JlLWZpbGUKLy8gZGVuby1saW50LWlnbm9yZS1maWxlCi8vIFRoaXMgY29kZSB3YXMgYnVuZGxlZCB1c2luZyBgZGVubyBidW5kbGVgIGFuZCBpdCdzIG5vdCByZWNvbW1lbmRlZCB0byBlZGl0IGl0IG1hbnVhbGx5CgpmdW5jdGlvbiB1dGY4Q291bnQoc3RyKSB7CiAgICB2YXIgc3RyTGVuZ3RoID0gc3RyLmxlbmd0aDsKICAgIHZhciBieXRlTGVuZ3RoID0gMDsKICAgIHZhciBwb3MgPSAwOwogICAgd2hpbGUocG9zIDwgc3RyTGVuZ3RoKXsKICAgICAgICB2YXIgdmFsdWUgPSBzdHIuY2hhckNvZGVBdChwb3MrKyk7CiAgICAgICAgaWYgKCh2YWx1ZSAmIDB4ZmZmZmZmODApID09PSAwKSB7CiAgICAgICAgICAgIGJ5dGVMZW5ndGgrKzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfSBlbHNlIGlmICgodmFsdWUgJiAweGZmZmZmODAwKSA9PT0gMCkgewogICAgICAgICAgICBieXRlTGVuZ3RoICs9IDI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHZhbHVlID49IDB4ZDgwMCAmJiB2YWx1ZSA8PSAweGRiZmYpIHsKICAgICAgICAgICAgICAgIGlmIChwb3MgPCBzdHJMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZXh0cmEgPSBzdHIuY2hhckNvZGVBdChwb3MpOwogICAgICAgICAgICAgICAgICAgIGlmICgoZXh0cmEgJiAweGZjMDApID09PSAweGRjMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgKytwb3M7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gKCh2YWx1ZSAmIDB4M2ZmKSA8PCAxMCkgKyAoZXh0cmEgJiAweDNmZikgKyAweDEwMDAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKHZhbHVlICYgMHhmZmZmMDAwMCkgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ5dGVMZW5ndGggKz0gMzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJ5dGVMZW5ndGggKz0gNDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBieXRlTGVuZ3RoOwp9CmZ1bmN0aW9uIHV0ZjhFbmNvZGVKcyhzdHIsIG91dHB1dCwgb3V0cHV0T2Zmc2V0KSB7CiAgICB2YXIgc3RyTGVuZ3RoID0gc3RyLmxlbmd0aDsKICAgIHZhciBvZmZzZXQgPSBvdXRwdXRPZmZzZXQ7CiAgICB2YXIgcG9zID0gMDsKICAgIHdoaWxlKHBvcyA8IHN0ckxlbmd0aCl7CiAgICAgICAgdmFyIHZhbHVlID0gc3RyLmNoYXJDb2RlQXQocG9zKyspOwogICAgICAgIGlmICgodmFsdWUgJiAweGZmZmZmZjgwKSA9PT0gMCkgewogICAgICAgICAgICBvdXRwdXRbb2Zmc2V0KytdID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSBpZiAoKHZhbHVlICYgMHhmZmZmZjgwMCkgPT09IDApIHsKICAgICAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlID4+IDYgJiAweDFmIHwgMHhjMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodmFsdWUgPj0gMHhkODAwICYmIHZhbHVlIDw9IDB4ZGJmZikgewogICAgICAgICAgICAgICAgaWYgKHBvcyA8IHN0ckxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHZhciBleHRyYSA9IHN0ci5jaGFyQ29kZUF0KHBvcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChleHRyYSAmIDB4ZmMwMCkgPT09IDB4ZGMwMCkgewogICAgICAgICAgICAgICAgICAgICAgICArK3BvczsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAoKHZhbHVlICYgMHgzZmYpIDw8IDEwKSArIChleHRyYSAmIDB4M2ZmKSArIDB4MTAwMDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgodmFsdWUgJiAweGZmZmYwMDAwKSA9PT0gMCkgewogICAgICAgICAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlID4+IDEyICYgMHgwZiB8IDB4ZTA7CiAgICAgICAgICAgICAgICBvdXRwdXRbb2Zmc2V0KytdID0gdmFsdWUgPj4gNiAmIDB4M2YgfCAweDgwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlID4+IDE4ICYgMHgwNyB8IDB4ZjA7CiAgICAgICAgICAgICAgICBvdXRwdXRbb2Zmc2V0KytdID0gdmFsdWUgPj4gMTIgJiAweDNmIHwgMHg4MDsKICAgICAgICAgICAgICAgIG91dHB1dFtvZmZzZXQrK10gPSB2YWx1ZSA+PiA2ICYgMHgzZiB8IDB4ODA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlICYgMHgzZiB8IDB4ODA7CiAgICB9Cn0KdmFyIHNoYXJlZFRleHRFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7CnZhciBURVhUX0VOQ09ERVJfVEhSRVNIT0xEID0gNTA7CmZ1bmN0aW9uIHV0ZjhFbmNvZGVURShzdHIsIG91dHB1dCwgb3V0cHV0T2Zmc2V0KSB7CiAgICBzaGFyZWRUZXh0RW5jb2Rlci5lbmNvZGVJbnRvKHN0ciwgb3V0cHV0LnN1YmFycmF5KG91dHB1dE9mZnNldCkpOwp9CmZ1bmN0aW9uIHV0ZjhFbmNvZGUoc3RyLCBvdXRwdXQsIG91dHB1dE9mZnNldCkgewogICAgaWYgKHN0ci5sZW5ndGggPiBURVhUX0VOQ09ERVJfVEhSRVNIT0xEKSB7CiAgICAgICAgdXRmOEVuY29kZVRFKHN0ciwgb3V0cHV0LCBvdXRwdXRPZmZzZXQpOwogICAgfSBlbHNlIHsKICAgICAgICB1dGY4RW5jb2RlSnMoc3RyLCBvdXRwdXQsIG91dHB1dE9mZnNldCk7CiAgICB9Cn0KdmFyIENIVU5LX1NJWkUgPSA0MDk2OwpmdW5jdGlvbiB1dGY4RGVjb2RlSnMoYnl0ZXMsIGlucHV0T2Zmc2V0LCBieXRlTGVuZ3RoKSB7CiAgICB2YXIgb2Zmc2V0ID0gaW5wdXRPZmZzZXQ7CiAgICB2YXIgZW5kID0gb2Zmc2V0ICsgYnl0ZUxlbmd0aDsKICAgIHZhciB1bml0cyA9IFtdOwogICAgdmFyIHJlc3VsdCA9ICIiOwogICAgd2hpbGUob2Zmc2V0IDwgZW5kKXsKICAgICAgICB2YXIgYnl0ZTEgPSBieXRlc1tvZmZzZXQrK107CiAgICAgICAgaWYgKChieXRlMSAmIDB4ODApID09PSAwKSB7CiAgICAgICAgICAgIHVuaXRzLnB1c2goYnl0ZTEpOwogICAgICAgIH0gZWxzZSBpZiAoKGJ5dGUxICYgMHhlMCkgPT09IDB4YzApIHsKICAgICAgICAgICAgdmFyIGJ5dGUyID0gYnl0ZXNbb2Zmc2V0KytdICYgMHgzZjsKICAgICAgICAgICAgdW5pdHMucHVzaCgoYnl0ZTEgJiAweDFmKSA8PCA2IHwgYnl0ZTIpOwogICAgICAgIH0gZWxzZSBpZiAoKGJ5dGUxICYgMHhmMCkgPT09IDB4ZTApIHsKICAgICAgICAgICAgdmFyIGJ5dGUyID0gYnl0ZXNbb2Zmc2V0KytdICYgMHgzZjsKICAgICAgICAgICAgdmFyIGJ5dGUzID0gYnl0ZXNbb2Zmc2V0KytdICYgMHgzZjsKICAgICAgICAgICAgdW5pdHMucHVzaCgoYnl0ZTEgJiAweDFmKSA8PCAxMiB8IGJ5dGUyIDw8IDYgfCBieXRlMyk7CiAgICAgICAgfSBlbHNlIGlmICgoYnl0ZTEgJiAweGY4KSA9PT0gMHhmMCkgewogICAgICAgICAgICB2YXIgYnl0ZTIgPSBieXRlc1tvZmZzZXQrK10gJiAweDNmOwogICAgICAgICAgICB2YXIgYnl0ZTMgPSBieXRlc1tvZmZzZXQrK10gJiAweDNmOwogICAgICAgICAgICB2YXIgYnl0ZTQgPSBieXRlc1tvZmZzZXQrK10gJiAweDNmOwogICAgICAgICAgICB2YXIgdW5pdCA9IChieXRlMSAmIDB4MDcpIDw8IDB4MTIgfCBieXRlMiA8PCAweDBjIHwgYnl0ZTMgPDwgMHgwNiB8IGJ5dGU0OwogICAgICAgICAgICBpZiAodW5pdCA+IDB4ZmZmZikgewogICAgICAgICAgICAgICAgdW5pdCAtPSAweDEwMDAwOwogICAgICAgICAgICAgICAgdW5pdHMucHVzaCh1bml0ID4+PiAxMCAmIDB4M2ZmIHwgMHhkODAwKTsKICAgICAgICAgICAgICAgIHVuaXQgPSAweGRjMDAgfCB1bml0ICYgMHgzZmY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdW5pdHMucHVzaCh1bml0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1bml0cy5wdXNoKGJ5dGUxKTsKICAgICAgICB9CiAgICAgICAgaWYgKHVuaXRzLmxlbmd0aCA+PSBDSFVOS19TSVpFKSB7CiAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgdW5pdHMpOwogICAgICAgICAgICB1bml0cy5sZW5ndGggPSAwOwogICAgICAgIH0KICAgIH0KICAgIGlmICh1bml0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCB1bml0cyk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0Owp9CnZhciBzaGFyZWRUZXh0RGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOwp2YXIgVEVYVF9ERUNPREVSX1RIUkVTSE9MRCA9IDIwMDsKZnVuY3Rpb24gdXRmOERlY29kZVREKGJ5dGVzLCBpbnB1dE9mZnNldCwgYnl0ZUxlbmd0aCkgewogICAgdmFyIHN0cmluZ0J5dGVzID0gYnl0ZXMuc3ViYXJyYXkoaW5wdXRPZmZzZXQsIGlucHV0T2Zmc2V0ICsgYnl0ZUxlbmd0aCk7CiAgICByZXR1cm4gc2hhcmVkVGV4dERlY29kZXIuZGVjb2RlKHN0cmluZ0J5dGVzKTsKfQpmdW5jdGlvbiB1dGY4RGVjb2RlKGJ5dGVzLCBpbnB1dE9mZnNldCwgYnl0ZUxlbmd0aCkgewogICAgaWYgKGJ5dGVMZW5ndGggPiBURVhUX0RFQ09ERVJfVEhSRVNIT0xEKSB7CiAgICAgICAgcmV0dXJuIHV0ZjhEZWNvZGVURChieXRlcywgaW5wdXRPZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdXRmOERlY29kZUpzKGJ5dGVzLCBpbnB1dE9mZnNldCwgYnl0ZUxlbmd0aCk7CiAgICB9Cn0KdmFyIEV4dERhdGEgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEV4dERhdGEodHlwZSwgZGF0YSkgewogICAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIH0KICAgIHJldHVybiBFeHREYXRhOwp9KCk7CnZhciBfX2V4dGVuZHMgPSB0aGlzICYmIHRoaXMuX19leHRlbmRzIHx8IGZ1bmN0aW9uKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7CiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoewogICAgICAgICAgICBfX3Byb3RvX186IFtdCiAgICAgICAgfSkgaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbihkLCBiKSB7CiAgICAgICAgICAgIGQuX19wcm90b19fID0gYjsKICAgICAgICB9IHx8IGZ1bmN0aW9uKGQsIGIpIHsKICAgICAgICAgICAgZm9yKHZhciBwIGluIGIpaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24oZCwgYikgewogICAgICAgIGlmICh0eXBlb2YgYiAhPT0gImZ1bmN0aW9uIiAmJiBiICE9PSBudWxsKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDbGFzcyBleHRlbmRzIHZhbHVlICIgKyBTdHJpbmcoYikgKyAiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGwiKTsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgewogICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gZDsKICAgICAgICB9CiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwogICAgfTsKfSgpOwp2YXIgRGVjb2RlRXJyb3IgPSBmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhEZWNvZGVFcnJvciwgX3N1cGVyKTsKICAgIGZ1bmN0aW9uIERlY29kZUVycm9yKG1lc3NhZ2UpIHsKICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwogICAgICAgIHZhciBwcm90byA9IE9iamVjdC5jcmVhdGUoRGVjb2RlRXJyb3IucHJvdG90eXBlKTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoX3RoaXMsIHByb3RvKTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX3RoaXMsICJuYW1lIiwgewogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZTogRGVjb2RlRXJyb3IubmFtZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIHJldHVybiBEZWNvZGVFcnJvcjsKfShFcnJvcik7CnZhciBVSU5UMzJfTUFYID0gNDI5NDk2NzI5NTsKZnVuY3Rpb24gc2V0VWludDY0KHZpZXcsIG9mZnNldCwgdmFsdWUpIHsKICAgIHZhciBoaWdoID0gdmFsdWUgLyA0Mjk0OTY3Mjk2OwogICAgdmFyIGxvdyA9IHZhbHVlOwogICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBoaWdoKTsKICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCArIDQsIGxvdyk7Cn0KZnVuY3Rpb24gc2V0SW50NjQodmlldywgb2Zmc2V0LCB2YWx1ZSkgewogICAgdmFyIGhpZ2ggPSBNYXRoLmZsb29yKHZhbHVlIC8gNDI5NDk2NzI5Nik7CiAgICB2YXIgbG93ID0gdmFsdWU7CiAgICB2aWV3LnNldFVpbnQzMihvZmZzZXQsIGhpZ2gpOwogICAgdmlldy5zZXRVaW50MzIob2Zmc2V0ICsgNCwgbG93KTsKfQpmdW5jdGlvbiBnZXRJbnQ2NCh2aWV3LCBvZmZzZXQpIHsKICAgIHZhciBoaWdoID0gdmlldy5nZXRJbnQzMihvZmZzZXQpOwogICAgdmFyIGxvdyA9IHZpZXcuZ2V0VWludDMyKG9mZnNldCArIDQpOwogICAgcmV0dXJuIGhpZ2ggKiA0Mjk0OTY3Mjk2ICsgbG93Owp9CmZ1bmN0aW9uIGdldFVpbnQ2NCh2aWV3LCBvZmZzZXQpIHsKICAgIHZhciBoaWdoID0gdmlldy5nZXRVaW50MzIob2Zmc2V0KTsKICAgIHZhciBsb3cgPSB2aWV3LmdldFVpbnQzMihvZmZzZXQgKyA0KTsKICAgIHJldHVybiBoaWdoICogNDI5NDk2NzI5NiArIGxvdzsKfQp2YXIgRVhUX1RJTUVTVEFNUCA9IC0xOwp2YXIgVElNRVNUQU1QMzJfTUFYX1NFQyA9IDB4MTAwMDAwMDAwIC0gMTsKdmFyIFRJTUVTVEFNUDY0X01BWF9TRUMgPSAweDQwMDAwMDAwMCAtIDE7CmZ1bmN0aW9uIGVuY29kZVRpbWVTcGVjVG9UaW1lc3RhbXAoX2EpIHsKICAgIHZhciBzZWMgPSBfYS5zZWMsIG5zZWMgPSBfYS5uc2VjOwogICAgaWYgKHNlYyA+PSAwICYmIG5zZWMgPj0gMCAmJiBzZWMgPD0gVElNRVNUQU1QNjRfTUFYX1NFQykgewogICAgICAgIGlmIChuc2VjID09PSAwICYmIHNlYyA8PSBUSU1FU1RBTVAzMl9NQVhfU0VDKSB7CiAgICAgICAgICAgIHZhciBydiA9IG5ldyBVaW50OEFycmF5KDQpOwogICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhydi5idWZmZXIpOwogICAgICAgICAgICB2aWV3LnNldFVpbnQzMigwLCBzZWMpOwogICAgICAgICAgICByZXR1cm4gcnY7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHNlY0hpZ2ggPSBzZWMgLyAweDEwMDAwMDAwMDsKICAgICAgICAgICAgdmFyIHNlY0xvdyA9IHNlYyAmIDB4ZmZmZmZmZmY7CiAgICAgICAgICAgIHZhciBydiA9IG5ldyBVaW50OEFycmF5KDgpOwogICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhydi5idWZmZXIpOwogICAgICAgICAgICB2aWV3LnNldFVpbnQzMigwLCBuc2VjIDw8IDIgfCBzZWNIaWdoICYgMHgzKTsKICAgICAgICAgICAgdmlldy5zZXRVaW50MzIoNCwgc2VjTG93KTsKICAgICAgICAgICAgcmV0dXJuIHJ2OwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJ2ID0gbmV3IFVpbnQ4QXJyYXkoMTIpOwogICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KHJ2LmJ1ZmZlcik7CiAgICAgICAgdmlldy5zZXRVaW50MzIoMCwgbnNlYyk7CiAgICAgICAgc2V0SW50NjQodmlldywgNCwgc2VjKTsKICAgICAgICByZXR1cm4gcnY7CiAgICB9Cn0KZnVuY3Rpb24gZW5jb2RlRGF0ZVRvVGltZVNwZWMoZGF0ZSkgewogICAgdmFyIG1zZWMgPSBkYXRlLmdldFRpbWUoKTsKICAgIHZhciBzZWMgPSBNYXRoLmZsb29yKG1zZWMgLyAxZTMpOwogICAgdmFyIG5zZWMgPSAobXNlYyAtIHNlYyAqIDFlMykgKiAxZTY7CiAgICB2YXIgbnNlY0luU2VjID0gTWF0aC5mbG9vcihuc2VjIC8gMWU5KTsKICAgIHJldHVybiB7CiAgICAgICAgc2VjOiBzZWMgKyBuc2VjSW5TZWMsCiAgICAgICAgbnNlYzogbnNlYyAtIG5zZWNJblNlYyAqIDFlOQogICAgfTsKfQpmdW5jdGlvbiBlbmNvZGVUaW1lc3RhbXBFeHRlbnNpb24ob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgIHZhciB0aW1lU3BlYyA9IGVuY29kZURhdGVUb1RpbWVTcGVjKG9iamVjdCk7CiAgICAgICAgcmV0dXJuIGVuY29kZVRpbWVTcGVjVG9UaW1lc3RhbXAodGltZVNwZWMpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KfQpmdW5jdGlvbiBkZWNvZGVUaW1lc3RhbXBUb1RpbWVTcGVjKGRhdGEpIHsKICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGRhdGEuYnVmZmVyLCBkYXRhLmJ5dGVPZmZzZXQsIGRhdGEuYnl0ZUxlbmd0aCk7CiAgICBzd2l0Y2goZGF0YS5ieXRlTGVuZ3RoKXsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBzZWMgPSB2aWV3LmdldFVpbnQzMigwKTsKICAgICAgICAgICAgICAgIHZhciBuc2VjID0gMDsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgc2VjOiBzZWMsCiAgICAgICAgICAgICAgICAgICAgbnNlYzogbnNlYwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgODoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIG5zZWMzMEFuZFNlY0hpZ2gyID0gdmlldy5nZXRVaW50MzIoMCk7CiAgICAgICAgICAgICAgICB2YXIgc2VjTG93MzIgPSB2aWV3LmdldFVpbnQzMig0KTsKICAgICAgICAgICAgICAgIHZhciBzZWMgPSAobnNlYzMwQW5kU2VjSGlnaDIgJiAweDMpICogMHgxMDAwMDAwMDAgKyBzZWNMb3czMjsKICAgICAgICAgICAgICAgIHZhciBuc2VjID0gbnNlYzMwQW5kU2VjSGlnaDIgPj4+IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHNlYzogc2VjLAogICAgICAgICAgICAgICAgICAgIG5zZWM6IG5zZWMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgc2VjID0gZ2V0SW50NjQodmlldywgNCk7CiAgICAgICAgICAgICAgICB2YXIgbnNlYyA9IHZpZXcuZ2V0VWludDMyKDApOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBzZWM6IHNlYywKICAgICAgICAgICAgICAgICAgICBuc2VjOiBuc2VjCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IERlY29kZUVycm9yKCJVbnJlY29nbml6ZWQgZGF0YSBzaXplIGZvciB0aW1lc3RhbXAgKGV4cGVjdGVkIDQsIDgsIG9yIDEyKTogIi5jb25jYXQoZGF0YS5sZW5ndGgpKTsKICAgIH0KfQpmdW5jdGlvbiBkZWNvZGVUaW1lc3RhbXBFeHRlbnNpb24oZGF0YSkgewogICAgdmFyIHRpbWVTcGVjID0gZGVjb2RlVGltZXN0YW1wVG9UaW1lU3BlYyhkYXRhKTsKICAgIHJldHVybiBuZXcgRGF0ZSh0aW1lU3BlYy5zZWMgKiAxZTMgKyB0aW1lU3BlYy5uc2VjIC8gMWU2KTsKfQp2YXIgdGltZXN0YW1wRXh0ZW5zaW9uID0gewogICAgdHlwZTogRVhUX1RJTUVTVEFNUCwKICAgIGVuY29kZTogZW5jb2RlVGltZXN0YW1wRXh0ZW5zaW9uLAogICAgZGVjb2RlOiBkZWNvZGVUaW1lc3RhbXBFeHRlbnNpb24KfTsKdmFyIEV4dGVuc2lvbkNvZGVjID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBFeHRlbnNpb25Db2RlYygpIHsKICAgICAgICB0aGlzLmJ1aWx0SW5FbmNvZGVycyA9IFtdOwogICAgICAgIHRoaXMuYnVpbHRJbkRlY29kZXJzID0gW107CiAgICAgICAgdGhpcy5lbmNvZGVycyA9IFtdOwogICAgICAgIHRoaXMuZGVjb2RlcnMgPSBbXTsKICAgICAgICB0aGlzLnJlZ2lzdGVyKHRpbWVzdGFtcEV4dGVuc2lvbik7CiAgICB9CiAgICBFeHRlbnNpb25Db2RlYy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbihfYSkgewogICAgICAgIHZhciB0eXBlID0gX2EudHlwZSwgZW5jb2RlID0gX2EuZW5jb2RlLCBkZWNvZGUgPSBfYS5kZWNvZGU7CiAgICAgICAgaWYgKHR5cGUgPj0gMCkgewogICAgICAgICAgICB0aGlzLmVuY29kZXJzW3R5cGVdID0gZW5jb2RlOwogICAgICAgICAgICB0aGlzLmRlY29kZXJzW3R5cGVdID0gZGVjb2RlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBpbmRleCA9IDEgKyB0eXBlOwogICAgICAgICAgICB0aGlzLmJ1aWx0SW5FbmNvZGVyc1tpbmRleF0gPSBlbmNvZGU7CiAgICAgICAgICAgIHRoaXMuYnVpbHRJbkRlY29kZXJzW2luZGV4XSA9IGRlY29kZTsKICAgICAgICB9CiAgICB9OwogICAgRXh0ZW5zaW9uQ29kZWMucHJvdG90eXBlLnRyeVRvRW5jb2RlID0gZnVuY3Rpb24ob2JqZWN0LCBjb250ZXh0KSB7CiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuYnVpbHRJbkVuY29kZXJzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgdmFyIGVuY29kZUV4dCA9IHRoaXMuYnVpbHRJbkVuY29kZXJzW2ldOwogICAgICAgICAgICBpZiAoZW5jb2RlRXh0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gZW5jb2RlRXh0KG9iamVjdCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSAtMSAtIGk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHREYXRhKHR5cGUsIGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmVuY29kZXJzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgdmFyIGVuY29kZUV4dCA9IHRoaXMuZW5jb2RlcnNbaV07CiAgICAgICAgICAgIGlmIChlbmNvZGVFeHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBlbmNvZGVFeHQob2JqZWN0LCBjb250ZXh0KTsKICAgICAgICAgICAgICAgIGlmIChkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHREYXRhKHR5cGUsIGRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBFeHREYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIEV4dGVuc2lvbkNvZGVjLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbihkYXRhLCB0eXBlLCBjb250ZXh0KSB7CiAgICAgICAgdmFyIGRlY29kZUV4dCA9IHR5cGUgPCAwID8gdGhpcy5idWlsdEluRGVjb2RlcnNbLTEgLSB0eXBlXSA6IHRoaXMuZGVjb2RlcnNbdHlwZV07CiAgICAgICAgaWYgKGRlY29kZUV4dCkgewogICAgICAgICAgICByZXR1cm4gZGVjb2RlRXh0KGRhdGEsIHR5cGUsIGNvbnRleHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRXh0RGF0YSh0eXBlLCBkYXRhKTsKICAgICAgICB9CiAgICB9OwogICAgRXh0ZW5zaW9uQ29kZWMuZGVmYXVsdENvZGVjID0gbmV3IEV4dGVuc2lvbkNvZGVjKCk7CiAgICByZXR1cm4gRXh0ZW5zaW9uQ29kZWM7Cn0oKTsKZnVuY3Rpb24gZW5zdXJlVWludDhBcnJheShidWZmZXIpIHsKICAgIGlmIChidWZmZXIgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7CiAgICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgIH0gZWxzZSBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KGJ1ZmZlcikpIHsKICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyLmJ1ZmZlciwgYnVmZmVyLmJ5dGVPZmZzZXQsIGJ1ZmZlci5ieXRlTGVuZ3RoKTsKICAgIH0gZWxzZSBpZiAoYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkuZnJvbShidWZmZXIpOwogICAgfQp9CmZ1bmN0aW9uIGNyZWF0ZURhdGFWaWV3KGJ1ZmZlcikgewogICAgaWYgKGJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRhVmlldyhidWZmZXIpOwogICAgfQogICAgdmFyIGJ1ZmZlclZpZXcgPSBlbnN1cmVVaW50OEFycmF5KGJ1ZmZlcik7CiAgICByZXR1cm4gbmV3IERhdGFWaWV3KGJ1ZmZlclZpZXcuYnVmZmVyLCBidWZmZXJWaWV3LmJ5dGVPZmZzZXQsIGJ1ZmZlclZpZXcuYnl0ZUxlbmd0aCk7Cn0KdmFyIERFRkFVTFRfTUFYX0RFUFRIID0gMTAwOwp2YXIgREVGQVVMVF9JTklUSUFMX0JVRkZFUl9TSVpFID0gMjA0ODsKdmFyIEVuY29kZXIgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEVuY29kZXIob3B0aW9ucykgewogICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2g7CiAgICAgICAgdGhpcy5leHRlbnNpb25Db2RlYyA9IChfYSA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5leHRlbnNpb25Db2RlYykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogRXh0ZW5zaW9uQ29kZWMuZGVmYXVsdENvZGVjOwogICAgICAgIHRoaXMuY29udGV4dCA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5jb250ZXh0OwogICAgICAgIHRoaXMudXNlQmlnSW50NjQgPSAoX2IgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMudXNlQmlnSW50NjQpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IGZhbHNlOwogICAgICAgIHRoaXMubWF4RGVwdGggPSAoX2MgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMubWF4RGVwdGgpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IERFRkFVTFRfTUFYX0RFUFRIOwogICAgICAgIHRoaXMuaW5pdGlhbEJ1ZmZlclNpemUgPSAoX2QgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuaW5pdGlhbEJ1ZmZlclNpemUpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IERFRkFVTFRfSU5JVElBTF9CVUZGRVJfU0laRTsKICAgICAgICB0aGlzLnNvcnRLZXlzID0gKF9lID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnNvcnRLZXlzKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiBmYWxzZTsKICAgICAgICB0aGlzLmZvcmNlRmxvYXQzMiA9IChfZiA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5mb3JjZUZsb2F0MzIpICE9PSBudWxsICYmIF9mICE9PSB2b2lkIDAgPyBfZiA6IGZhbHNlOwogICAgICAgIHRoaXMuaWdub3JlVW5kZWZpbmVkID0gKF9nID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmlnbm9yZVVuZGVmaW5lZCkgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogZmFsc2U7CiAgICAgICAgdGhpcy5mb3JjZUludGVnZXJUb0Zsb2F0ID0gKF9oID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmZvcmNlSW50ZWdlclRvRmxvYXQpICE9PSBudWxsICYmIF9oICE9PSB2b2lkIDAgPyBfaCA6IGZhbHNlOwogICAgICAgIHRoaXMucG9zID0gMDsKICAgICAgICB0aGlzLnZpZXcgPSBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKHRoaXMuaW5pdGlhbEJ1ZmZlclNpemUpKTsKICAgICAgICB0aGlzLmJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodGhpcy52aWV3LmJ1ZmZlcik7CiAgICB9CiAgICBFbmNvZGVyLnByb3RvdHlwZS5yZWluaXRpYWxpemVTdGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMucG9zID0gMDsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGVTaGFyZWRSZWYgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCk7CiAgICAgICAgdGhpcy5kb0VuY29kZShvYmplY3QsIDEpOwogICAgICAgIHJldHVybiB0aGlzLmJ5dGVzLnN1YmFycmF5KDAsIHRoaXMucG9zKTsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGUgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCk7CiAgICAgICAgdGhpcy5kb0VuY29kZShvYmplY3QsIDEpOwogICAgICAgIHJldHVybiB0aGlzLmJ5dGVzLnNsaWNlKDAsIHRoaXMucG9zKTsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5kb0VuY29kZSA9IGZ1bmN0aW9uKG9iamVjdCwgZGVwdGgpIHsKICAgICAgICBpZiAoZGVwdGggPiB0aGlzLm1heERlcHRoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9vIGRlZXAgb2JqZWN0cyBpbiBkZXB0aCAiLmNvbmNhdChkZXB0aCkpOwogICAgICAgIH0KICAgICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5lbmNvZGVOaWwoKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmplY3QgPT09ICJib29sZWFuIikgewogICAgICAgICAgICB0aGlzLmVuY29kZUJvb2xlYW4ob2JqZWN0KTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmplY3QgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5mb3JjZUludGVnZXJUb0Zsb2F0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmVuY29kZU51bWJlcihvYmplY3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5lbmNvZGVOdW1iZXJBc0Zsb2F0KG9iamVjdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmplY3QgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlU3RyaW5nKG9iamVjdCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZUJpZ0ludDY0ICYmIHR5cGVvZiBvYmplY3QgPT09ICJiaWdpbnQiKSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlQmlnSW50NjQob2JqZWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmVuY29kZU9iamVjdChvYmplY3QsIGRlcHRoKTsKICAgICAgICB9CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUgPSBmdW5jdGlvbihzaXplVG9Xcml0ZSkgewogICAgICAgIHZhciByZXF1aXJlZFNpemUgPSB0aGlzLnBvcyArIHNpemVUb1dyaXRlOwogICAgICAgIGlmICh0aGlzLnZpZXcuYnl0ZUxlbmd0aCA8IHJlcXVpcmVkU2l6ZSkgewogICAgICAgICAgICB0aGlzLnJlc2l6ZUJ1ZmZlcihyZXF1aXJlZFNpemUgKiAyKTsKICAgICAgICB9CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUucmVzaXplQnVmZmVyID0gZnVuY3Rpb24obmV3U2l6ZSkgewogICAgICAgIHZhciBuZXdCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIobmV3U2l6ZSk7CiAgICAgICAgdmFyIG5ld0J5dGVzID0gbmV3IFVpbnQ4QXJyYXkobmV3QnVmZmVyKTsKICAgICAgICB2YXIgbmV3VmlldyA9IG5ldyBEYXRhVmlldyhuZXdCdWZmZXIpOwogICAgICAgIG5ld0J5dGVzLnNldCh0aGlzLmJ5dGVzKTsKICAgICAgICB0aGlzLnZpZXcgPSBuZXdWaWV3OwogICAgICAgIHRoaXMuYnl0ZXMgPSBuZXdCeXRlczsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGVOaWwgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLndyaXRlVTgoMHhjMCk7CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUuZW5jb2RlQm9vbGVhbiA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgIGlmIChvYmplY3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGMyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhjMyk7CiAgICAgICAgfQogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLmVuY29kZU51bWJlciA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgIGlmICghdGhpcy5mb3JjZUludGVnZXJUb0Zsb2F0ICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKG9iamVjdCkpIHsKICAgICAgICAgICAgaWYgKG9iamVjdCA+PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAob2JqZWN0IDwgMHg4MCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOChvYmplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmplY3QgPCAweDEwMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGNjKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0IDwgMHgxMDAwMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGNkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTE2KG9iamVjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iamVjdCA8IDB4MTAwMDAwMDAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4Y2UpOwogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVMzIob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMudXNlQmlnSW50NjQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhjZik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVU2NChvYmplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuY29kZU51bWJlckFzRmxvYXQob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChvYmplY3QgPj0gLTB4MjApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhlMCB8IG9iamVjdCArIDB4MjApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmplY3QgPj0gLTB4ODApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZUk4KG9iamVjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iamVjdCA+PSAtMHg4MDAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZDEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVJMTYob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0ID49IC0weDgwMDAwMDAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZDIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVJMzIob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMudXNlQmlnSW50NjQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkMyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZUk2NChvYmplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmVuY29kZU51bWJlckFzRmxvYXQob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlTnVtYmVyQXNGbG9hdChvYmplY3QpOwogICAgICAgIH0KICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGVOdW1iZXJBc0Zsb2F0ID0gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgaWYgKHRoaXMuZm9yY2VGbG9hdDMyKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGNhKTsKICAgICAgICAgICAgdGhpcy53cml0ZUYzMihvYmplY3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGNiKTsKICAgICAgICAgICAgdGhpcy53cml0ZUY2NChvYmplY3QpOwogICAgICAgIH0KICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGVCaWdJbnQ2NCA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgIGlmIChvYmplY3QgPj0gQmlnSW50KDApKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGNmKTsKICAgICAgICAgICAgdGhpcy53cml0ZUJpZ1VpbnQ2NChvYmplY3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQzKTsKICAgICAgICAgICAgdGhpcy53cml0ZUJpZ0ludDY0KG9iamVjdCk7CiAgICAgICAgfQogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLndyaXRlU3RyaW5nSGVhZGVyID0gZnVuY3Rpb24oYnl0ZUxlbmd0aCkgewogICAgICAgIGlmIChieXRlTGVuZ3RoIDwgMzIpIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4YTAgKyBieXRlTGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKGJ5dGVMZW5ndGggPCAweDEwMCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkOSk7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOChieXRlTGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKGJ5dGVMZW5ndGggPCAweDEwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGRhKTsKICAgICAgICAgICAgdGhpcy53cml0ZVUxNihieXRlTGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKGJ5dGVMZW5ndGggPCAweDEwMDAwMDAwMCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkYik7CiAgICAgICAgICAgIHRoaXMud3JpdGVVMzIoYnl0ZUxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb28gbG9uZyBzdHJpbmc6ICIuY29uY2F0KGJ5dGVMZW5ndGgsICIgYnl0ZXMgaW4gVVRGLTgiKSk7CiAgICAgICAgfQogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLmVuY29kZVN0cmluZyA9IGZ1bmN0aW9uKG9iamVjdCkgewogICAgICAgIHZhciBtYXhIZWFkZXJTaXplID0gMSArIDQ7CiAgICAgICAgdmFyIGJ5dGVMZW5ndGggPSB1dGY4Q291bnQob2JqZWN0KTsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKG1heEhlYWRlclNpemUgKyBieXRlTGVuZ3RoKTsKICAgICAgICB0aGlzLndyaXRlU3RyaW5nSGVhZGVyKGJ5dGVMZW5ndGgpOwogICAgICAgIHV0ZjhFbmNvZGUob2JqZWN0LCB0aGlzLmJ5dGVzLCB0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MgKz0gYnl0ZUxlbmd0aDsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGVPYmplY3QgPSBmdW5jdGlvbihvYmplY3QsIGRlcHRoKSB7CiAgICAgICAgdmFyIGV4dCA9IHRoaXMuZXh0ZW5zaW9uQ29kZWMudHJ5VG9FbmNvZGUob2JqZWN0LCB0aGlzLmNvbnRleHQpOwogICAgICAgIGlmIChleHQgIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmVuY29kZUV4dGVuc2lvbihleHQpOwogICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmplY3QpKSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlQXJyYXkob2JqZWN0LCBkZXB0aCk7CiAgICAgICAgfSBlbHNlIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcob2JqZWN0KSkgewogICAgICAgICAgICB0aGlzLmVuY29kZUJpbmFyeShvYmplY3QpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9iamVjdCA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgdGhpcy5lbmNvZGVNYXAob2JqZWN0LCBkZXB0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbnJlY29nbml6ZWQgb2JqZWN0OiAiLmNvbmNhdChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KG9iamVjdCkpKTsKICAgICAgICB9CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUuZW5jb2RlQmluYXJ5ID0gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICAgICAgdmFyIHNpemUgPSBvYmplY3QuYnl0ZUxlbmd0aDsKICAgICAgICBpZiAoc2l6ZSA8IDB4MTAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGM0KTsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4YzUpOwogICAgICAgICAgICB0aGlzLndyaXRlVTE2KHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDAwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGM2KTsKICAgICAgICAgICAgdGhpcy53cml0ZVUzMihzaXplKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRvbyBsYXJnZSBiaW5hcnk6ICIuY29uY2F0KHNpemUpKTsKICAgICAgICB9CiAgICAgICAgdmFyIGJ5dGVzID0gZW5zdXJlVWludDhBcnJheShvYmplY3QpOwogICAgICAgIHRoaXMud3JpdGVVOGEoYnl0ZXMpOwogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLmVuY29kZUFycmF5ID0gZnVuY3Rpb24ob2JqZWN0LCBkZXB0aCkgewogICAgICAgIHZhciBzaXplID0gb2JqZWN0Lmxlbmd0aDsKICAgICAgICBpZiAoc2l6ZSA8IDE2KSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweDkwICsgc2l6ZSk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplIDwgMHgxMDAwMCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkYyk7CiAgICAgICAgICAgIHRoaXMud3JpdGVVMTYoc2l6ZSk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplIDwgMHgxMDAwMDAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZGQpOwogICAgICAgICAgICB0aGlzLndyaXRlVTMyKHNpemUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9vIGxhcmdlIGFycmF5OiAiLmNvbmNhdChzaXplKSk7CiAgICAgICAgfQogICAgICAgIGZvcih2YXIgX2kgPSAwLCBvYmplY3RfMSA9IG9iamVjdDsgX2kgPCBvYmplY3RfMS5sZW5ndGg7IF9pKyspewogICAgICAgICAgICB2YXIgaXRlbSA9IG9iamVjdF8xW19pXTsKICAgICAgICAgICAgdGhpcy5kb0VuY29kZShpdGVtLCBkZXB0aCArIDEpOwogICAgICAgIH0KICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5jb3VudFdpdGhvdXRVbmRlZmluZWQgPSBmdW5jdGlvbihvYmplY3QsIGtleXMpIHsKICAgICAgICB2YXIgY291bnQgPSAwOwogICAgICAgIGZvcih2YXIgX2kgPSAwLCBrZXlzXzEgPSBrZXlzOyBfaSA8IGtleXNfMS5sZW5ndGg7IF9pKyspewogICAgICAgICAgICB2YXIga2V5ID0ga2V5c18xW19pXTsKICAgICAgICAgICAgaWYgKG9iamVjdFtrZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvdW50OwogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLmVuY29kZU1hcCA9IGZ1bmN0aW9uKG9iamVjdCwgZGVwdGgpIHsKICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CiAgICAgICAgaWYgKHRoaXMuc29ydEtleXMpIHsKICAgICAgICAgICAga2V5cy5zb3J0KCk7CiAgICAgICAgfQogICAgICAgIHZhciBzaXplID0gdGhpcy5pZ25vcmVVbmRlZmluZWQgPyB0aGlzLmNvdW50V2l0aG91dFVuZGVmaW5lZChvYmplY3QsIGtleXMpIDoga2V5cy5sZW5ndGg7CiAgICAgICAgaWYgKHNpemUgPCAxNikgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHg4MCArIHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZGUpOwogICAgICAgICAgICB0aGlzLndyaXRlVTE2KHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDAwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGRmKTsKICAgICAgICAgICAgdGhpcy53cml0ZVUzMihzaXplKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRvbyBsYXJnZSBtYXAgb2JqZWN0OiAiLmNvbmNhdChzaXplKSk7CiAgICAgICAgfQogICAgICAgIGZvcih2YXIgX2kgPSAwLCBrZXlzXzIgPSBrZXlzOyBfaSA8IGtleXNfMi5sZW5ndGg7IF9pKyspewogICAgICAgICAgICB2YXIga2V5ID0ga2V5c18yW19pXTsKICAgICAgICAgICAgdmFyIHZhbHVlID0gb2JqZWN0W2tleV07CiAgICAgICAgICAgIGlmICghKHRoaXMuaWdub3JlVW5kZWZpbmVkICYmIHZhbHVlID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVuY29kZVN0cmluZyhrZXkpOwogICAgICAgICAgICAgICAgdGhpcy5kb0VuY29kZSh2YWx1ZSwgZGVwdGggKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGVFeHRlbnNpb24gPSBmdW5jdGlvbihleHQpIHsKICAgICAgICB2YXIgc2l6ZSA9IGV4dC5kYXRhLmxlbmd0aDsKICAgICAgICBpZiAoc2l6ZSA9PT0gMSkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkNCk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplID09PSAyKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQ1KTsKICAgICAgICB9IGVsc2UgaWYgKHNpemUgPT09IDQpIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZDYpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA9PT0gOCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkNyk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplID09PSAxNikgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkOCk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplIDwgMHgxMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4YzcpOwogICAgICAgICAgICB0aGlzLndyaXRlVTgoc2l6ZSk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplIDwgMHgxMDAwMCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhjOCk7CiAgICAgICAgICAgIHRoaXMud3JpdGVVMTYoc2l6ZSk7CiAgICAgICAgfSBlbHNlIGlmIChzaXplIDwgMHgxMDAwMDAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4YzkpOwogICAgICAgICAgICB0aGlzLndyaXRlVTMyKHNpemUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9vIGxhcmdlIGV4dGVuc2lvbiBvYmplY3Q6ICIuY29uY2F0KHNpemUpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy53cml0ZUk4KGV4dC50eXBlKTsKICAgICAgICB0aGlzLndyaXRlVThhKGV4dC5kYXRhKTsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS53cml0ZVU4ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDEpOwogICAgICAgIHRoaXMudmlldy5zZXRVaW50OCh0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zKys7CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUud3JpdGVVOGEgPSBmdW5jdGlvbih2YWx1ZXMpIHsKICAgICAgICB2YXIgc2l6ZSA9IHZhbHVlcy5sZW5ndGg7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZShzaXplKTsKICAgICAgICB0aGlzLmJ5dGVzLnNldCh2YWx1ZXMsIHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSBzaXplOwogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLndyaXRlSTggPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoMSk7CiAgICAgICAgdGhpcy52aWV3LnNldEludDgodGhpcy5wb3MsIHZhbHVlKTsKICAgICAgICB0aGlzLnBvcysrOwogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLndyaXRlVTE2ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDIpOwogICAgICAgIHRoaXMudmlldy5zZXRVaW50MTYodGhpcy5wb3MsIHZhbHVlKTsKICAgICAgICB0aGlzLnBvcyArPSAyOwogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLndyaXRlSTE2ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDIpOwogICAgICAgIHRoaXMudmlldy5zZXRJbnQxNih0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDI7CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUud3JpdGVVMzIgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoNCk7CiAgICAgICAgdGhpcy52aWV3LnNldFVpbnQzMih0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDQ7CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUud3JpdGVJMzIgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoNCk7CiAgICAgICAgdGhpcy52aWV3LnNldEludDMyKHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MgKz0gNDsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS53cml0ZUYzMiA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSg0KTsKICAgICAgICB0aGlzLnZpZXcuc2V0RmxvYXQzMih0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDQ7CiAgICB9OwogICAgRW5jb2Rlci5wcm90b3R5cGUud3JpdGVGNjQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoOCk7CiAgICAgICAgdGhpcy52aWV3LnNldEZsb2F0NjQodGhpcy5wb3MsIHZhbHVlKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgfTsKICAgIEVuY29kZXIucHJvdG90eXBlLndyaXRlVTY0ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDgpOwogICAgICAgIHNldFVpbnQ2NCh0aGlzLnZpZXcsIHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MgKz0gODsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS53cml0ZUk2NCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSg4KTsKICAgICAgICBzZXRJbnQ2NCh0aGlzLnZpZXcsIHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MgKz0gODsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS53cml0ZUJpZ1VpbnQ2NCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSg4KTsKICAgICAgICB0aGlzLnZpZXcuc2V0QmlnVWludDY0KHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MgKz0gODsKICAgIH07CiAgICBFbmNvZGVyLnByb3RvdHlwZS53cml0ZUJpZ0ludDY0ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDgpOwogICAgICAgIHRoaXMudmlldy5zZXRCaWdJbnQ2NCh0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICB9OwogICAgcmV0dXJuIEVuY29kZXI7Cn0oKTsKZnVuY3Rpb24gZW5jb2RlKHZhbHVlLCBvcHRpb25zKSB7CiAgICB2YXIgZW5jb2RlciA9IG5ldyBFbmNvZGVyKG9wdGlvbnMpOwogICAgcmV0dXJuIGVuY29kZXIuZW5jb2RlU2hhcmVkUmVmKHZhbHVlKTsKfQpmdW5jdGlvbiBwcmV0dHlCeXRlKF9fYnl0ZSkgewogICAgcmV0dXJuICIiLmNvbmNhdChfX2J5dGUgPCAwID8gIi0iIDogIiIsICIweCIpLmNvbmNhdChNYXRoLmFicyhfX2J5dGUpLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpKTsKfQp2YXIgREVGQVVMVF9NQVhfS0VZX0xFTkdUSCA9IDE2Owp2YXIgREVGQVVMVF9NQVhfTEVOR1RIX1BFUl9LRVkgPSAxNjsKdmFyIENhY2hlZEtleURlY29kZXIgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIENhY2hlZEtleURlY29kZXIobWF4S2V5TGVuZ3RoLCBtYXhMZW5ndGhQZXJLZXkpIHsKICAgICAgICBpZiAobWF4S2V5TGVuZ3RoID09PSB2b2lkIDApIHsKICAgICAgICAgICAgbWF4S2V5TGVuZ3RoID0gREVGQVVMVF9NQVhfS0VZX0xFTkdUSDsKICAgICAgICB9CiAgICAgICAgaWYgKG1heExlbmd0aFBlcktleSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIG1heExlbmd0aFBlcktleSA9IERFRkFVTFRfTUFYX0xFTkdUSF9QRVJfS0VZOwogICAgICAgIH0KICAgICAgICB0aGlzLm1heEtleUxlbmd0aCA9IG1heEtleUxlbmd0aDsKICAgICAgICB0aGlzLm1heExlbmd0aFBlcktleSA9IG1heExlbmd0aFBlcktleTsKICAgICAgICB0aGlzLmhpdCA9IDA7CiAgICAgICAgdGhpcy5taXNzID0gMDsKICAgICAgICB0aGlzLmNhY2hlcyA9IFtdOwogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLm1heEtleUxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgdGhpcy5jYWNoZXMucHVzaChbXSk7CiAgICAgICAgfQogICAgfQogICAgQ2FjaGVkS2V5RGVjb2Rlci5wcm90b3R5cGUuY2FuQmVDYWNoZWQgPSBmdW5jdGlvbihieXRlTGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGJ5dGVMZW5ndGggPiAwICYmIGJ5dGVMZW5ndGggPD0gdGhpcy5tYXhLZXlMZW5ndGg7CiAgICB9OwogICAgQ2FjaGVkS2V5RGVjb2Rlci5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKGJ5dGVzLCBpbnB1dE9mZnNldCwgYnl0ZUxlbmd0aCkgewogICAgICAgIHZhciByZWNvcmRzID0gdGhpcy5jYWNoZXNbYnl0ZUxlbmd0aCAtIDFdOwogICAgICAgIEZJTkRfQ0hVTks6IGZvcih2YXIgX2kgPSAwLCByZWNvcmRzXzEgPSByZWNvcmRzOyBfaSA8IHJlY29yZHNfMS5sZW5ndGg7IF9pKyspewogICAgICAgICAgICB2YXIgcmVjb3JkID0gcmVjb3Jkc18xW19pXTsKICAgICAgICAgICAgdmFyIHJlY29yZEJ5dGVzID0gcmVjb3JkLmJ5dGVzOwogICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgYnl0ZUxlbmd0aDsgaisrKXsKICAgICAgICAgICAgICAgIGlmIChyZWNvcmRCeXRlc1tqXSAhPT0gYnl0ZXNbaW5wdXRPZmZzZXQgKyBqXSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIEZJTkRfQ0hVTks7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlY29yZC5zdHI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIENhY2hlZEtleURlY29kZXIucHJvdG90eXBlLnN0b3JlID0gZnVuY3Rpb24oYnl0ZXMsIHZhbHVlKSB7CiAgICAgICAgdmFyIHJlY29yZHMgPSB0aGlzLmNhY2hlc1tieXRlcy5sZW5ndGggLSAxXTsKICAgICAgICB2YXIgcmVjb3JkID0gewogICAgICAgICAgICBieXRlczogYnl0ZXMsCiAgICAgICAgICAgIHN0cjogdmFsdWUKICAgICAgICB9OwogICAgICAgIGlmIChyZWNvcmRzLmxlbmd0aCA+PSB0aGlzLm1heExlbmd0aFBlcktleSkgewogICAgICAgICAgICByZWNvcmRzW01hdGgucmFuZG9tKCkgKiByZWNvcmRzLmxlbmd0aCB8IDBdID0gcmVjb3JkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlY29yZHMucHVzaChyZWNvcmQpOwogICAgICAgIH0KICAgIH07CiAgICBDYWNoZWRLZXlEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbihieXRlcywgaW5wdXRPZmZzZXQsIGJ5dGVMZW5ndGgpIHsKICAgICAgICB2YXIgY2FjaGVkVmFsdWUgPSB0aGlzLmZpbmQoYnl0ZXMsIGlucHV0T2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgICAgICBpZiAoY2FjaGVkVmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmhpdCsrOwogICAgICAgICAgICByZXR1cm4gY2FjaGVkVmFsdWU7CiAgICAgICAgfQogICAgICAgIHRoaXMubWlzcysrOwogICAgICAgIHZhciBzdHIgPSB1dGY4RGVjb2RlSnMoYnl0ZXMsIGlucHV0T2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgICAgICB2YXIgc2xpY2VkQ29weU9mQnl0ZXMgPSBVaW50OEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGJ5dGVzLCBpbnB1dE9mZnNldCwgaW5wdXRPZmZzZXQgKyBieXRlTGVuZ3RoKTsKICAgICAgICB0aGlzLnN0b3JlKHNsaWNlZENvcHlPZkJ5dGVzLCBzdHIpOwogICAgICAgIHJldHVybiBzdHI7CiAgICB9OwogICAgcmV0dXJuIENhY2hlZEtleURlY29kZXI7Cn0oKTsKdmFyIF9fYXdhaXRlciA9IHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIgfHwgZnVuY3Rpb24odGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7CiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgewogICAgICAgIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgewogICAgICAgICAgICByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsKICAgICAgICB9CiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOwogICAgfSk7Cn07CnZhciBfX2dlbmVyYXRvciA9IHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvciB8fCBmdW5jdGlvbih0aGlzQXJnLCBib2R5KSB7CiAgICB2YXIgXyA9IHsKICAgICAgICBsYWJlbDogMCwKICAgICAgICBzZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOwogICAgICAgICAgICByZXR1cm4gdFsxXTsKICAgICAgICB9LAogICAgICAgIHRyeXM6IFtdLAogICAgICAgIG9wczogW10KICAgIH0sIGYsIHksIHQsIGc7CiAgICByZXR1cm4gZyA9IHsKICAgICAgICBuZXh0OiB2ZXJiKDApLAogICAgICAgICJ0aHJvdyI6IHZlcmIoMSksCiAgICAgICAgInJldHVybiI6IHZlcmIoMikKICAgIH0sIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgfSksIGc7CiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24odikgewogICAgICAgICAgICByZXR1cm4gc3RlcChbCiAgICAgICAgICAgICAgICBuLAogICAgICAgICAgICAgICAgdgogICAgICAgICAgICBdKTsKICAgICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gc3RlcChvcCkgewogICAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuIik7CiAgICAgICAgd2hpbGUoZyAmJiAoZyA9IDAsIG9wWzBdICYmIChfID0gMCkpLCBfKXRyeSB7CiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbInJldHVybiJdIDogb3BbMF0gPyB5WyJ0aHJvdyJdIHx8ICgodCA9IHlbInJldHVybiJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDsKICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFsKICAgICAgICAgICAgICAgIG9wWzBdICYgMiwKICAgICAgICAgICAgICAgIHQudmFsdWUKICAgICAgICAgICAgXTsKICAgICAgICAgICAgc3dpdGNoKG9wWzBdKXsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICB0ID0gb3A7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCsrOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvcFsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIF8ubGFiZWwrKzsKICAgICAgICAgICAgICAgICAgICB5ID0gb3BbMV07CiAgICAgICAgICAgICAgICAgICAgb3AgPSBbCiAgICAgICAgICAgICAgICAgICAgICAgIDAKICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIG9wID0gXy5vcHMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgb3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCA9IG9wWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF8ubGFiZWwgPSB0WzFdOwogICAgICAgICAgICAgICAgICAgICAgICB0ID0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgewogICAgICAgICAgICAgICAgICAgICAgICBfLmxhYmVsID0gdFsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgXy5vcHMucHVzaChvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgXy50cnlzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgb3AgPSBbCiAgICAgICAgICAgICAgICA2LAogICAgICAgICAgICAgICAgZQogICAgICAgICAgICBdOwogICAgICAgICAgICB5ID0gMDsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIGYgPSB0ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsCiAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICB9OwogICAgfQp9Owp2YXIgX19hc3luY1ZhbHVlcyA9IHRoaXMgJiYgdGhpcy5fX2FzeW5jVmFsdWVzIHx8IGZ1bmN0aW9uKG8pIHsKICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwogICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTsKICAgIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09ICJmdW5jdGlvbiIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoIm5leHQiKSwgdmVyYigidGhyb3ciKSwgdmVyYigicmV0dXJuIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LCBpKTsKICAgIGZ1bmN0aW9uIHZlcmIobikgewogICAgICAgIGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uKHYpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgdiA9IG9bbl0odiksIHNldHRsZShyZXNvbHZlLCByZWplY3QsIHYuZG9uZSwgdi52YWx1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCBkLCB2KSB7CiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgewogICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICAgIHZhbHVlOiB2LAogICAgICAgICAgICAgICAgZG9uZTogZAogICAgICAgICAgICB9KTsKICAgICAgICB9LCByZWplY3QpOwogICAgfQp9Owp2YXIgX19hd2FpdCA9IHRoaXMgJiYgdGhpcy5fX2F3YWl0IHx8IGZ1bmN0aW9uKHYpIHsKICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpOwp9Owp2YXIgX19hc3luY0dlbmVyYXRvciA9IHRoaXMgJiYgdGhpcy5fX2FzeW5jR2VuZXJhdG9yIHx8IGZ1bmN0aW9uKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikgewogICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7CiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdOwogICAgcmV0dXJuIGkgPSB7fSwgdmVyYigibmV4dCIpLCB2ZXJiKCJ0aHJvdyIpLCB2ZXJiKCJyZXR1cm4iKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sIGk7CiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsKICAgICAgICBpZiAoZ1tuXSkgaVtuXSA9IGZ1bmN0aW9uKHYpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHEucHVzaChbCiAgICAgICAgICAgICAgICAgICAgbiwKICAgICAgICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgYgogICAgICAgICAgICAgICAgXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RlcChnW25dKHYpKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHNldHRsZShxWzBdWzNdLCBlKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzdGVwKHIpIHsKICAgICAgICByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsKICAgICAgICByZXN1bWUoIm5leHQiLCB2YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsKICAgICAgICByZXN1bWUoInRocm93IiwgdmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsKICAgICAgICBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOwogICAgfQp9Owp2YXIgU1RBVEVfQVJSQVkgPSAiYXJyYXkiOwp2YXIgU1RBVEVfTUFQX0tFWSA9ICJtYXBfa2V5IjsKdmFyIFNUQVRFX01BUF9WQUxVRSA9ICJtYXBfdmFsdWUiOwp2YXIgaXNWYWxpZE1hcEtleVR5cGUgPSBmdW5jdGlvbihrZXkpIHsKICAgIHJldHVybiB0eXBlb2Yga2V5ID09PSAic3RyaW5nIiB8fCB0eXBlb2Yga2V5ID09PSAibnVtYmVyIjsKfTsKdmFyIEhFQURfQllURV9SRVFVSVJFRCA9IC0xOwp2YXIgRU1QVFlfVklFVyA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMCkpOwp2YXIgRU1QVFlfQllURVMgPSBuZXcgVWludDhBcnJheShFTVBUWV9WSUVXLmJ1ZmZlcik7CnRyeSB7CiAgICBFTVBUWV9WSUVXLmdldEludDgoMCk7Cn0gY2F0Y2ggKGUpIHsKICAgIGlmICghKGUgaW5zdGFuY2VvZiBSYW5nZUVycm9yKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhpcyBtb2R1bGUgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGUgY3VycmVudCBKYXZhU2NyaXB0IGVuZ2luZSBiZWNhdXNlIERhdGFWaWV3IGRvZXMgbm90IHRocm93IFJhbmdlRXJyb3Igb24gb3V0LW9mLWJvdW5kcyBhY2Nlc3MiKTsKICAgIH0KfQp2YXIgRGF0YVZpZXdJbmRleE91dE9mQm91bmRzRXJyb3IgPSBSYW5nZUVycm9yOwp2YXIgTU9SRV9EQVRBID0gbmV3IERhdGFWaWV3SW5kZXhPdXRPZkJvdW5kc0Vycm9yKCJJbnN1ZmZpY2llbnQgZGF0YSIpOwp2YXIgc2hhcmVkQ2FjaGVkS2V5RGVjb2RlciA9IG5ldyBDYWNoZWRLZXlEZWNvZGVyKCk7CnZhciBEZWNvZGVyID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBEZWNvZGVyKG9wdGlvbnMpIHsKICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2c7CiAgICAgICAgdGhpcy50b3RhbFBvcyA9IDA7CiAgICAgICAgdGhpcy5wb3MgPSAwOwogICAgICAgIHRoaXMudmlldyA9IEVNUFRZX1ZJRVc7CiAgICAgICAgdGhpcy5ieXRlcyA9IEVNUFRZX0JZVEVTOwogICAgICAgIHRoaXMuaGVhZEJ5dGUgPSBIRUFEX0JZVEVfUkVRVUlSRUQ7CiAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgIHRoaXMuZXh0ZW5zaW9uQ29kZWMgPSAoX2EgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuZXh0ZW5zaW9uQ29kZWMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IEV4dGVuc2lvbkNvZGVjLmRlZmF1bHRDb2RlYzsKICAgICAgICB0aGlzLmNvbnRleHQgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuY29udGV4dDsKICAgICAgICB0aGlzLnVzZUJpZ0ludDY0ID0gKF9iID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLnVzZUJpZ0ludDY0KSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBmYWxzZTsKICAgICAgICB0aGlzLm1heFN0ckxlbmd0aCA9IChfYyA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5tYXhTdHJMZW5ndGgpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IFVJTlQzMl9NQVg7CiAgICAgICAgdGhpcy5tYXhCaW5MZW5ndGggPSAoX2QgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMubWF4QmluTGVuZ3RoKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiBVSU5UMzJfTUFYOwogICAgICAgIHRoaXMubWF4QXJyYXlMZW5ndGggPSAoX2UgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMubWF4QXJyYXlMZW5ndGgpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IFVJTlQzMl9NQVg7CiAgICAgICAgdGhpcy5tYXhNYXBMZW5ndGggPSAoX2YgPSBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMubWF4TWFwTGVuZ3RoKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiBVSU5UMzJfTUFYOwogICAgICAgIHRoaXMubWF4RXh0TGVuZ3RoID0gKF9nID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLm1heEV4dExlbmd0aCkgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogVUlOVDMyX01BWDsKICAgICAgICB0aGlzLmtleURlY29kZXIgPSAob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmtleURlY29kZXIpICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmtleURlY29kZXIgOiBzaGFyZWRDYWNoZWRLZXlEZWNvZGVyOwogICAgfQogICAgRGVjb2Rlci5wcm90b3R5cGUucmVpbml0aWFsaXplU3RhdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnRvdGFsUG9zID0gMDsKICAgICAgICB0aGlzLmhlYWRCeXRlID0gSEVBRF9CWVRFX1JFUVVJUkVEOwogICAgICAgIHRoaXMuc3RhY2subGVuZ3RoID0gMDsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5zZXRCdWZmZXIgPSBmdW5jdGlvbihidWZmZXIpIHsKICAgICAgICB0aGlzLmJ5dGVzID0gZW5zdXJlVWludDhBcnJheShidWZmZXIpOwogICAgICAgIHRoaXMudmlldyA9IGNyZWF0ZURhdGFWaWV3KHRoaXMuYnl0ZXMpOwogICAgICAgIHRoaXMucG9zID0gMDsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5hcHBlbmRCdWZmZXIgPSBmdW5jdGlvbihidWZmZXIpIHsKICAgICAgICBpZiAodGhpcy5oZWFkQnl0ZSA9PT0gSEVBRF9CWVRFX1JFUVVJUkVEICYmICF0aGlzLmhhc1JlbWFpbmluZygxKSkgewogICAgICAgICAgICB0aGlzLnNldEJ1ZmZlcihidWZmZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciByZW1haW5pbmdEYXRhID0gdGhpcy5ieXRlcy5zdWJhcnJheSh0aGlzLnBvcyk7CiAgICAgICAgICAgIHZhciBuZXdEYXRhID0gZW5zdXJlVWludDhBcnJheShidWZmZXIpOwogICAgICAgICAgICB2YXIgbmV3QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkocmVtYWluaW5nRGF0YS5sZW5ndGggKyBuZXdEYXRhLmxlbmd0aCk7CiAgICAgICAgICAgIG5ld0J1ZmZlci5zZXQocmVtYWluaW5nRGF0YSk7CiAgICAgICAgICAgIG5ld0J1ZmZlci5zZXQobmV3RGF0YSwgcmVtYWluaW5nRGF0YS5sZW5ndGgpOwogICAgICAgICAgICB0aGlzLnNldEJ1ZmZlcihuZXdCdWZmZXIpOwogICAgICAgIH0KICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5oYXNSZW1haW5pbmcgPSBmdW5jdGlvbihzaXplKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmlldy5ieXRlTGVuZ3RoIC0gdGhpcy5wb3MgPj0gc2l6ZTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5jcmVhdGVFeHRyYUJ5dGVFcnJvciA9IGZ1bmN0aW9uKHBvc1RvU2hvdykgewogICAgICAgIHZhciBfYSA9IHRoaXMsIHZpZXcgPSBfYS52aWV3LCBwb3MgPSBfYS5wb3M7CiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZUVycm9yKCJFeHRyYSAiLmNvbmNhdCh2aWV3LmJ5dGVMZW5ndGggLSBwb3MsICIgb2YgIikuY29uY2F0KHZpZXcuYnl0ZUxlbmd0aCwgIiBieXRlKHMpIGZvdW5kIGF0IGJ1ZmZlclsiKS5jb25jYXQocG9zVG9TaG93LCAiXSIpKTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbihidWZmZXIpIHsKICAgICAgICB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCk7CiAgICAgICAgdGhpcy5zZXRCdWZmZXIoYnVmZmVyKTsKICAgICAgICB2YXIgb2JqZWN0ID0gdGhpcy5kb0RlY29kZVN5bmMoKTsKICAgICAgICBpZiAodGhpcy5oYXNSZW1haW5pbmcoMSkpIHsKICAgICAgICAgICAgdGhyb3cgdGhpcy5jcmVhdGVFeHRyYUJ5dGVFcnJvcih0aGlzLnBvcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9OwogICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlTXVsdGkgPSBmdW5jdGlvbihidWZmZXIpIHsKICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24oX2EpIHsKICAgICAgICAgICAgc3dpdGNoKF9hLmxhYmVsKXsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXIoYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhhc1JlbWFpbmluZygxKSkgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgMwogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgNCwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb0RlY29kZVN5bmMoKQogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgIDEKICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgIDIKICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwogICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQXN5bmMgPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgICAgICB2YXIgX2EsIHN0cmVhbV8xLCBzdHJlYW1fMV8xOwogICAgICAgIHZhciBfYiwgZV8xLCBfYywgX2Q7CiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBkZWNvZGVkLCBvYmplY3QsIGJ1ZmZlciwgZV8xXzEsIF9lLCBoZWFkQnl0ZSwgcG9zLCB0b3RhbFBvczsKICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uKF9mKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2goX2YubGFiZWwpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgZGVjb2RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBfZi5sYWJlbCA9IDE7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBfZi50cnlzLnB1c2goWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTIKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9hID0gdHJ1ZSwgc3RyZWFtXzEgPSBfX2FzeW5jVmFsdWVzKHN0cmVhbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9mLmxhYmVsID0gMjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtXzEubmV4dCgpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShzdHJlYW1fMV8xID0gX2Yuc2VudCgpLCBfYiA9IHN0cmVhbV8xXzEuZG9uZSwgIV9iKSkgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA1CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIF9kID0gc3RyZWFtXzFfMS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgX2EgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlciA9IF9kOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlY29kZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLmNyZWF0ZUV4dHJhQnl0ZUVycm9yKHRoaXMudG90YWxQb3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRCdWZmZXIoYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kb0RlY29kZVN5bmMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNvZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgRGF0YVZpZXdJbmRleE91dE9mQm91bmRzRXJyb3IpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbFBvcyArPSB0aGlzLnBvczsKICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5ewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2EgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIF9mLmxhYmVsID0gNDsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMgogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMgogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICAgICAgZV8xXzEgPSBfZi5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVfMSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBlXzFfMQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEyCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICBfZi50cnlzLnB1c2goWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTEKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKCFfYSAmJiAhX2IgJiYgKF9jID0gc3RyZWFtXzEucmV0dXJuKSkpIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgOQogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jLmNhbGwoc3RyZWFtXzEpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICBfZi5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIF9mLmxhYmVsID0gOTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTEKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA3CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDcKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVjb2RlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzUmVtYWluaW5nKDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5jcmVhdGVFeHRyYUJ5dGVFcnJvcih0aGlzLnRvdGFsUG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgX2UgPSB0aGlzLCBoZWFkQnl0ZSA9IF9lLmhlYWRCeXRlLCBwb3MgPSBfZS5wb3MsIHRvdGFsUG9zID0gX2UudG90YWxQb3M7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJJbnN1ZmZpY2llbnQgZGF0YSBpbiBwYXJzaW5nICIuY29uY2F0KHByZXR0eUJ5dGUoaGVhZEJ5dGUpLCAiIGF0ICIpLmNvbmNhdCh0b3RhbFBvcywgIiAoIikuY29uY2F0KHBvcywgIiBpbiB0aGUgY3VycmVudCBidWZmZXIpIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVBcnJheVN0cmVhbSA9IGZ1bmN0aW9uKHN0cmVhbSkgewogICAgICAgIHJldHVybiB0aGlzLmRlY29kZU11bHRpQXN5bmMoc3RyZWFtLCB0cnVlKTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVTdHJlYW0gPSBmdW5jdGlvbihzdHJlYW0pIHsKICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGVNdWx0aUFzeW5jKHN0cmVhbSwgZmFsc2UpOwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLmRlY29kZU11bHRpQXN5bmMgPSBmdW5jdGlvbihzdHJlYW0sIGlzQXJyYXkpIHsKICAgICAgICByZXR1cm4gX19hc3luY0dlbmVyYXRvcih0aGlzLCBhcmd1bWVudHMsIGZ1bmN0aW9uIGRlY29kZU11bHRpQXN5bmNfMSgpIHsKICAgICAgICAgICAgdmFyIGlzQXJyYXlIZWFkZXJSZXF1aXJlZCwgYXJyYXlJdGVtc0xlZnQsIF9hLCBzdHJlYW1fMiwgc3RyZWFtXzJfMSwgYnVmZmVyLCBlXzIsIGVfM18xOwogICAgICAgICAgICB2YXIgX2IsIGVfMywgX2MsIF9kOwogICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24oX2UpIHsKICAgICAgICAgICAgICAgIHN3aXRjaChfZS5sYWJlbCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBpc0FycmF5SGVhZGVyUmVxdWlyZWQgPSBpc0FycmF5OwogICAgICAgICAgICAgICAgICAgICAgICBhcnJheUl0ZW1zTGVmdCA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICBfZS5sYWJlbCA9IDE7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBfZS50cnlzLnB1c2goWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyMQogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2EgPSB0cnVlLCBzdHJlYW1fMiA9IF9fYXN5bmNWYWx1ZXMoc3RyZWFtKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2UubGFiZWwgPSAyOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2F3YWl0KHN0cmVhbV8yLm5leHQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKHN0cmVhbV8yXzEgPSBfZS5zZW50KCksIF9iID0gc3RyZWFtXzJfMS5kb25lLCAhX2IpKSByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE0CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIF9kID0gc3RyZWFtXzJfMS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgX2EgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgX2UubGFiZWwgPSA0OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgX2UudHJ5cy5wdXNoKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEzCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIgPSBfZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkgJiYgYXJyYXlJdGVtc0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuY3JlYXRlRXh0cmFCeXRlRXJyb3IodGhpcy50b3RhbFBvcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRCdWZmZXIoYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQXJyYXlIZWFkZXJSZXF1aXJlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlJdGVtc0xlZnQgPSB0aGlzLnJlYWRBcnJheVNpemUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQXJyYXlIZWFkZXJSZXF1aXJlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIF9lLmxhYmVsID0gNTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgIF9lLnRyeXMucHVzaChbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMQogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgX2UubGFiZWwgPSA2OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cnVlKSByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDkKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2F3YWl0KHRoaXMuZG9EZWNvZGVTeW5jKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9lLnNlbnQoKQogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgX2Uuc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoLS1hcnJheUl0ZW1zTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA2CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgZV8yID0gX2Uuc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlXzIgaW5zdGFuY2VvZiBEYXRhVmlld0luZGV4T3V0T2ZCb3VuZHNFcnJvcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVfMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3RhbFBvcyArPSB0aGlzLnBvczsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMwogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgICAgIF9hID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDcKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIxCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgICAgICAgZV8zXzEgPSBfZS5zZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVfMyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBlXzNfMQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIxCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICAgICAgX2UudHJ5cy5wdXNoKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyMAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoIV9hICYmICFfYiAmJiAoX2MgPSBzdHJlYW1fMi5yZXR1cm4pKSkgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxOAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fYXdhaXQoX2MuY2FsbChzdHJlYW1fMikpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgICAgICAgICAgX2Uuc2VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICBfZS5sYWJlbCA9IDE4OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjAKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZV8zKSB0aHJvdyBlXzMuZXJyb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA3CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDcKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMgogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5kb0RlY29kZVN5bmMgPSBmdW5jdGlvbigpIHsKICAgICAgICBERUNPREU6IHdoaWxlKHRydWUpewogICAgICAgICAgICB2YXIgaGVhZEJ5dGUgPSB0aGlzLnJlYWRIZWFkQnl0ZSgpOwogICAgICAgICAgICB2YXIgb2JqZWN0ID0gdm9pZCAwOwogICAgICAgICAgICBpZiAoaGVhZEJ5dGUgPj0gMHhlMCkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gaGVhZEJ5dGUgLSAweDEwMDsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA8IDB4YzApIHsKICAgICAgICAgICAgICAgIGlmIChoZWFkQnl0ZSA8IDB4ODApIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBoZWFkQnl0ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPCAweDkwKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSBoZWFkQnl0ZSAtIDB4ODA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoTWFwU3RhdGUoc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgREVDT0RFOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPCAweGEwKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSBoZWFkQnl0ZSAtIDB4OTA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoQXJyYXlTdGF0ZShzaXplKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gW107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYnl0ZUxlbmd0aCA9IGhlYWRCeXRlIC0gMHhhMDsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZVV0ZjhTdHJpbmcoYnl0ZUxlbmd0aCwgMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4YzApIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IG51bGw7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4YzIpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGMzKSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGNhKSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRGMzIoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjYikgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5yZWFkRjY0KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4Y2MpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZFU4KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4Y2QpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZFUxNigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGNlKSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRVMzIoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjZikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMudXNlQmlnSW50NjQpIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRVNjRBc0JpZ0ludCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRVNjQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkMCkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5yZWFkSTgoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkMSkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5yZWFkSTE2KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZDIpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZEkzMigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQzKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy51c2VCaWdJbnQ2NCkgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZEk2NEFzQmlnSW50KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZEk2NCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQ5KSB7CiAgICAgICAgICAgICAgICB2YXIgYnl0ZUxlbmd0aCA9IHRoaXMubG9va1U4KCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZVV0ZjhTdHJpbmcoYnl0ZUxlbmd0aCwgMSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZGEpIHsKICAgICAgICAgICAgICAgIHZhciBieXRlTGVuZ3RoID0gdGhpcy5sb29rVTE2KCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZVV0ZjhTdHJpbmcoYnl0ZUxlbmd0aCwgMik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZGIpIHsKICAgICAgICAgICAgICAgIHZhciBieXRlTGVuZ3RoID0gdGhpcy5sb29rVTMyKCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZVV0ZjhTdHJpbmcoYnl0ZUxlbmd0aCwgNCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZGMpIHsKICAgICAgICAgICAgICAgIHZhciBzaXplID0gdGhpcy5yZWFkVTE2KCk7CiAgICAgICAgICAgICAgICBpZiAoc2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucHVzaEFycmF5U3RhdGUoc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIERFQ09ERTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZGQpIHsKICAgICAgICAgICAgICAgIHZhciBzaXplID0gdGhpcy5yZWFkVTMyKCk7CiAgICAgICAgICAgICAgICBpZiAoc2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucHVzaEFycmF5U3RhdGUoc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIERFQ09ERTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZGUpIHsKICAgICAgICAgICAgICAgIHZhciBzaXplID0gdGhpcy5yZWFkVTE2KCk7CiAgICAgICAgICAgICAgICBpZiAoc2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucHVzaE1hcFN0YXRlKHNpemUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGRmKSB7CiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHRoaXMucmVhZFUzMigpOwogICAgICAgICAgICAgICAgaWYgKHNpemUgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hNYXBTdGF0ZShzaXplKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgREVDT0RFOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSB7fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjNCkgewogICAgICAgICAgICAgICAgdmFyIHNpemUgPSB0aGlzLmxvb2tVOCgpOwogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVCaW5hcnkoc2l6ZSwgMSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4YzUpIHsKICAgICAgICAgICAgICAgIHZhciBzaXplID0gdGhpcy5sb29rVTE2KCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUJpbmFyeShzaXplLCAyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjNikgewogICAgICAgICAgICAgICAgdmFyIHNpemUgPSB0aGlzLmxvb2tVMzIoKTsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlQmluYXJ5KHNpemUsIDQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQ0KSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUV4dGVuc2lvbigxLCAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkNSkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVFeHRlbnNpb24oMiwgMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZDYpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKDQsIDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQ3KSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUV4dGVuc2lvbig4LCAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkOCkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVFeHRlbnNpb24oMTYsIDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGM3KSB7CiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHRoaXMubG9va1U4KCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUV4dGVuc2lvbihzaXplLCAxKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjOCkgewogICAgICAgICAgICAgICAgdmFyIHNpemUgPSB0aGlzLmxvb2tVMTYoKTsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKHNpemUsIDIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGM5KSB7CiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHRoaXMubG9va1UzMigpOwogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVFeHRlbnNpb24oc2l6ZSwgNCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRGVjb2RlRXJyb3IoIlVucmVjb2duaXplZCB0eXBlIGJ5dGU6ICIuY29uY2F0KHByZXR0eUJ5dGUoaGVhZEJ5dGUpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSgpOwogICAgICAgICAgICB2YXIgc3RhY2sgPSB0aGlzLnN0YWNrOwogICAgICAgICAgICB3aGlsZShzdGFjay5sZW5ndGggPiAwKXsKICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnR5cGUgPT09IFNUQVRFX0FSUkFZKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuYXJyYXlbc3RhdGUucG9zaXRpb25dID0gb2JqZWN0OwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnBvc2l0aW9uKys7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnBvc2l0aW9uID09PSBzdGF0ZS5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBzdGF0ZS5hcnJheTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS50eXBlID09PSBTVEFURV9NQVBfS0VZKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkTWFwS2V5VHlwZShvYmplY3QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVFcnJvcigiVGhlIHR5cGUgb2Yga2V5IG11c3QgYmUgc3RyaW5nIG9yIG51bWJlciBidXQgIiArIHR5cGVvZiBvYmplY3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0ID09PSAiX19wcm90b19fIikgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRGVjb2RlRXJyb3IoIlRoZSBrZXkgX19wcm90b19fIGlzIG5vdCBhbGxvd2VkIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHN0YXRlLmtleSA9IG9iamVjdDsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS50eXBlID0gU1RBVEVfTUFQX1ZBTFVFOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIERFQ09ERTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubWFwW3N0YXRlLmtleV0gPSBvYmplY3Q7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUucmVhZENvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnJlYWRDb3VudCA9PT0gc3RhdGUuc2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gc3RhdGUubWFwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmtleSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnR5cGUgPSBTVEFURV9NQVBfS0VZOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgfQogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLnJlYWRIZWFkQnl0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLmhlYWRCeXRlID09PSBIRUFEX0JZVEVfUkVRVUlSRUQpIHsKICAgICAgICAgICAgdGhpcy5oZWFkQnl0ZSA9IHRoaXMucmVhZFU4KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmhlYWRCeXRlOwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5oZWFkQnl0ZSA9IEhFQURfQllURV9SRVFVSVJFRDsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5yZWFkQXJyYXlTaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGhlYWRCeXRlID0gdGhpcy5yZWFkSGVhZEJ5dGUoKTsKICAgICAgICBzd2l0Y2goaGVhZEJ5dGUpewogICAgICAgICAgICBjYXNlIDB4ZGM6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWFkVTE2KCk7CiAgICAgICAgICAgIGNhc2UgMHhkZDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlYWRVMzIoKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGVhZEJ5dGUgPCAweGEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoZWFkQnl0ZSAtIDB4OTA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IERlY29kZUVycm9yKCJVbnJlY29nbml6ZWQgYXJyYXkgdHlwZSBieXRlOiAiLmNvbmNhdChwcmV0dHlCeXRlKGhlYWRCeXRlKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgRGVjb2Rlci5wcm90b3R5cGUucHVzaE1hcFN0YXRlID0gZnVuY3Rpb24oc2l6ZSkgewogICAgICAgIGlmIChzaXplID4gdGhpcy5tYXhNYXBMZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IERlY29kZUVycm9yKCJNYXggbGVuZ3RoIGV4Y2VlZGVkOiBtYXAgbGVuZ3RoICgiLmNvbmNhdChzaXplLCAiKSA+IG1heE1hcExlbmd0aExlbmd0aCAoIikuY29uY2F0KHRoaXMubWF4TWFwTGVuZ3RoLCAiKSIpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zdGFjay5wdXNoKHsKICAgICAgICAgICAgdHlwZTogU1RBVEVfTUFQX0tFWSwKICAgICAgICAgICAgc2l6ZTogc2l6ZSwKICAgICAgICAgICAga2V5OiBudWxsLAogICAgICAgICAgICByZWFkQ291bnQ6IDAsCiAgICAgICAgICAgIG1hcDoge30KICAgICAgICB9KTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5wdXNoQXJyYXlTdGF0ZSA9IGZ1bmN0aW9uKHNpemUpIHsKICAgICAgICBpZiAoc2l6ZSA+IHRoaXMubWF4QXJyYXlMZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IERlY29kZUVycm9yKCJNYXggbGVuZ3RoIGV4Y2VlZGVkOiBhcnJheSBsZW5ndGggKCIuY29uY2F0KHNpemUsICIpID4gbWF4QXJyYXlMZW5ndGggKCIpLmNvbmNhdCh0aGlzLm1heEFycmF5TGVuZ3RoLCAiKSIpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zdGFjay5wdXNoKHsKICAgICAgICAgICAgdHlwZTogU1RBVEVfQVJSQVksCiAgICAgICAgICAgIHNpemU6IHNpemUsCiAgICAgICAgICAgIGFycmF5OiBuZXcgQXJyYXkoc2l6ZSksCiAgICAgICAgICAgIHBvc2l0aW9uOiAwCiAgICAgICAgfSk7CiAgICB9OwogICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlVXRmOFN0cmluZyA9IGZ1bmN0aW9uKGJ5dGVMZW5ndGgsIGhlYWRlck9mZnNldCkgewogICAgICAgIHZhciBfYTsKICAgICAgICBpZiAoYnl0ZUxlbmd0aCA+IHRoaXMubWF4U3RyTGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVFcnJvcigiTWF4IGxlbmd0aCBleGNlZWRlZDogVVRGLTggYnl0ZSBsZW5ndGggKCIuY29uY2F0KGJ5dGVMZW5ndGgsICIpID4gbWF4U3RyTGVuZ3RoICgiKS5jb25jYXQodGhpcy5tYXhTdHJMZW5ndGgsICIpIikpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5ieXRlcy5ieXRlTGVuZ3RoIDwgdGhpcy5wb3MgKyBoZWFkZXJPZmZzZXQgKyBieXRlTGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IE1PUkVfREFUQTsKICAgICAgICB9CiAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMucG9zICsgaGVhZGVyT2Zmc2V0OwogICAgICAgIHZhciBvYmplY3Q7CiAgICAgICAgaWYgKHRoaXMuc3RhdGVJc01hcEtleSgpICYmICgoX2EgPSB0aGlzLmtleURlY29kZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jYW5CZUNhY2hlZChieXRlTGVuZ3RoKSkpIHsKICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5rZXlEZWNvZGVyLmRlY29kZSh0aGlzLmJ5dGVzLCBvZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9iamVjdCA9IHV0ZjhEZWNvZGUodGhpcy5ieXRlcywgb2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5wb3MgKz0gaGVhZGVyT2Zmc2V0ICsgYnl0ZUxlbmd0aDsKICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLnN0YXRlSXNNYXBLZXkgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLnR5cGUgPT09IFNUQVRFX01BUF9LRVk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaW5hcnkgPSBmdW5jdGlvbihieXRlTGVuZ3RoLCBoZWFkT2Zmc2V0KSB7CiAgICAgICAgaWYgKGJ5dGVMZW5ndGggPiB0aGlzLm1heEJpbkxlbmd0aCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRGVjb2RlRXJyb3IoIk1heCBsZW5ndGggZXhjZWVkZWQ6IGJpbiBsZW5ndGggKCIuY29uY2F0KGJ5dGVMZW5ndGgsICIpID4gbWF4QmluTGVuZ3RoICgiKS5jb25jYXQodGhpcy5tYXhCaW5MZW5ndGgsICIpIikpOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuaGFzUmVtYWluaW5nKGJ5dGVMZW5ndGggKyBoZWFkT2Zmc2V0KSkgewogICAgICAgICAgICB0aHJvdyBNT1JFX0RBVEE7CiAgICAgICAgfQogICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLnBvcyArIGhlYWRPZmZzZXQ7CiAgICAgICAgdmFyIG9iamVjdCA9IHRoaXMuYnl0ZXMuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBieXRlTGVuZ3RoKTsKICAgICAgICB0aGlzLnBvcyArPSBoZWFkT2Zmc2V0ICsgYnl0ZUxlbmd0aDsKICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLmRlY29kZUV4dGVuc2lvbiA9IGZ1bmN0aW9uKHNpemUsIGhlYWRPZmZzZXQpIHsKICAgICAgICBpZiAoc2l6ZSA+IHRoaXMubWF4RXh0TGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVFcnJvcigiTWF4IGxlbmd0aCBleGNlZWRlZDogZXh0IGxlbmd0aCAoIi5jb25jYXQoc2l6ZSwgIikgPiBtYXhFeHRMZW5ndGggKCIpLmNvbmNhdCh0aGlzLm1heEV4dExlbmd0aCwgIikiKSk7CiAgICAgICAgfQogICAgICAgIHZhciBleHRUeXBlID0gdGhpcy52aWV3LmdldEludDgodGhpcy5wb3MgKyBoZWFkT2Zmc2V0KTsKICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZGVjb2RlQmluYXJ5KHNpemUsIGhlYWRPZmZzZXQgKyAxKTsKICAgICAgICByZXR1cm4gdGhpcy5leHRlbnNpb25Db2RlYy5kZWNvZGUoZGF0YSwgZXh0VHlwZSwgdGhpcy5jb250ZXh0KTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5sb29rVTggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQ4KHRoaXMucG9zKTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5sb29rVTE2ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmlldy5nZXRVaW50MTYodGhpcy5wb3MpOwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLmxvb2tVMzIgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQzMih0aGlzLnBvcyk7CiAgICB9OwogICAgRGVjb2Rlci5wcm90b3R5cGUucmVhZFU4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy52aWV3LmdldFVpbnQ4KHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcysrOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5yZWFkSTggPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0SW50OCh0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MrKzsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9OwogICAgRGVjb2Rlci5wcm90b3R5cGUucmVhZFUxNiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmlldy5nZXRVaW50MTYodGhpcy5wb3MpOwogICAgICAgIHRoaXMucG9zICs9IDI7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLnJlYWRJMTYgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0SW50MTYodGhpcy5wb3MpOwogICAgICAgIHRoaXMucG9zICs9IDI7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLnJlYWRVMzIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0VWludDMyKHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA0OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5yZWFkSTMyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy52aWV3LmdldEludDMyKHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA0OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5yZWFkVTY0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHZhbHVlID0gZ2V0VWludDY0KHRoaXMudmlldywgdGhpcy5wb3MpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLnJlYWRJNjQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdmFsdWUgPSBnZXRJbnQ2NCh0aGlzLnZpZXcsIHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5yZWFkVTY0QXNCaWdJbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0QmlnVWludDY0KHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgICBEZWNvZGVyLnByb3RvdHlwZS5yZWFkSTY0QXNCaWdJbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0QmlnSW50NjQodGhpcy5wb3MpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICAgIERlY29kZXIucHJvdG90eXBlLnJlYWRGMzIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0RmxvYXQzMih0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MgKz0gNDsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9OwogICAgRGVjb2Rlci5wcm90b3R5cGUucmVhZEY2NCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmlldy5nZXRGbG9hdDY0KHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgICByZXR1cm4gRGVjb2RlcjsKfSgpOwpmdW5jdGlvbiBkZWNvZGUoYnVmZmVyLCBvcHRpb25zKSB7CiAgICB2YXIgZGVjb2RlciA9IG5ldyBEZWNvZGVyKG9wdGlvbnMpOwogICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKGJ1ZmZlcik7Cn0KdGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yIHx8IGZ1bmN0aW9uKHRoaXNBcmcsIGJvZHkpIHsKICAgIHZhciBfID0gewogICAgICAgIGxhYmVsOiAwLAogICAgICAgIHNlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAodFswXSAmIDEpIHRocm93IHRbMV07CiAgICAgICAgICAgIHJldHVybiB0WzFdOwogICAgICAgIH0sCiAgICAgICAgdHJ5czogW10sCiAgICAgICAgb3BzOiBbXQogICAgfSwgZiwgeSwgdCwgZzsKICAgIHJldHVybiBnID0gewogICAgICAgIG5leHQ6IHZlcmIoMCksCiAgICAgICAgInRocm93IjogdmVyYigxKSwKICAgICAgICAicmV0dXJuIjogdmVyYigyKQogICAgfSwgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KSwgZzsKICAgIGZ1bmN0aW9uIHZlcmIobikgewogICAgICAgIHJldHVybiBmdW5jdGlvbih2KSB7CiAgICAgICAgICAgIHJldHVybiBzdGVwKFsKICAgICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgICB2CiAgICAgICAgICAgIF0pOwogICAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7CiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsKICAgICAgICB3aGlsZShnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pdHJ5IHsKICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVsicmV0dXJuIl0gOiBvcFswXSA/IHlbInRocm93Il0gfHwgKCh0ID0geVsicmV0dXJuIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0OwogICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gWwogICAgICAgICAgICAgICAgb3BbMF0gJiAyLAogICAgICAgICAgICAgICAgdC52YWx1ZQogICAgICAgICAgICBdOwogICAgICAgICAgICBzd2l0Y2gob3BbMF0pewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIHQgPSBvcDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBfLmxhYmVsKys7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9wWzFdLAogICAgICAgICAgICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCsrOwogICAgICAgICAgICAgICAgICAgIHkgPSBvcFsxXTsKICAgICAgICAgICAgICAgICAgICBvcCA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgMAogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgb3AgPSBfLm9wcy5wb3AoKTsKICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF8gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCBvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfLmxhYmVsID0gb3BbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCA9IHRbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF8ubGFiZWwgPSB0WzJdOwogICAgICAgICAgICAgICAgICAgICAgICBfLm9wcy5wdXNoKG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsKICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBvcCA9IFsKICAgICAgICAgICAgICAgIDYsCiAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHkgPSAwOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgZiA9IHQgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwKICAgICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgIH07CiAgICB9Cn07CnZhciBfX2F3YWl0MSA9IHRoaXMgJiYgdGhpcy5fX2F3YWl0IHx8IGZ1bmN0aW9uKHYpIHsKICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdDEgPyAodGhpcy52ID0gdiwgdGhpcykgOiBuZXcgX19hd2FpdDEodik7Cn07CnRoaXMgJiYgdGhpcy5fX2FzeW5jR2VuZXJhdG9yIHx8IGZ1bmN0aW9uKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikgewogICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7CiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdOwogICAgcmV0dXJuIGkgPSB7fSwgdmVyYigibmV4dCIpLCB2ZXJiKCJ0aHJvdyIpLCB2ZXJiKCJyZXR1cm4iKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sIGk7CiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsKICAgICAgICBpZiAoZ1tuXSkgaVtuXSA9IGZ1bmN0aW9uKHYpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHEucHVzaChbCiAgICAgICAgICAgICAgICAgICAgbiwKICAgICAgICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgYgogICAgICAgICAgICAgICAgXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RlcChnW25dKHYpKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHNldHRsZShxWzBdWzNdLCBlKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzdGVwKHIpIHsKICAgICAgICByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdDEgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7CiAgICB9CiAgICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7CiAgICAgICAgcmVzdW1lKCJuZXh0IiwgdmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7CiAgICAgICAgcmVzdW1lKCJ0aHJvdyIsIHZhbHVlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7CiAgICAgICAgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsKICAgIH0KfTsKdGhpcyAmJiB0aGlzLl9fYXdhaXRlciB8fCBmdW5jdGlvbih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHsKICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgICAgICByZXNvbHZlKHZhbHVlKTsKICAgICAgICB9KTsKICAgIH0KICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7CiAgICAgICAgICAgIHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOwogICAgICAgIH0KICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7CiAgICB9KTsKfTsKdGhpcyAmJiB0aGlzLl9fZ2VuZXJhdG9yIHx8IGZ1bmN0aW9uKHRoaXNBcmcsIGJvZHkpIHsKICAgIHZhciBfID0gewogICAgICAgIGxhYmVsOiAwLAogICAgICAgIHNlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAodFswXSAmIDEpIHRocm93IHRbMV07CiAgICAgICAgICAgIHJldHVybiB0WzFdOwogICAgICAgIH0sCiAgICAgICAgdHJ5czogW10sCiAgICAgICAgb3BzOiBbXQogICAgfSwgZiwgeSwgdCwgZzsKICAgIHJldHVybiBnID0gewogICAgICAgIG5leHQ6IHZlcmIoMCksCiAgICAgICAgInRocm93IjogdmVyYigxKSwKICAgICAgICAicmV0dXJuIjogdmVyYigyKQogICAgfSwgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KSwgZzsKICAgIGZ1bmN0aW9uIHZlcmIobikgewogICAgICAgIHJldHVybiBmdW5jdGlvbih2KSB7CiAgICAgICAgICAgIHJldHVybiBzdGVwKFsKICAgICAgICAgICAgICAgIG4sCiAgICAgICAgICAgICAgICB2CiAgICAgICAgICAgIF0pOwogICAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7CiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsKICAgICAgICB3aGlsZShnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pdHJ5IHsKICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVsicmV0dXJuIl0gOiBvcFswXSA/IHlbInRocm93Il0gfHwgKCh0ID0geVsicmV0dXJuIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0OwogICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gWwogICAgICAgICAgICAgICAgb3BbMF0gJiAyLAogICAgICAgICAgICAgICAgdC52YWx1ZQogICAgICAgICAgICBdOwogICAgICAgICAgICBzd2l0Y2gob3BbMF0pewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIHQgPSBvcDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBfLmxhYmVsKys7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9wWzFdLAogICAgICAgICAgICAgICAgICAgICAgICBkb25lOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCsrOwogICAgICAgICAgICAgICAgICAgIHkgPSBvcFsxXTsKICAgICAgICAgICAgICAgICAgICBvcCA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgMAogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgb3AgPSBfLm9wcy5wb3AoKTsKICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF8gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCBvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfLmxhYmVsID0gb3BbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5sYWJlbCA9IHRbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF8ubGFiZWwgPSB0WzJdOwogICAgICAgICAgICAgICAgICAgICAgICBfLm9wcy5wdXNoKG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTsKICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBvcCA9IFsKICAgICAgICAgICAgICAgIDYsCiAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHkgPSAwOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgZiA9IHQgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwKICAgICAgICAgICAgZG9uZTogdHJ1ZQogICAgICAgIH07CiAgICB9Cn07CmZ1bmN0aW9uIF9lKGUpIHsKICAgIGxldCBpID0gZS5sZW5ndGg7CiAgICBmb3IoOyAtLWkgPj0gMDspZVtpXSA9IDA7Cn0KdmFyICRpID0gMCwgYWkgPSAxLCBDaSA9IDIsIEZpID0gMywgTWkgPSAyNTgsIGR0ID0gMjksIEFlID0gMjU2LCBnZSA9IEFlICsgMSArIGR0LCBvZSA9IDMwLCBzdCA9IDE5LCBuaSA9IDIgKiBnZSArIDEsIFEgPSAxNSwgR2UgPSAxNiwgSGkgPSA3LCBjdCA9IDI1NiwgbGkgPSAxNiwgcmkgPSAxNywgZmkgPSAxOCwgZnQgPSBuZXcgVWludDhBcnJheShbCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDEsCiAgICAxLAogICAgMSwKICAgIDEsCiAgICAyLAogICAgMiwKICAgIDIsCiAgICAyLAogICAgMywKICAgIDMsCiAgICAzLAogICAgMywKICAgIDQsCiAgICA0LAogICAgNCwKICAgIDQsCiAgICA1LAogICAgNSwKICAgIDUsCiAgICA1LAogICAgMApdKSwgJGUgPSBuZXcgVWludDhBcnJheShbCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMSwKICAgIDEsCiAgICAyLAogICAgMiwKICAgIDMsCiAgICAzLAogICAgNCwKICAgIDQsCiAgICA1LAogICAgNSwKICAgIDYsCiAgICA2LAogICAgNywKICAgIDcsCiAgICA4LAogICAgOCwKICAgIDksCiAgICA5LAogICAgMTAsCiAgICAxMCwKICAgIDExLAogICAgMTEsCiAgICAxMiwKICAgIDEyLAogICAgMTMsCiAgICAxMwpdKSwgQmkgPSBuZXcgVWludDhBcnJheShbCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMiwKICAgIDMsCiAgICA3Cl0pLCBvaSA9IG5ldyBVaW50OEFycmF5KFsKICAgIDE2LAogICAgMTcsCiAgICAxOCwKICAgIDAsCiAgICA4LAogICAgNywKICAgIDksCiAgICA2LAogICAgMTAsCiAgICA1LAogICAgMTEsCiAgICA0LAogICAgMTIsCiAgICAzLAogICAgMTMsCiAgICAyLAogICAgMTQsCiAgICAxLAogICAgMTUKXSksIEtpID0gNTEyLCBCID0gbmV3IEFycmF5KChnZSArIDIpICogMik7Cl9lKEIpOwp2YXIgdWUgPSBuZXcgQXJyYXkob2UgKiAyKTsKX2UodWUpOwp2YXIgcGUgPSBuZXcgQXJyYXkoS2kpOwpfZShwZSk7CnZhciB4ZSA9IG5ldyBBcnJheShNaSAtIEZpICsgMSk7Cl9lKHhlKTsKdmFyIHV0ID0gbmV3IEFycmF5KGR0KTsKX2UodXQpOwp2YXIgSGUgPSBuZXcgQXJyYXkob2UpOwpfZShIZSk7CmZ1bmN0aW9uIGplKGUsIGksIHQsIG4sIGEpIHsKICAgIHRoaXMuc3RhdGljX3RyZWUgPSBlLCB0aGlzLmV4dHJhX2JpdHMgPSBpLCB0aGlzLmV4dHJhX2Jhc2UgPSB0LCB0aGlzLmVsZW1zID0gbiwgdGhpcy5tYXhfbGVuZ3RoID0gYSwgdGhpcy5oYXNfc3RyZWUgPSBlICYmIGUubGVuZ3RoOwp9CnZhciBfaSwgaGksIGRpOwpmdW5jdGlvbiBXZShlLCBpKSB7CiAgICB0aGlzLmR5bl90cmVlID0gZSwgdGhpcy5tYXhfY29kZSA9IDAsIHRoaXMuc3RhdF9kZXNjID0gaTsKfQp2YXIgc2kgPSAoZSk9PmUgPCAyNTYgPyBwZVtlXSA6IHBlWzI1NiArIChlID4+PiA3KV0sIGtlID0gKGUsIGkpPT57CiAgICBlLnBlbmRpbmdfYnVmW2UucGVuZGluZysrXSA9IGkgJiAyNTUsIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaSA+Pj4gOCAmIDI1NTsKfSwgTiA9IChlLCBpLCB0KT0+ewogICAgZS5iaV92YWxpZCA+IEdlIC0gdCA/IChlLmJpX2J1ZiB8PSBpIDw8IGUuYmlfdmFsaWQgJiA2NTUzNSwga2UoZSwgZS5iaV9idWYpLCBlLmJpX2J1ZiA9IGkgPj4gR2UgLSBlLmJpX3ZhbGlkLCBlLmJpX3ZhbGlkICs9IHQgLSBHZSkgOiAoZS5iaV9idWYgfD0gaSA8PCBlLmJpX3ZhbGlkICYgNjU1MzUsIGUuYmlfdmFsaWQgKz0gdCk7Cn0sIEYgPSAoZSwgaSwgdCk9PnsKICAgIE4oZSwgdFtpICogMl0sIHRbaSAqIDIgKyAxXSk7Cn0sIGNpID0gKGUsIGkpPT57CiAgICBsZXQgdCA9IDA7CiAgICBkbyB0IHw9IGUgJiAxLCBlID4+Pj0gMSwgdCA8PD0gMTsKICAgIHdoaWxlICgtLWkgPiAwKQogICAgcmV0dXJuIHQgPj4+IDE7Cn0sIFBpID0gKGUpPT57CiAgICBlLmJpX3ZhbGlkID09PSAxNiA/IChrZShlLCBlLmJpX2J1ZiksIGUuYmlfYnVmID0gMCwgZS5iaV92YWxpZCA9IDApIDogZS5iaV92YWxpZCA+PSA4ICYmIChlLnBlbmRpbmdfYnVmW2UucGVuZGluZysrXSA9IGUuYmlfYnVmICYgMjU1LCBlLmJpX2J1ZiA+Pj0gOCwgZS5iaV92YWxpZCAtPSA4KTsKfSwgWGkgPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gaS5keW5fdHJlZSwgbiA9IGkubWF4X2NvZGUsIGEgPSBpLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSwgbCA9IGkuc3RhdF9kZXNjLmhhc19zdHJlZSwgbyA9IGkuc3RhdF9kZXNjLmV4dHJhX2JpdHMsIGYgPSBpLnN0YXRfZGVzYy5leHRyYV9iYXNlLCBjID0gaS5zdGF0X2Rlc2MubWF4X2xlbmd0aCwgciwgXywgRSwgcywgaCwgdSwgbSA9IDA7CiAgICBmb3IocyA9IDA7IHMgPD0gUTsgcysrKWUuYmxfY291bnRbc10gPSAwOwogICAgZm9yKHRbZS5oZWFwW2UuaGVhcF9tYXhdICogMiArIDFdID0gMCwgciA9IGUuaGVhcF9tYXggKyAxOyByIDwgbmk7IHIrKylfID0gZS5oZWFwW3JdLCBzID0gdFt0W18gKiAyICsgMV0gKiAyICsgMV0gKyAxLCBzID4gYyAmJiAocyA9IGMsIG0rKyksIHRbXyAqIDIgKyAxXSA9IHMsICEoXyA+IG4pICYmIChlLmJsX2NvdW50W3NdKyssIGggPSAwLCBfID49IGYgJiYgKGggPSBvW18gLSBmXSksIHUgPSB0W18gKiAyXSwgZS5vcHRfbGVuICs9IHUgKiAocyArIGgpLCBsICYmIChlLnN0YXRpY19sZW4gKz0gdSAqIChhW18gKiAyICsgMV0gKyBoKSkpOwogICAgaWYgKG0gIT09IDApIHsKICAgICAgICBkbyB7CiAgICAgICAgICAgIGZvcihzID0gYyAtIDE7IGUuYmxfY291bnRbc10gPT09IDA7KXMtLTsKICAgICAgICAgICAgZS5ibF9jb3VudFtzXS0tLCBlLmJsX2NvdW50W3MgKyAxXSArPSAyLCBlLmJsX2NvdW50W2NdLS0sIG0gLT0gMjsKICAgICAgICB9d2hpbGUgKG0gPiAwKQogICAgICAgIGZvcihzID0gYzsgcyAhPT0gMDsgcy0tKWZvcihfID0gZS5ibF9jb3VudFtzXTsgXyAhPT0gMDspRSA9IGUuaGVhcFstLXJdLCAhKEUgPiBuKSAmJiAodFtFICogMiArIDFdICE9PSBzICYmIChlLm9wdF9sZW4gKz0gKHMgLSB0W0UgKiAyICsgMV0pICogdFtFICogMl0sIHRbRSAqIDIgKyAxXSA9IHMpLCBfLS0pOwogICAgfQp9LCB1aSA9IChlLCBpLCB0KT0+ewogICAgbGV0IG4gPSBuZXcgQXJyYXkoUSArIDEpLCBhID0gMCwgbCwgbzsKICAgIGZvcihsID0gMTsgbCA8PSBROyBsKyspbltsXSA9IGEgPSBhICsgdFtsIC0gMV0gPDwgMTsKICAgIGZvcihvID0gMDsgbyA8PSBpOyBvKyspewogICAgICAgIGxldCBmID0gZVtvICogMiArIDFdOwogICAgICAgIGYgIT09IDAgJiYgKGVbbyAqIDJdID0gY2kobltmXSsrLCBmKSk7CiAgICB9Cn0sIFlpID0gKCk9PnsKICAgIGxldCBlLCBpLCB0LCBuLCBhLCBsID0gbmV3IEFycmF5KFEgKyAxKTsKICAgIGZvcih0ID0gMCwgbiA9IDA7IG4gPCBkdCAtIDE7IG4rKylmb3IodXRbbl0gPSB0LCBlID0gMDsgZSA8IDEgPDwgZnRbbl07IGUrKyl4ZVt0KytdID0gbjsKICAgIGZvcih4ZVt0IC0gMV0gPSBuLCBhID0gMCwgbiA9IDA7IG4gPCAxNjsgbisrKWZvcihIZVtuXSA9IGEsIGUgPSAwOyBlIDwgMSA8PCAkZVtuXTsgZSsrKXBlW2ErK10gPSBuOwogICAgZm9yKGEgPj49IDc7IG4gPCBvZTsgbisrKWZvcihIZVtuXSA9IGEgPDwgNywgZSA9IDA7IGUgPCAxIDw8ICRlW25dIC0gNzsgZSsrKXBlWzI1NiArIGErK10gPSBuOwogICAgZm9yKGkgPSAwOyBpIDw9IFE7IGkrKylsW2ldID0gMDsKICAgIGZvcihlID0gMDsgZSA8PSAxNDM7KUJbZSAqIDIgKyAxXSA9IDgsIGUrKywgbFs4XSsrOwogICAgZm9yKDsgZSA8PSAyNTU7KUJbZSAqIDIgKyAxXSA9IDksIGUrKywgbFs5XSsrOwogICAgZm9yKDsgZSA8PSAyNzk7KUJbZSAqIDIgKyAxXSA9IDcsIGUrKywgbFs3XSsrOwogICAgZm9yKDsgZSA8PSAyODc7KUJbZSAqIDIgKyAxXSA9IDgsIGUrKywgbFs4XSsrOwogICAgZm9yKHVpKEIsIGdlICsgMSwgbCksIGUgPSAwOyBlIDwgb2U7IGUrKyl1ZVtlICogMiArIDFdID0gNSwgdWVbZSAqIDJdID0gY2koZSwgNSk7CiAgICBfaSA9IG5ldyBqZShCLCBmdCwgQWUgKyAxLCBnZSwgUSksIGhpID0gbmV3IGplKHVlLCAkZSwgMCwgb2UsIFEpLCBkaSA9IG5ldyBqZShuZXcgQXJyYXkoMCksIEJpLCAwLCBzdCwgSGkpOwp9LCBiaSA9IChlKT0+ewogICAgbGV0IGk7CiAgICBmb3IoaSA9IDA7IGkgPCBnZTsgaSsrKWUuZHluX2x0cmVlW2kgKiAyXSA9IDA7CiAgICBmb3IoaSA9IDA7IGkgPCBvZTsgaSsrKWUuZHluX2R0cmVlW2kgKiAyXSA9IDA7CiAgICBmb3IoaSA9IDA7IGkgPCBzdDsgaSsrKWUuYmxfdHJlZVtpICogMl0gPSAwOwogICAgZS5keW5fbHRyZWVbY3QgKiAyXSA9IDEsIGUub3B0X2xlbiA9IGUuc3RhdGljX2xlbiA9IDAsIGUubGFzdF9saXQgPSBlLm1hdGNoZXMgPSAwOwp9LCB3aSA9IChlKT0+ewogICAgZS5iaV92YWxpZCA+IDggPyBrZShlLCBlLmJpX2J1ZikgOiBlLmJpX3ZhbGlkID4gMCAmJiAoZS5wZW5kaW5nX2J1ZltlLnBlbmRpbmcrK10gPSBlLmJpX2J1ZiksIGUuYmlfYnVmID0gMCwgZS5iaV92YWxpZCA9IDA7Cn0sIEdpID0gKGUsIGksIHQsIG4pPT57CiAgICB3aShlKSwgbiAmJiAoa2UoZSwgdCksIGtlKGUsIH50KSksIGUucGVuZGluZ19idWYuc2V0KGUud2luZG93LnN1YmFycmF5KGksIGkgKyB0KSwgZS5wZW5kaW5nKSwgZS5wZW5kaW5nICs9IHQ7Cn0sIHh0ID0gKGUsIGksIHQsIG4pPT57CiAgICBsZXQgYSA9IGkgKiAyLCBsID0gdCAqIDI7CiAgICByZXR1cm4gZVthXSA8IGVbbF0gfHwgZVthXSA9PT0gZVtsXSAmJiBuW2ldIDw9IG5bdF07Cn0sIFZlID0gKGUsIGksIHQpPT57CiAgICBsZXQgbiA9IGUuaGVhcFt0XSwgYSA9IHQgPDwgMTsKICAgIGZvcig7IGEgPD0gZS5oZWFwX2xlbiAmJiAoYSA8IGUuaGVhcF9sZW4gJiYgeHQoaSwgZS5oZWFwW2EgKyAxXSwgZS5oZWFwW2FdLCBlLmRlcHRoKSAmJiBhKyssICF4dChpLCBuLCBlLmhlYXBbYV0sIGUuZGVwdGgpKTspZS5oZWFwW3RdID0gZS5oZWFwW2FdLCB0ID0gYSwgYSA8PD0gMTsKICAgIGUuaGVhcFt0XSA9IG47Cn0sIGt0ID0gKGUsIGksIHQpPT57CiAgICBsZXQgbiwgYSwgbCA9IDAsIG8sIGY7CiAgICBpZiAoZS5sYXN0X2xpdCAhPT0gMCkgZG8gbiA9IGUucGVuZGluZ19idWZbZS5kX2J1ZiArIGwgKiAyXSA8PCA4IHwgZS5wZW5kaW5nX2J1ZltlLmRfYnVmICsgbCAqIDIgKyAxXSwgYSA9IGUucGVuZGluZ19idWZbZS5sX2J1ZiArIGxdLCBsKyssIG4gPT09IDAgPyBGKGUsIGEsIGkpIDogKG8gPSB4ZVthXSwgRihlLCBvICsgQWUgKyAxLCBpKSwgZiA9IGZ0W29dLCBmICE9PSAwICYmIChhIC09IHV0W29dLCBOKGUsIGEsIGYpKSwgbi0tLCBvID0gc2kobiksIEYoZSwgbywgdCksIGYgPSAkZVtvXSwgZiAhPT0gMCAmJiAobiAtPSBIZVtvXSwgTihlLCBuLCBmKSkpOwogICAgd2hpbGUgKGwgPCBlLmxhc3RfbGl0KQogICAgRihlLCBjdCwgaSk7Cn0sIG90ID0gKGUsIGkpPT57CiAgICBsZXQgdCA9IGkuZHluX3RyZWUsIG4gPSBpLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSwgYSA9IGkuc3RhdF9kZXNjLmhhc19zdHJlZSwgbCA9IGkuc3RhdF9kZXNjLmVsZW1zLCBvLCBmLCBjID0gLTEsIHI7CiAgICBmb3IoZS5oZWFwX2xlbiA9IDAsIGUuaGVhcF9tYXggPSBuaSwgbyA9IDA7IG8gPCBsOyBvKyspdFtvICogMl0gIT09IDAgPyAoZS5oZWFwWysrZS5oZWFwX2xlbl0gPSBjID0gbywgZS5kZXB0aFtvXSA9IDApIDogdFtvICogMiArIDFdID0gMDsKICAgIGZvcig7IGUuaGVhcF9sZW4gPCAyOylyID0gZS5oZWFwWysrZS5oZWFwX2xlbl0gPSBjIDwgMiA/ICsrYyA6IDAsIHRbciAqIDJdID0gMSwgZS5kZXB0aFtyXSA9IDAsIGUub3B0X2xlbi0tLCBhICYmIChlLnN0YXRpY19sZW4gLT0gbltyICogMiArIDFdKTsKICAgIGZvcihpLm1heF9jb2RlID0gYywgbyA9IGUuaGVhcF9sZW4gPj4gMTsgbyA+PSAxOyBvLS0pVmUoZSwgdCwgbyk7CiAgICByID0gbDsKICAgIGRvIG8gPSBlLmhlYXBbMV0sIGUuaGVhcFsxXSA9IGUuaGVhcFtlLmhlYXBfbGVuLS1dLCBWZShlLCB0LCAxKSwgZiA9IGUuaGVhcFsxXSwgZS5oZWFwWy0tZS5oZWFwX21heF0gPSBvLCBlLmhlYXBbLS1lLmhlYXBfbWF4XSA9IGYsIHRbciAqIDJdID0gdFtvICogMl0gKyB0W2YgKiAyXSwgZS5kZXB0aFtyXSA9IChlLmRlcHRoW29dID49IGUuZGVwdGhbZl0gPyBlLmRlcHRoW29dIDogZS5kZXB0aFtmXSkgKyAxLCB0W28gKiAyICsgMV0gPSB0W2YgKiAyICsgMV0gPSByLCBlLmhlYXBbMV0gPSByKyssIFZlKGUsIHQsIDEpOwogICAgd2hpbGUgKGUuaGVhcF9sZW4gPj0gMikKICAgIGUuaGVhcFstLWUuaGVhcF9tYXhdID0gZS5oZWFwWzFdLCBYaShlLCBpKSwgdWkodCwgYywgZS5ibF9jb3VudCk7Cn0sIHZ0ID0gKGUsIGksIHQpPT57CiAgICBsZXQgbiwgYSA9IC0xLCBsLCBvID0gaVswICogMiArIDFdLCBmID0gMCwgYyA9IDcsIHIgPSA0OwogICAgZm9yKG8gPT09IDAgJiYgKGMgPSAxMzgsIHIgPSAzKSwgaVsodCArIDEpICogMiArIDFdID0gNjU1MzUsIG4gPSAwOyBuIDw9IHQ7IG4rKylsID0gbywgbyA9IGlbKG4gKyAxKSAqIDIgKyAxXSwgISgrK2YgPCBjICYmIGwgPT09IG8pICYmIChmIDwgciA/IGUuYmxfdHJlZVtsICogMl0gKz0gZiA6IGwgIT09IDAgPyAobCAhPT0gYSAmJiBlLmJsX3RyZWVbbCAqIDJdKyssIGUuYmxfdHJlZVtsaSAqIDJdKyspIDogZiA8PSAxMCA/IGUuYmxfdHJlZVtyaSAqIDJdKysgOiBlLmJsX3RyZWVbZmkgKiAyXSsrLCBmID0gMCwgYSA9IGwsIG8gPT09IDAgPyAoYyA9IDEzOCwgciA9IDMpIDogbCA9PT0gbyA/IChjID0gNiwgciA9IDMpIDogKGMgPSA3LCByID0gNCkpOwp9LCBFdCA9IChlLCBpLCB0KT0+ewogICAgbGV0IG4sIGEgPSAtMSwgbCwgbyA9IGlbMCAqIDIgKyAxXSwgZiA9IDAsIGMgPSA3LCByID0gNDsKICAgIGZvcihvID09PSAwICYmIChjID0gMTM4LCByID0gMyksIG4gPSAwOyBuIDw9IHQ7IG4rKylpZiAobCA9IG8sIG8gPSBpWyhuICsgMSkgKiAyICsgMV0sICEoKytmIDwgYyAmJiBsID09PSBvKSkgewogICAgICAgIGlmIChmIDwgcikgZG8gRihlLCBsLCBlLmJsX3RyZWUpOwogICAgICAgIHdoaWxlICgtLWYgIT09IDApCiAgICAgICAgZWxzZSBsICE9PSAwID8gKGwgIT09IGEgJiYgKEYoZSwgbCwgZS5ibF90cmVlKSwgZi0tKSwgRihlLCBsaSwgZS5ibF90cmVlKSwgTihlLCBmIC0gMywgMikpIDogZiA8PSAxMCA/IChGKGUsIHJpLCBlLmJsX3RyZWUpLCBOKGUsIGYgLSAzLCAzKSkgOiAoRihlLCBmaSwgZS5ibF90cmVlKSwgTihlLCBmIC0gMTEsIDcpKTsKICAgICAgICBmID0gMCwgYSA9IGwsIG8gPT09IDAgPyAoYyA9IDEzOCwgciA9IDMpIDogbCA9PT0gbyA/IChjID0gNiwgciA9IDMpIDogKGMgPSA3LCByID0gNCk7CiAgICB9Cn0sIGppID0gKGUpPT57CiAgICBsZXQgaTsKICAgIGZvcih2dChlLCBlLmR5bl9sdHJlZSwgZS5sX2Rlc2MubWF4X2NvZGUpLCB2dChlLCBlLmR5bl9kdHJlZSwgZS5kX2Rlc2MubWF4X2NvZGUpLCBvdChlLCBlLmJsX2Rlc2MpLCBpID0gc3QgLSAxOyBpID49IDMgJiYgZS5ibF90cmVlW29pW2ldICogMiArIDFdID09PSAwOyBpLS0pOwogICAgcmV0dXJuIGUub3B0X2xlbiArPSAzICogKGkgKyAxKSArIDUgKyA1ICsgNCwgaTsKfSwgV2kgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhOwogICAgZm9yKE4oZSwgaSAtIDI1NywgNSksIE4oZSwgdCAtIDEsIDUpLCBOKGUsIG4gLSA0LCA0KSwgYSA9IDA7IGEgPCBuOyBhKyspTihlLCBlLmJsX3RyZWVbb2lbYV0gKiAyICsgMV0sIDMpOwogICAgRXQoZSwgZS5keW5fbHRyZWUsIGkgLSAxKSwgRXQoZSwgZS5keW5fZHRyZWUsIHQgLSAxKTsKfSwgVmkgPSAoZSk9PnsKICAgIGxldCBpID0gNDA5MzYyNDQ0NywgdDsKICAgIGZvcih0ID0gMDsgdCA8PSAzMTsgdCsrLCBpID4+Pj0gMSlpZiAoaSAmIDEgJiYgZS5keW5fbHRyZWVbdCAqIDJdICE9PSAwKSByZXR1cm4gMDsKICAgIGlmIChlLmR5bl9sdHJlZVs5ICogMl0gIT09IDAgfHwgZS5keW5fbHRyZWVbMTAgKiAyXSAhPT0gMCB8fCBlLmR5bl9sdHJlZVsxMyAqIDJdICE9PSAwKSByZXR1cm4gMTsKICAgIGZvcih0ID0gMzI7IHQgPCBBZTsgdCsrKWlmIChlLmR5bl9sdHJlZVt0ICogMl0gIT09IDApIHJldHVybiAxOwogICAgcmV0dXJuIDA7Cn0sIHl0ID0gITEsIEppID0gKGUpPT57CiAgICB5dCB8fCAoWWkoKSwgeXQgPSAhMCksIGUubF9kZXNjID0gbmV3IFdlKGUuZHluX2x0cmVlLCBfaSksIGUuZF9kZXNjID0gbmV3IFdlKGUuZHluX2R0cmVlLCBoaSksIGUuYmxfZGVzYyA9IG5ldyBXZShlLmJsX3RyZWUsIGRpKSwgZS5iaV9idWYgPSAwLCBlLmJpX3ZhbGlkID0gMCwgYmkoZSk7Cn0sIGdpID0gKGUsIGksIHQsIG4pPT57CiAgICBOKGUsICgkaSA8PCAxKSArIChuID8gMSA6IDApLCAzKSwgR2koZSwgaSwgdCwgITApOwp9LCBRaSA9IChlKT0+ewogICAgTihlLCBhaSA8PCAxLCAzKSwgRihlLCBjdCwgQiksIFBpKGUpOwp9LCBxaSA9IChlLCBpLCB0LCBuKT0+ewogICAgbGV0IGEsIGwsIG8gPSAwOwogICAgZS5sZXZlbCA+IDAgPyAoZS5zdHJtLmRhdGFfdHlwZSA9PT0gMiAmJiAoZS5zdHJtLmRhdGFfdHlwZSA9IFZpKGUpKSwgb3QoZSwgZS5sX2Rlc2MpLCBvdChlLCBlLmRfZGVzYyksIG8gPSBqaShlKSwgYSA9IGUub3B0X2xlbiArIDMgKyA3ID4+PiAzLCBsID0gZS5zdGF0aWNfbGVuICsgMyArIDcgPj4+IDMsIGwgPD0gYSAmJiAoYSA9IGwpKSA6IGEgPSBsID0gdCArIDUsIHQgKyA0IDw9IGEgJiYgaSAhPT0gLTEgPyBnaShlLCBpLCB0LCBuKSA6IGUuc3RyYXRlZ3kgPT09IDQgfHwgbCA9PT0gYSA/IChOKGUsIChhaSA8PCAxKSArIChuID8gMSA6IDApLCAzKSwga3QoZSwgQiwgdWUpKSA6IChOKGUsIChDaSA8PCAxKSArIChuID8gMSA6IDApLCAzKSwgV2koZSwgZS5sX2Rlc2MubWF4X2NvZGUgKyAxLCBlLmRfZGVzYy5tYXhfY29kZSArIDEsIG8gKyAxKSwga3QoZSwgZS5keW5fbHRyZWUsIGUuZHluX2R0cmVlKSksIGJpKGUpLCBuICYmIHdpKGUpOwp9LCBlYSA9IChlLCBpLCB0KT0+KGUucGVuZGluZ19idWZbZS5kX2J1ZiArIGUubGFzdF9saXQgKiAyXSA9IGkgPj4+IDggJiAyNTUsIGUucGVuZGluZ19idWZbZS5kX2J1ZiArIGUubGFzdF9saXQgKiAyICsgMV0gPSBpICYgMjU1LCBlLnBlbmRpbmdfYnVmW2UubF9idWYgKyBlLmxhc3RfbGl0XSA9IHQgJiAyNTUsIGUubGFzdF9saXQrKywgaSA9PT0gMCA/IGUuZHluX2x0cmVlW3QgKiAyXSsrIDogKGUubWF0Y2hlcysrLCBpLS0sIGUuZHluX2x0cmVlWyh4ZVt0XSArIEFlICsgMSkgKiAyXSsrLCBlLmR5bl9kdHJlZVtzaShpKSAqIDJdKyspLCBlLmxhc3RfbGl0ID09PSBlLmxpdF9idWZzaXplIC0gMSksIHRhID0gSmksIGlhID0gZ2ksIGFhID0gcWksIG5hID0gZWEsIGxhID0gUWksIHJhID0gewogICAgX3RyX2luaXQ6IHRhLAogICAgX3RyX3N0b3JlZF9ibG9jazogaWEsCiAgICBfdHJfZmx1c2hfYmxvY2s6IGFhLAogICAgX3RyX3RhbGx5OiBuYSwKICAgIF90cl9hbGlnbjogbGEKfSwgZmEgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhID0gZSAmIDY1NTM1IHwgMCwgbCA9IGUgPj4+IDE2ICYgNjU1MzUgfCAwLCBvID0gMDsKICAgIGZvcig7IHQgIT09IDA7KXsKICAgICAgICBvID0gdCA+IDJlMyA/IDJlMyA6IHQsIHQgLT0gbzsKICAgICAgICBkbyBhID0gYSArIGlbbisrXSB8IDAsIGwgPSBsICsgYSB8IDA7CiAgICAgICAgd2hpbGUgKC0tbykKICAgICAgICBhICU9IDY1NTIxLCBsICU9IDY1NTIxOwogICAgfQogICAgcmV0dXJuIGEgfCBsIDw8IDE2IHwgMDsKfSwgdmUgPSBmYSwgb2EgPSAoKT0+ewogICAgbGV0IGUsIGkgPSBbXTsKICAgIGZvcih2YXIgdCA9IDA7IHQgPCAyNTY7IHQrKyl7CiAgICAgICAgZSA9IHQ7CiAgICAgICAgZm9yKHZhciBuID0gMDsgbiA8IDg7IG4rKyllID0gZSAmIDEgPyAzOTg4MjkyMzg0IF4gZSA+Pj4gMSA6IGUgPj4+IDE7CiAgICAgICAgaVt0XSA9IGU7CiAgICB9CiAgICByZXR1cm4gaTsKfSwgX2EgPSBuZXcgVWludDMyQXJyYXkob2EoKSksIGhhID0gKGUsIGksIHQsIG4pPT57CiAgICBsZXQgYSA9IF9hLCBsID0gbiArIHQ7CiAgICBlIF49IC0xOwogICAgZm9yKGxldCBvID0gbjsgbyA8IGw7IG8rKyllID0gZSA+Pj4gOCBeIGFbKGUgXiBpW29dKSAmIDI1NV07CiAgICByZXR1cm4gZSBeIC0xOwp9LCBJID0gaGEsIGVlID0gewogICAgMjogIm5lZWQgZGljdGlvbmFyeSIsCiAgICAxOiAic3RyZWFtIGVuZCIsCiAgICAwOiAiIiwKICAgICItMSI6ICJmaWxlIGVycm9yIiwKICAgICItMiI6ICJzdHJlYW0gZXJyb3IiLAogICAgIi0zIjogImRhdGEgZXJyb3IiLAogICAgIi00IjogImluc3VmZmljaWVudCBtZW1vcnkiLAogICAgIi01IjogImJ1ZmZlciBlcnJvciIsCiAgICAiLTYiOiAiaW5jb21wYXRpYmxlIHZlcnNpb24iCn0sIG5lID0gewogICAgWl9OT19GTFVTSDogMCwKICAgIFpfUEFSVElBTF9GTFVTSDogMSwKICAgIFpfU1lOQ19GTFVTSDogMiwKICAgIFpfRlVMTF9GTFVTSDogMywKICAgIFpfRklOSVNIOiA0LAogICAgWl9CTE9DSzogNSwKICAgIFpfVFJFRVM6IDYsCiAgICBaX09LOiAwLAogICAgWl9TVFJFQU1fRU5EOiAxLAogICAgWl9ORUVEX0RJQ1Q6IDIsCiAgICBaX0VSUk5POiAtMSwKICAgIFpfU1RSRUFNX0VSUk9SOiAtMiwKICAgIFpfREFUQV9FUlJPUjogLTMsCiAgICBaX01FTV9FUlJPUjogLTQsCiAgICBaX0JVRl9FUlJPUjogLTUsCiAgICBaX05PX0NPTVBSRVNTSU9OOiAwLAogICAgWl9CRVNUX1NQRUVEOiAxLAogICAgWl9CRVNUX0NPTVBSRVNTSU9OOiA5LAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiAtMSwKICAgIFpfRklMVEVSRUQ6IDEsCiAgICBaX0hVRkZNQU5fT05MWTogMiwKICAgIFpfUkxFOiAzLAogICAgWl9GSVhFRDogNCwKICAgIFpfREVGQVVMVF9TVFJBVEVHWTogMCwKICAgIFpfQklOQVJZOiAwLAogICAgWl9URVhUOiAxLAogICAgWl9VTktOT1dOOiAyLAogICAgWl9ERUZMQVRFRDogOAp9LCB7IF90cl9pbml0OiBkYSAsIF90cl9zdG9yZWRfYmxvY2s6IHNhICwgX3RyX2ZsdXNoX2Jsb2NrOiBjYSAsIF90cl90YWxseTogaiAsIF90cl9hbGlnbjogdWEgIH0gPSByYSwgeyBaX05PX0ZMVVNIOiBsZSAsIFpfUEFSVElBTF9GTFVTSDogYmEgLCBaX0ZVTExfRkxVU0g6IHdhICwgWl9GSU5JU0g6IFcgLCBaX0JMT0NLOiBTdCAsIFpfT0s6IE0gLCBaX1NUUkVBTV9FTkQ6IEF0ICwgWl9TVFJFQU1fRVJST1I6IEwgLCBaX0RBVEFfRVJST1I6IGdhICwgWl9CVUZfRVJST1I6IEplICwgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiBwYSAsIFpfRklMVEVSRUQ6IHhhICwgWl9IVUZGTUFOX09OTFk6IEllICwgWl9STEU6IGthICwgWl9GSVhFRDogdmEgLCBaX0RFRkFVTFRfU1RSQVRFR1k6IEVhICwgWl9VTktOT1dOOiB5YSAsIFpfREVGTEFURUQ6IFBlICB9ID0gbmUsIFNhID0gOSwgQWEgPSAxNSwgUmEgPSA4LCB6YSA9IDI5LCBUYSA9IDI1NiwgX3QgPSBUYSArIDEgKyB6YSwgbWEgPSAzMCwgRGEgPSAxOSwgWmEgPSAyICogX3QgKyAxLCBJYSA9IDE1LCBrID0gMywgWSA9IDI1OCwgJCA9IFkgKyBrICsgMSwgT2EgPSAzMiwgWGUgPSA0MiwgaHQgPSA2OSwgQ2UgPSA3MywgRmUgPSA5MSwgTWUgPSAxMDMsIHEgPSAxMTMsIHNlID0gNjY2LCBEID0gMSwgUmUgPSAyLCB0ZSA9IDMsIGhlID0gNCwgTmEgPSAzLCBHID0gKGUsIGkpPT4oZS5tc2cgPSBlZVtpXSwgaSksIFJ0ID0gKGUpPT4oZSA8PCAxKSAtIChlID4gNCA/IDkgOiAwKSwgWCA9IChlKT0+ewogICAgbGV0IGkgPSBlLmxlbmd0aDsKICAgIGZvcig7IC0taSA+PSAwOyllW2ldID0gMDsKfSwgTGEgPSAoZSwgaSwgdCk9PihpIDw8IGUuaGFzaF9zaGlmdCBeIHQpICYgZS5oYXNoX21hc2ssIFYgPSBMYSwgUCA9IChlKT0+ewogICAgbGV0IGkgPSBlLnN0YXRlLCB0ID0gaS5wZW5kaW5nOwogICAgdCA+IGUuYXZhaWxfb3V0ICYmICh0ID0gZS5hdmFpbF9vdXQpLCB0ICE9PSAwICYmIChlLm91dHB1dC5zZXQoaS5wZW5kaW5nX2J1Zi5zdWJhcnJheShpLnBlbmRpbmdfb3V0LCBpLnBlbmRpbmdfb3V0ICsgdCksIGUubmV4dF9vdXQpLCBlLm5leHRfb3V0ICs9IHQsIGkucGVuZGluZ19vdXQgKz0gdCwgZS50b3RhbF9vdXQgKz0gdCwgZS5hdmFpbF9vdXQgLT0gdCwgaS5wZW5kaW5nIC09IHQsIGkucGVuZGluZyA9PT0gMCAmJiAoaS5wZW5kaW5nX291dCA9IDApKTsKfSwgTyA9IChlLCBpKT0+ewogICAgY2EoZSwgZS5ibG9ja19zdGFydCA+PSAwID8gZS5ibG9ja19zdGFydCA6IC0xLCBlLnN0cnN0YXJ0IC0gZS5ibG9ja19zdGFydCwgaSksIGUuYmxvY2tfc3RhcnQgPSBlLnN0cnN0YXJ0LCBQKGUuc3RybSk7Cn0sIHkgPSAoZSwgaSk9PnsKICAgIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaTsKfSwgZGUgPSAoZSwgaSk9PnsKICAgIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaSA+Pj4gOCAmIDI1NSwgZS5wZW5kaW5nX2J1ZltlLnBlbmRpbmcrK10gPSBpICYgMjU1Owp9LCBVYSA9IChlLCBpLCB0LCBuKT0+ewogICAgbGV0IGEgPSBlLmF2YWlsX2luOwogICAgcmV0dXJuIGEgPiBuICYmIChhID0gbiksIGEgPT09IDAgPyAwIDogKGUuYXZhaWxfaW4gLT0gYSwgaS5zZXQoZS5pbnB1dC5zdWJhcnJheShlLm5leHRfaW4sIGUubmV4dF9pbiArIGEpLCB0KSwgZS5zdGF0ZS53cmFwID09PSAxID8gZS5hZGxlciA9IHZlKGUuYWRsZXIsIGksIGEsIHQpIDogZS5zdGF0ZS53cmFwID09PSAyICYmIChlLmFkbGVyID0gSShlLmFkbGVyLCBpLCBhLCB0KSksIGUubmV4dF9pbiArPSBhLCBlLnRvdGFsX2luICs9IGEsIGEpOwp9LCBwaSA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBlLm1heF9jaGFpbl9sZW5ndGgsIG4gPSBlLnN0cnN0YXJ0LCBhLCBsLCBvID0gZS5wcmV2X2xlbmd0aCwgZiA9IGUubmljZV9tYXRjaCwgYyA9IGUuc3Ryc3RhcnQgPiBlLndfc2l6ZSAtICQgPyBlLnN0cnN0YXJ0IC0gKGUud19zaXplIC0gJCkgOiAwLCByID0gZS53aW5kb3csIF8gPSBlLndfbWFzaywgRSA9IGUucHJldiwgcyA9IGUuc3Ryc3RhcnQgKyBZLCBoID0gcltuICsgbyAtIDFdLCB1ID0gcltuICsgb107CiAgICBlLnByZXZfbGVuZ3RoID49IGUuZ29vZF9tYXRjaCAmJiAodCA+Pj0gMiksIGYgPiBlLmxvb2thaGVhZCAmJiAoZiA9IGUubG9va2FoZWFkKTsKICAgIGRvIGlmIChhID0gaSwgIShyW2EgKyBvXSAhPT0gdSB8fCByW2EgKyBvIC0gMV0gIT09IGggfHwgclthXSAhPT0gcltuXSB8fCByWysrYV0gIT09IHJbbiArIDFdKSkgewogICAgICAgIG4gKz0gMiwgYSsrOwogICAgICAgIGRvIDsKICAgICAgICB3aGlsZSAoclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgbiA8IHMpCiAgICAgICAgaWYgKGwgPSBZIC0gKHMgLSBuKSwgbiA9IHMgLSBZLCBsID4gbykgewogICAgICAgICAgICBpZiAoZS5tYXRjaF9zdGFydCA9IGksIG8gPSBsLCBsID49IGYpIGJyZWFrOwogICAgICAgICAgICBoID0gcltuICsgbyAtIDFdLCB1ID0gcltuICsgb107CiAgICAgICAgfQogICAgfQogICAgd2hpbGUgKChpID0gRVtpICYgX10pID4gYyAmJiAtLXQgIT09IDApCiAgICByZXR1cm4gbyA8PSBlLmxvb2thaGVhZCA/IG8gOiBlLmxvb2thaGVhZDsKfSwgaWUgPSAoZSk9PnsKICAgIGxldCBpID0gZS53X3NpemUsIHQsIG4sIGEsIGwsIG87CiAgICBkbyB7CiAgICAgICAgaWYgKGwgPSBlLndpbmRvd19zaXplIC0gZS5sb29rYWhlYWQgLSBlLnN0cnN0YXJ0LCBlLnN0cnN0YXJ0ID49IGkgKyAoaSAtICQpKSB7CiAgICAgICAgICAgIGUud2luZG93LnNldChlLndpbmRvdy5zdWJhcnJheShpLCBpICsgaSksIDApLCBlLm1hdGNoX3N0YXJ0IC09IGksIGUuc3Ryc3RhcnQgLT0gaSwgZS5ibG9ja19zdGFydCAtPSBpLCBuID0gZS5oYXNoX3NpemUsIHQgPSBuOwogICAgICAgICAgICBkbyBhID0gZS5oZWFkWy0tdF0sIGUuaGVhZFt0XSA9IGEgPj0gaSA/IGEgLSBpIDogMDsKICAgICAgICAgICAgd2hpbGUgKC0tbikKICAgICAgICAgICAgbiA9IGksIHQgPSBuOwogICAgICAgICAgICBkbyBhID0gZS5wcmV2Wy0tdF0sIGUucHJldlt0XSA9IGEgPj0gaSA/IGEgLSBpIDogMDsKICAgICAgICAgICAgd2hpbGUgKC0tbikKICAgICAgICAgICAgbCArPSBpOwogICAgICAgIH0KICAgICAgICBpZiAoZS5zdHJtLmF2YWlsX2luID09PSAwKSBicmVhazsKICAgICAgICBpZiAobiA9IFVhKGUuc3RybSwgZS53aW5kb3csIGUuc3Ryc3RhcnQgKyBlLmxvb2thaGVhZCwgbCksIGUubG9va2FoZWFkICs9IG4sIGUubG9va2FoZWFkICsgZS5pbnNlcnQgPj0gaykgZm9yKG8gPSBlLnN0cnN0YXJ0IC0gZS5pbnNlcnQsIGUuaW5zX2ggPSBlLndpbmRvd1tvXSwgZS5pbnNfaCA9IFYoZSwgZS5pbnNfaCwgZS53aW5kb3dbbyArIDFdKTsgZS5pbnNlcnQgJiYgKGUuaW5zX2ggPSBWKGUsIGUuaW5zX2gsIGUud2luZG93W28gKyBrIC0gMV0pLCBlLnByZXZbbyAmIGUud19tYXNrXSA9IGUuaGVhZFtlLmluc19oXSwgZS5oZWFkW2UuaW5zX2hdID0gbywgbysrLCBlLmluc2VydC0tLCAhKGUubG9va2FoZWFkICsgZS5pbnNlcnQgPCBrKSk7KTsKICAgIH13aGlsZSAoZS5sb29rYWhlYWQgPCAkICYmIGUuc3RybS5hdmFpbF9pbiAhPT0gMCkKfSwgJGEgPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gNjU1MzU7CiAgICBmb3IodCA+IGUucGVuZGluZ19idWZfc2l6ZSAtIDUgJiYgKHQgPSBlLnBlbmRpbmdfYnVmX3NpemUgLSA1KTs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPD0gMSkgewogICAgICAgICAgICBpZiAoaWUoZSksIGUubG9va2FoZWFkID09PSAwICYmIGkgPT09IGxlKSByZXR1cm4gRDsKICAgICAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICAgICAgZS5zdHJzdGFydCArPSBlLmxvb2thaGVhZCwgZS5sb29rYWhlYWQgPSAwOwogICAgICAgIGxldCBuID0gZS5ibG9ja19zdGFydCArIHQ7CiAgICAgICAgaWYgKChlLnN0cnN0YXJ0ID09PSAwIHx8IGUuc3Ryc3RhcnQgPj0gbikgJiYgKGUubG9va2FoZWFkID0gZS5zdHJzdGFydCAtIG4sIGUuc3Ryc3RhcnQgPSBuLCBPKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCkgfHwgZS5zdHJzdGFydCAtIGUuYmxvY2tfc3RhcnQgPj0gZS53X3NpemUgLSAkICYmIChPKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCkpIHJldHVybiBEOwogICAgfQogICAgcmV0dXJuIGUuaW5zZXJ0ID0gMCwgaSA9PT0gVyA/IChPKGUsICEwKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCA/IHRlIDogaGUpIDogKGUuc3Ryc3RhcnQgPiBlLmJsb2NrX3N0YXJ0ICYmIChPKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCksIEQpOwp9LCBRZSA9IChlLCBpKT0+ewogICAgbGV0IHQsIG47CiAgICBmb3IoOzspewogICAgICAgIGlmIChlLmxvb2thaGVhZCA8ICQpIHsKICAgICAgICAgICAgaWYgKGllKGUpLCBlLmxvb2thaGVhZCA8ICQgJiYgaSA9PT0gbGUpIHJldHVybiBEOwogICAgICAgICAgICBpZiAoZS5sb29rYWhlYWQgPT09IDApIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodCA9IDAsIGUubG9va2FoZWFkID49IGsgJiYgKGUuaW5zX2ggPSBWKGUsIGUuaW5zX2gsIGUud2luZG93W2Uuc3Ryc3RhcnQgKyBrIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQpLCB0ICE9PSAwICYmIGUuc3Ryc3RhcnQgLSB0IDw9IGUud19zaXplIC0gJCAmJiAoZS5tYXRjaF9sZW5ndGggPSBwaShlLCB0KSksIGUubWF0Y2hfbGVuZ3RoID49IGspIGlmIChuID0gaihlLCBlLnN0cnN0YXJ0IC0gZS5tYXRjaF9zdGFydCwgZS5tYXRjaF9sZW5ndGggLSBrKSwgZS5sb29rYWhlYWQgLT0gZS5tYXRjaF9sZW5ndGgsIGUubWF0Y2hfbGVuZ3RoIDw9IGUubWF4X2xhenlfbWF0Y2ggJiYgZS5sb29rYWhlYWQgPj0gaykgewogICAgICAgICAgICBlLm1hdGNoX2xlbmd0aC0tOwogICAgICAgICAgICBkbyBlLnN0cnN0YXJ0KyssIGUuaW5zX2ggPSBWKGUsIGUuaW5zX2gsIGUud2luZG93W2Uuc3Ryc3RhcnQgKyBrIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQ7CiAgICAgICAgICAgIHdoaWxlICgtLWUubWF0Y2hfbGVuZ3RoICE9PSAwKQogICAgICAgICAgICBlLnN0cnN0YXJ0Kys7CiAgICAgICAgfSBlbHNlIGUuc3Ryc3RhcnQgKz0gZS5tYXRjaF9sZW5ndGgsIGUubWF0Y2hfbGVuZ3RoID0gMCwgZS5pbnNfaCA9IGUud2luZG93W2Uuc3Ryc3RhcnRdLCBlLmluc19oID0gVihlLCBlLmluc19oLCBlLndpbmRvd1tlLnN0cnN0YXJ0ICsgMV0pOwogICAgICAgIGVsc2UgbiA9IGooZSwgMCwgZS53aW5kb3dbZS5zdHJzdGFydF0pLCBlLmxvb2thaGVhZC0tLCBlLnN0cnN0YXJ0Kys7CiAgICAgICAgaWYgKG4gJiYgKE8oZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSkgcmV0dXJuIEQ7CiAgICB9CiAgICByZXR1cm4gZS5pbnNlcnQgPSBlLnN0cnN0YXJ0IDwgayAtIDEgPyBlLnN0cnN0YXJ0IDogayAtIDEsIGkgPT09IFcgPyAoTyhlLCAhMCksIGUuc3RybS5hdmFpbF9vdXQgPT09IDAgPyB0ZSA6IGhlKSA6IGUubGFzdF9saXQgJiYgKE8oZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSA/IEQgOiBSZTsKfSwgcmUgPSAoZSwgaSk9PnsKICAgIGxldCB0LCBuLCBhOwogICAgZm9yKDs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPCAkKSB7CiAgICAgICAgICAgIGlmIChpZShlKSwgZS5sb29rYWhlYWQgPCAkICYmIGkgPT09IGxlKSByZXR1cm4gRDsKICAgICAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHQgPSAwLCBlLmxvb2thaGVhZCA+PSBrICYmIChlLmluc19oID0gVihlLCBlLmluc19oLCBlLndpbmRvd1tlLnN0cnN0YXJ0ICsgayAtIDFdKSwgdCA9IGUucHJldltlLnN0cnN0YXJ0ICYgZS53X21hc2tdID0gZS5oZWFkW2UuaW5zX2hdLCBlLmhlYWRbZS5pbnNfaF0gPSBlLnN0cnN0YXJ0KSwgZS5wcmV2X2xlbmd0aCA9IGUubWF0Y2hfbGVuZ3RoLCBlLnByZXZfbWF0Y2ggPSBlLm1hdGNoX3N0YXJ0LCBlLm1hdGNoX2xlbmd0aCA9IGsgLSAxLCB0ICE9PSAwICYmIGUucHJldl9sZW5ndGggPCBlLm1heF9sYXp5X21hdGNoICYmIGUuc3Ryc3RhcnQgLSB0IDw9IGUud19zaXplIC0gJCAmJiAoZS5tYXRjaF9sZW5ndGggPSBwaShlLCB0KSwgZS5tYXRjaF9sZW5ndGggPD0gNSAmJiAoZS5zdHJhdGVneSA9PT0geGEgfHwgZS5tYXRjaF9sZW5ndGggPT09IGsgJiYgZS5zdHJzdGFydCAtIGUubWF0Y2hfc3RhcnQgPiA0MDk2KSAmJiAoZS5tYXRjaF9sZW5ndGggPSBrIC0gMSkpLCBlLnByZXZfbGVuZ3RoID49IGsgJiYgZS5tYXRjaF9sZW5ndGggPD0gZS5wcmV2X2xlbmd0aCkgewogICAgICAgICAgICBhID0gZS5zdHJzdGFydCArIGUubG9va2FoZWFkIC0gaywgbiA9IGooZSwgZS5zdHJzdGFydCAtIDEgLSBlLnByZXZfbWF0Y2gsIGUucHJldl9sZW5ndGggLSBrKSwgZS5sb29rYWhlYWQgLT0gZS5wcmV2X2xlbmd0aCAtIDEsIGUucHJldl9sZW5ndGggLT0gMjsKICAgICAgICAgICAgZG8gKytlLnN0cnN0YXJ0IDw9IGEgJiYgKGUuaW5zX2ggPSBWKGUsIGUuaW5zX2gsIGUud2luZG93W2Uuc3Ryc3RhcnQgKyBrIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQpOwogICAgICAgICAgICB3aGlsZSAoLS1lLnByZXZfbGVuZ3RoICE9PSAwKQogICAgICAgICAgICBpZiAoZS5tYXRjaF9hdmFpbGFibGUgPSAwLCBlLm1hdGNoX2xlbmd0aCA9IGsgLSAxLCBlLnN0cnN0YXJ0KyssIG4gJiYgKE8oZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSkgcmV0dXJuIEQ7CiAgICAgICAgfSBlbHNlIGlmIChlLm1hdGNoX2F2YWlsYWJsZSkgewogICAgICAgICAgICBpZiAobiA9IGooZSwgMCwgZS53aW5kb3dbZS5zdHJzdGFydCAtIDFdKSwgbiAmJiBPKGUsICExKSwgZS5zdHJzdGFydCsrLCBlLmxvb2thaGVhZC0tLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSByZXR1cm4gRDsKICAgICAgICB9IGVsc2UgZS5tYXRjaF9hdmFpbGFibGUgPSAxLCBlLnN0cnN0YXJ0KyssIGUubG9va2FoZWFkLS07CiAgICB9CiAgICByZXR1cm4gZS5tYXRjaF9hdmFpbGFibGUgJiYgKG4gPSBqKGUsIDAsIGUud2luZG93W2Uuc3Ryc3RhcnQgLSAxXSksIGUubWF0Y2hfYXZhaWxhYmxlID0gMCksIGUuaW5zZXJ0ID0gZS5zdHJzdGFydCA8IGsgLSAxID8gZS5zdHJzdGFydCA6IGsgLSAxLCBpID09PSBXID8gKE8oZSwgITApLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwID8gdGUgOiBoZSkgOiBlLmxhc3RfbGl0ICYmIChPKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCkgPyBEIDogUmU7Cn0sIENhID0gKGUsIGkpPT57CiAgICBsZXQgdCwgbiwgYSwgbCwgbyA9IGUud2luZG93OwogICAgZm9yKDs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPD0gWSkgewogICAgICAgICAgICBpZiAoaWUoZSksIGUubG9va2FoZWFkIDw9IFkgJiYgaSA9PT0gbGUpIHJldHVybiBEOwogICAgICAgICAgICBpZiAoZS5sb29rYWhlYWQgPT09IDApIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoZS5tYXRjaF9sZW5ndGggPSAwLCBlLmxvb2thaGVhZCA+PSBrICYmIGUuc3Ryc3RhcnQgPiAwICYmIChhID0gZS5zdHJzdGFydCAtIDEsIG4gPSBvW2FdLCBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSkpIHsKICAgICAgICAgICAgbCA9IGUuc3Ryc3RhcnQgKyBZOwogICAgICAgICAgICBkbyA7CiAgICAgICAgICAgIHdoaWxlIChuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIGEgPCBsKQogICAgICAgICAgICBlLm1hdGNoX2xlbmd0aCA9IFkgLSAobCAtIGEpLCBlLm1hdGNoX2xlbmd0aCA+IGUubG9va2FoZWFkICYmIChlLm1hdGNoX2xlbmd0aCA9IGUubG9va2FoZWFkKTsKICAgICAgICB9CiAgICAgICAgaWYgKGUubWF0Y2hfbGVuZ3RoID49IGsgPyAodCA9IGooZSwgMSwgZS5tYXRjaF9sZW5ndGggLSBrKSwgZS5sb29rYWhlYWQgLT0gZS5tYXRjaF9sZW5ndGgsIGUuc3Ryc3RhcnQgKz0gZS5tYXRjaF9sZW5ndGgsIGUubWF0Y2hfbGVuZ3RoID0gMCkgOiAodCA9IGooZSwgMCwgZS53aW5kb3dbZS5zdHJzdGFydF0pLCBlLmxvb2thaGVhZC0tLCBlLnN0cnN0YXJ0KyspLCB0ICYmIChPKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCkpIHJldHVybiBEOwogICAgfQogICAgcmV0dXJuIGUuaW5zZXJ0ID0gMCwgaSA9PT0gVyA/IChPKGUsICEwKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCA/IHRlIDogaGUpIDogZS5sYXN0X2xpdCAmJiAoTyhlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApID8gRCA6IFJlOwp9LCBGYSA9IChlLCBpKT0+ewogICAgbGV0IHQ7CiAgICBmb3IoOzspewogICAgICAgIGlmIChlLmxvb2thaGVhZCA9PT0gMCAmJiAoaWUoZSksIGUubG9va2FoZWFkID09PSAwKSkgewogICAgICAgICAgICBpZiAoaSA9PT0gbGUpIHJldHVybiBEOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGUubWF0Y2hfbGVuZ3RoID0gMCwgdCA9IGooZSwgMCwgZS53aW5kb3dbZS5zdHJzdGFydF0pLCBlLmxvb2thaGVhZC0tLCBlLnN0cnN0YXJ0KyssIHQgJiYgKE8oZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSkgcmV0dXJuIEQ7CiAgICB9CiAgICByZXR1cm4gZS5pbnNlcnQgPSAwLCBpID09PSBXID8gKE8oZSwgITApLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwID8gdGUgOiBoZSkgOiBlLmxhc3RfbGl0ICYmIChPKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCkgPyBEIDogUmU7Cn07CmZ1bmN0aW9uIEMoZSwgaSwgdCwgbiwgYSkgewogICAgdGhpcy5nb29kX2xlbmd0aCA9IGUsIHRoaXMubWF4X2xhenkgPSBpLCB0aGlzLm5pY2VfbGVuZ3RoID0gdCwgdGhpcy5tYXhfY2hhaW4gPSBuLCB0aGlzLmZ1bmMgPSBhOwp9CnZhciBjZSA9IFsKICAgIG5ldyBDKDAsIDAsIDAsIDAsICRhKSwKICAgIG5ldyBDKDQsIDQsIDgsIDQsIFFlKSwKICAgIG5ldyBDKDQsIDUsIDE2LCA4LCBRZSksCiAgICBuZXcgQyg0LCA2LCAzMiwgMzIsIFFlKSwKICAgIG5ldyBDKDQsIDQsIDE2LCAxNiwgcmUpLAogICAgbmV3IEMoOCwgMTYsIDMyLCAzMiwgcmUpLAogICAgbmV3IEMoOCwgMTYsIDEyOCwgMTI4LCByZSksCiAgICBuZXcgQyg4LCAzMiwgMTI4LCAyNTYsIHJlKSwKICAgIG5ldyBDKDMyLCAxMjgsIDI1OCwgMTAyNCwgcmUpLAogICAgbmV3IEMoMzIsIDI1OCwgMjU4LCA0MDk2LCByZSkKXSwgTWEgPSAoZSk9PnsKICAgIGUud2luZG93X3NpemUgPSAyICogZS53X3NpemUsIFgoZS5oZWFkKSwgZS5tYXhfbGF6eV9tYXRjaCA9IGNlW2UubGV2ZWxdLm1heF9sYXp5LCBlLmdvb2RfbWF0Y2ggPSBjZVtlLmxldmVsXS5nb29kX2xlbmd0aCwgZS5uaWNlX21hdGNoID0gY2VbZS5sZXZlbF0ubmljZV9sZW5ndGgsIGUubWF4X2NoYWluX2xlbmd0aCA9IGNlW2UubGV2ZWxdLm1heF9jaGFpbiwgZS5zdHJzdGFydCA9IDAsIGUuYmxvY2tfc3RhcnQgPSAwLCBlLmxvb2thaGVhZCA9IDAsIGUuaW5zZXJ0ID0gMCwgZS5tYXRjaF9sZW5ndGggPSBlLnByZXZfbGVuZ3RoID0gayAtIDEsIGUubWF0Y2hfYXZhaWxhYmxlID0gMCwgZS5pbnNfaCA9IDA7Cn07CmZ1bmN0aW9uIEhhKCkgewogICAgdGhpcy5zdHJtID0gbnVsbCwgdGhpcy5zdGF0dXMgPSAwLCB0aGlzLnBlbmRpbmdfYnVmID0gbnVsbCwgdGhpcy5wZW5kaW5nX2J1Zl9zaXplID0gMCwgdGhpcy5wZW5kaW5nX291dCA9IDAsIHRoaXMucGVuZGluZyA9IDAsIHRoaXMud3JhcCA9IDAsIHRoaXMuZ3poZWFkID0gbnVsbCwgdGhpcy5nemluZGV4ID0gMCwgdGhpcy5tZXRob2QgPSBQZSwgdGhpcy5sYXN0X2ZsdXNoID0gLTEsIHRoaXMud19zaXplID0gMCwgdGhpcy53X2JpdHMgPSAwLCB0aGlzLndfbWFzayA9IDAsIHRoaXMud2luZG93ID0gbnVsbCwgdGhpcy53aW5kb3dfc2l6ZSA9IDAsIHRoaXMucHJldiA9IG51bGwsIHRoaXMuaGVhZCA9IG51bGwsIHRoaXMuaW5zX2ggPSAwLCB0aGlzLmhhc2hfc2l6ZSA9IDAsIHRoaXMuaGFzaF9iaXRzID0gMCwgdGhpcy5oYXNoX21hc2sgPSAwLCB0aGlzLmhhc2hfc2hpZnQgPSAwLCB0aGlzLmJsb2NrX3N0YXJ0ID0gMCwgdGhpcy5tYXRjaF9sZW5ndGggPSAwLCB0aGlzLnByZXZfbWF0Y2ggPSAwLCB0aGlzLm1hdGNoX2F2YWlsYWJsZSA9IDAsIHRoaXMuc3Ryc3RhcnQgPSAwLCB0aGlzLm1hdGNoX3N0YXJ0ID0gMCwgdGhpcy5sb29rYWhlYWQgPSAwLCB0aGlzLnByZXZfbGVuZ3RoID0gMCwgdGhpcy5tYXhfY2hhaW5fbGVuZ3RoID0gMCwgdGhpcy5tYXhfbGF6eV9tYXRjaCA9IDAsIHRoaXMubGV2ZWwgPSAwLCB0aGlzLnN0cmF0ZWd5ID0gMCwgdGhpcy5nb29kX21hdGNoID0gMCwgdGhpcy5uaWNlX21hdGNoID0gMCwgdGhpcy5keW5fbHRyZWUgPSBuZXcgVWludDE2QXJyYXkoWmEgKiAyKSwgdGhpcy5keW5fZHRyZWUgPSBuZXcgVWludDE2QXJyYXkoKDIgKiBtYSArIDEpICogMiksIHRoaXMuYmxfdHJlZSA9IG5ldyBVaW50MTZBcnJheSgoMiAqIERhICsgMSkgKiAyKSwgWCh0aGlzLmR5bl9sdHJlZSksIFgodGhpcy5keW5fZHRyZWUpLCBYKHRoaXMuYmxfdHJlZSksIHRoaXMubF9kZXNjID0gbnVsbCwgdGhpcy5kX2Rlc2MgPSBudWxsLCB0aGlzLmJsX2Rlc2MgPSBudWxsLCB0aGlzLmJsX2NvdW50ID0gbmV3IFVpbnQxNkFycmF5KElhICsgMSksIHRoaXMuaGVhcCA9IG5ldyBVaW50MTZBcnJheSgyICogX3QgKyAxKSwgWCh0aGlzLmhlYXApLCB0aGlzLmhlYXBfbGVuID0gMCwgdGhpcy5oZWFwX21heCA9IDAsIHRoaXMuZGVwdGggPSBuZXcgVWludDE2QXJyYXkoMiAqIF90ICsgMSksIFgodGhpcy5kZXB0aCksIHRoaXMubF9idWYgPSAwLCB0aGlzLmxpdF9idWZzaXplID0gMCwgdGhpcy5sYXN0X2xpdCA9IDAsIHRoaXMuZF9idWYgPSAwLCB0aGlzLm9wdF9sZW4gPSAwLCB0aGlzLnN0YXRpY19sZW4gPSAwLCB0aGlzLm1hdGNoZXMgPSAwLCB0aGlzLmluc2VydCA9IDAsIHRoaXMuYmlfYnVmID0gMCwgdGhpcy5iaV92YWxpZCA9IDA7Cn0KdmFyIHhpID0gKGUpPT57CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBHKGUsIEwpOwogICAgZS50b3RhbF9pbiA9IGUudG90YWxfb3V0ID0gMCwgZS5kYXRhX3R5cGUgPSB5YTsKICAgIGxldCBpID0gZS5zdGF0ZTsKICAgIHJldHVybiBpLnBlbmRpbmcgPSAwLCBpLnBlbmRpbmdfb3V0ID0gMCwgaS53cmFwIDwgMCAmJiAoaS53cmFwID0gLWkud3JhcCksIGkuc3RhdHVzID0gaS53cmFwID8gWGUgOiBxLCBlLmFkbGVyID0gaS53cmFwID09PSAyID8gMCA6IDEsIGkubGFzdF9mbHVzaCA9IGxlLCBkYShpKSwgTTsKfSwga2kgPSAoZSk9PnsKICAgIGxldCBpID0geGkoZSk7CiAgICByZXR1cm4gaSA9PT0gTSAmJiBNYShlLnN0YXRlKSwgaTsKfSwgQmEgPSAoZSwgaSk9PiFlIHx8ICFlLnN0YXRlIHx8IGUuc3RhdGUud3JhcCAhPT0gMiA/IEwgOiAoZS5zdGF0ZS5nemhlYWQgPSBpLCBNKSwgdmkgPSAoZSwgaSwgdCwgbiwgYSwgbCk9PnsKICAgIGlmICghZSkgcmV0dXJuIEw7CiAgICBsZXQgbyA9IDE7CiAgICBpZiAoaSA9PT0gcGEgJiYgKGkgPSA2KSwgbiA8IDAgPyAobyA9IDAsIG4gPSAtbikgOiBuID4gMTUgJiYgKG8gPSAyLCBuIC09IDE2KSwgYSA8IDEgfHwgYSA+IFNhIHx8IHQgIT09IFBlIHx8IG4gPCA4IHx8IG4gPiAxNSB8fCBpIDwgMCB8fCBpID4gOSB8fCBsIDwgMCB8fCBsID4gdmEpIHJldHVybiBHKGUsIEwpOwogICAgbiA9PT0gOCAmJiAobiA9IDkpOwogICAgbGV0IGYgPSBuZXcgSGE7CiAgICByZXR1cm4gZS5zdGF0ZSA9IGYsIGYuc3RybSA9IGUsIGYud3JhcCA9IG8sIGYuZ3poZWFkID0gbnVsbCwgZi53X2JpdHMgPSBuLCBmLndfc2l6ZSA9IDEgPDwgZi53X2JpdHMsIGYud19tYXNrID0gZi53X3NpemUgLSAxLCBmLmhhc2hfYml0cyA9IGEgKyA3LCBmLmhhc2hfc2l6ZSA9IDEgPDwgZi5oYXNoX2JpdHMsIGYuaGFzaF9tYXNrID0gZi5oYXNoX3NpemUgLSAxLCBmLmhhc2hfc2hpZnQgPSB+figoZi5oYXNoX2JpdHMgKyBrIC0gMSkgLyBrKSwgZi53aW5kb3cgPSBuZXcgVWludDhBcnJheShmLndfc2l6ZSAqIDIpLCBmLmhlYWQgPSBuZXcgVWludDE2QXJyYXkoZi5oYXNoX3NpemUpLCBmLnByZXYgPSBuZXcgVWludDE2QXJyYXkoZi53X3NpemUpLCBmLmxpdF9idWZzaXplID0gMSA8PCBhICsgNiwgZi5wZW5kaW5nX2J1Zl9zaXplID0gZi5saXRfYnVmc2l6ZSAqIDQsIGYucGVuZGluZ19idWYgPSBuZXcgVWludDhBcnJheShmLnBlbmRpbmdfYnVmX3NpemUpLCBmLmRfYnVmID0gMSAqIGYubGl0X2J1ZnNpemUsIGYubF9idWYgPSAoMSArIDIpICogZi5saXRfYnVmc2l6ZSwgZi5sZXZlbCA9IGksIGYuc3RyYXRlZ3kgPSBsLCBmLm1ldGhvZCA9IHQsIGtpKGUpOwp9LCBLYSA9IChlLCBpKT0+dmkoZSwgaSwgUGUsIEFhLCBSYSwgRWEpLCBQYSA9IChlLCBpKT0+ewogICAgbGV0IHQsIG47CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUgfHwgaSA+IFN0IHx8IGkgPCAwKSByZXR1cm4gZSA/IEcoZSwgTCkgOiBMOwogICAgbGV0IGEgPSBlLnN0YXRlOwogICAgaWYgKCFlLm91dHB1dCB8fCAhZS5pbnB1dCAmJiBlLmF2YWlsX2luICE9PSAwIHx8IGEuc3RhdHVzID09PSBzZSAmJiBpICE9PSBXKSByZXR1cm4gRyhlLCBlLmF2YWlsX291dCA9PT0gMCA/IEplIDogTCk7CiAgICBhLnN0cm0gPSBlOwogICAgbGV0IGwgPSBhLmxhc3RfZmx1c2g7CiAgICBpZiAoYS5sYXN0X2ZsdXNoID0gaSwgYS5zdGF0dXMgPT09IFhlKSBpZiAoYS53cmFwID09PSAyKSBlLmFkbGVyID0gMCwgeShhLCAzMSksIHkoYSwgMTM5KSwgeShhLCA4KSwgYS5nemhlYWQgPyAoeShhLCAoYS5nemhlYWQudGV4dCA/IDEgOiAwKSArIChhLmd6aGVhZC5oY3JjID8gMiA6IDApICsgKGEuZ3poZWFkLmV4dHJhID8gNCA6IDApICsgKGEuZ3poZWFkLm5hbWUgPyA4IDogMCkgKyAoYS5nemhlYWQuY29tbWVudCA/IDE2IDogMCkpLCB5KGEsIGEuZ3poZWFkLnRpbWUgJiAyNTUpLCB5KGEsIGEuZ3poZWFkLnRpbWUgPj4gOCAmIDI1NSksIHkoYSwgYS5nemhlYWQudGltZSA+PiAxNiAmIDI1NSksIHkoYSwgYS5nemhlYWQudGltZSA+PiAyNCAmIDI1NSksIHkoYSwgYS5sZXZlbCA9PT0gOSA/IDIgOiBhLnN0cmF0ZWd5ID49IEllIHx8IGEubGV2ZWwgPCAyID8gNCA6IDApLCB5KGEsIGEuZ3poZWFkLm9zICYgMjU1KSwgYS5nemhlYWQuZXh0cmEgJiYgYS5nemhlYWQuZXh0cmEubGVuZ3RoICYmICh5KGEsIGEuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDI1NSksIHkoYSwgYS5nemhlYWQuZXh0cmEubGVuZ3RoID4+IDggJiAyNTUpKSwgYS5nemhlYWQuaGNyYyAmJiAoZS5hZGxlciA9IEkoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nLCAwKSksIGEuZ3ppbmRleCA9IDAsIGEuc3RhdHVzID0gaHQpIDogKHkoYSwgMCksIHkoYSwgMCksIHkoYSwgMCksIHkoYSwgMCksIHkoYSwgMCksIHkoYSwgYS5sZXZlbCA9PT0gOSA/IDIgOiBhLnN0cmF0ZWd5ID49IEllIHx8IGEubGV2ZWwgPCAyID8gNCA6IDApLCB5KGEsIE5hKSwgYS5zdGF0dXMgPSBxKTsKICAgIGVsc2UgewogICAgICAgIGxldCBvID0gUGUgKyAoYS53X2JpdHMgLSA4IDw8IDQpIDw8IDgsIGYgPSAtMTsKICAgICAgICBhLnN0cmF0ZWd5ID49IEllIHx8IGEubGV2ZWwgPCAyID8gZiA9IDAgOiBhLmxldmVsIDwgNiA/IGYgPSAxIDogYS5sZXZlbCA9PT0gNiA/IGYgPSAyIDogZiA9IDMsIG8gfD0gZiA8PCA2LCBhLnN0cnN0YXJ0ICE9PSAwICYmIChvIHw9IE9hKSwgbyArPSAzMSAtIG8gJSAzMSwgYS5zdGF0dXMgPSBxLCBkZShhLCBvKSwgYS5zdHJzdGFydCAhPT0gMCAmJiAoZGUoYSwgZS5hZGxlciA+Pj4gMTYpLCBkZShhLCBlLmFkbGVyICYgNjU1MzUpKSwgZS5hZGxlciA9IDE7CiAgICB9CiAgICBpZiAoYS5zdGF0dXMgPT09IGh0KSBpZiAoYS5nemhlYWQuZXh0cmEpIHsKICAgICAgICBmb3IodCA9IGEucGVuZGluZzsgYS5nemluZGV4IDwgKGEuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDY1NTM1KSAmJiAhKGEucGVuZGluZyA9PT0gYS5wZW5kaW5nX2J1Zl9zaXplICYmIChhLmd6aGVhZC5oY3JjICYmIGEucGVuZGluZyA+IHQgJiYgKGUuYWRsZXIgPSBJKGUuYWRsZXIsIGEucGVuZGluZ19idWYsIGEucGVuZGluZyAtIHQsIHQpKSwgUChlKSwgdCA9IGEucGVuZGluZywgYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUpKTspeShhLCBhLmd6aGVhZC5leHRyYVthLmd6aW5kZXhdICYgMjU1KSwgYS5nemluZGV4Kys7CiAgICAgICAgYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSShlLmFkbGVyLCBhLnBlbmRpbmdfYnVmLCBhLnBlbmRpbmcgLSB0LCB0KSksIGEuZ3ppbmRleCA9PT0gYS5nemhlYWQuZXh0cmEubGVuZ3RoICYmIChhLmd6aW5kZXggPSAwLCBhLnN0YXR1cyA9IENlKTsKICAgIH0gZWxzZSBhLnN0YXR1cyA9IENlOwogICAgaWYgKGEuc3RhdHVzID09PSBDZSkgaWYgKGEuZ3poZWFkLm5hbWUpIHsKICAgICAgICB0ID0gYS5wZW5kaW5nOwogICAgICAgIGRvIHsKICAgICAgICAgICAgaWYgKGEucGVuZGluZyA9PT0gYS5wZW5kaW5nX2J1Zl9zaXplICYmIChhLmd6aGVhZC5oY3JjICYmIGEucGVuZGluZyA+IHQgJiYgKGUuYWRsZXIgPSBJKGUuYWRsZXIsIGEucGVuZGluZ19idWYsIGEucGVuZGluZyAtIHQsIHQpKSwgUChlKSwgdCA9IGEucGVuZGluZywgYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUpKSB7CiAgICAgICAgICAgICAgICBuID0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGEuZ3ppbmRleCA8IGEuZ3poZWFkLm5hbWUubGVuZ3RoID8gbiA9IGEuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChhLmd6aW5kZXgrKykgJiAyNTUgOiBuID0gMCwgeShhLCBuKTsKICAgICAgICB9d2hpbGUgKG4gIT09IDApCiAgICAgICAgYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSShlLmFkbGVyLCBhLnBlbmRpbmdfYnVmLCBhLnBlbmRpbmcgLSB0LCB0KSksIG4gPT09IDAgJiYgKGEuZ3ppbmRleCA9IDAsIGEuc3RhdHVzID0gRmUpOwogICAgfSBlbHNlIGEuc3RhdHVzID0gRmU7CiAgICBpZiAoYS5zdGF0dXMgPT09IEZlKSBpZiAoYS5nemhlYWQuY29tbWVudCkgewogICAgICAgIHQgPSBhLnBlbmRpbmc7CiAgICAgICAgZG8gewogICAgICAgICAgICBpZiAoYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUgJiYgKGEuZ3poZWFkLmhjcmMgJiYgYS5wZW5kaW5nID4gdCAmJiAoZS5hZGxlciA9IEkoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nIC0gdCwgdCkpLCBQKGUpLCB0ID0gYS5wZW5kaW5nLCBhLnBlbmRpbmcgPT09IGEucGVuZGluZ19idWZfc2l6ZSkpIHsKICAgICAgICAgICAgICAgIG4gPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYS5nemluZGV4IDwgYS5nemhlYWQuY29tbWVudC5sZW5ndGggPyBuID0gYS5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KGEuZ3ppbmRleCsrKSAmIDI1NSA6IG4gPSAwLCB5KGEsIG4pOwogICAgICAgIH13aGlsZSAobiAhPT0gMCkKICAgICAgICBhLmd6aGVhZC5oY3JjICYmIGEucGVuZGluZyA+IHQgJiYgKGUuYWRsZXIgPSBJKGUuYWRsZXIsIGEucGVuZGluZ19idWYsIGEucGVuZGluZyAtIHQsIHQpKSwgbiA9PT0gMCAmJiAoYS5zdGF0dXMgPSBNZSk7CiAgICB9IGVsc2UgYS5zdGF0dXMgPSBNZTsKICAgIGlmIChhLnN0YXR1cyA9PT0gTWUgJiYgKGEuZ3poZWFkLmhjcmMgPyAoYS5wZW5kaW5nICsgMiA+IGEucGVuZGluZ19idWZfc2l6ZSAmJiBQKGUpLCBhLnBlbmRpbmcgKyAyIDw9IGEucGVuZGluZ19idWZfc2l6ZSAmJiAoeShhLCBlLmFkbGVyICYgMjU1KSwgeShhLCBlLmFkbGVyID4+IDggJiAyNTUpLCBlLmFkbGVyID0gMCwgYS5zdGF0dXMgPSBxKSkgOiBhLnN0YXR1cyA9IHEpLCBhLnBlbmRpbmcgIT09IDApIHsKICAgICAgICBpZiAoUChlKSwgZS5hdmFpbF9vdXQgPT09IDApIHJldHVybiBhLmxhc3RfZmx1c2ggPSAtMSwgTTsKICAgIH0gZWxzZSBpZiAoZS5hdmFpbF9pbiA9PT0gMCAmJiBSdChpKSA8PSBSdChsKSAmJiBpICE9PSBXKSByZXR1cm4gRyhlLCBKZSk7CiAgICBpZiAoYS5zdGF0dXMgPT09IHNlICYmIGUuYXZhaWxfaW4gIT09IDApIHJldHVybiBHKGUsIEplKTsKICAgIGlmIChlLmF2YWlsX2luICE9PSAwIHx8IGEubG9va2FoZWFkICE9PSAwIHx8IGkgIT09IGxlICYmIGEuc3RhdHVzICE9PSBzZSkgewogICAgICAgIGxldCBvID0gYS5zdHJhdGVneSA9PT0gSWUgPyBGYShhLCBpKSA6IGEuc3RyYXRlZ3kgPT09IGthID8gQ2EoYSwgaSkgOiBjZVthLmxldmVsXS5mdW5jKGEsIGkpOwogICAgICAgIGlmICgobyA9PT0gdGUgfHwgbyA9PT0gaGUpICYmIChhLnN0YXR1cyA9IHNlKSwgbyA9PT0gRCB8fCBvID09PSB0ZSkgcmV0dXJuIGUuYXZhaWxfb3V0ID09PSAwICYmIChhLmxhc3RfZmx1c2ggPSAtMSksIE07CiAgICAgICAgaWYgKG8gPT09IFJlICYmIChpID09PSBiYSA/IHVhKGEpIDogaSAhPT0gU3QgJiYgKHNhKGEsIDAsIDAsICExKSwgaSA9PT0gd2EgJiYgKFgoYS5oZWFkKSwgYS5sb29rYWhlYWQgPT09IDAgJiYgKGEuc3Ryc3RhcnQgPSAwLCBhLmJsb2NrX3N0YXJ0ID0gMCwgYS5pbnNlcnQgPSAwKSkpLCBQKGUpLCBlLmF2YWlsX291dCA9PT0gMCkpIHJldHVybiBhLmxhc3RfZmx1c2ggPSAtMSwgTTsKICAgIH0KICAgIHJldHVybiBpICE9PSBXID8gTSA6IGEud3JhcCA8PSAwID8gQXQgOiAoYS53cmFwID09PSAyID8gKHkoYSwgZS5hZGxlciAmIDI1NSksIHkoYSwgZS5hZGxlciA+PiA4ICYgMjU1KSwgeShhLCBlLmFkbGVyID4+IDE2ICYgMjU1KSwgeShhLCBlLmFkbGVyID4+IDI0ICYgMjU1KSwgeShhLCBlLnRvdGFsX2luICYgMjU1KSwgeShhLCBlLnRvdGFsX2luID4+IDggJiAyNTUpLCB5KGEsIGUudG90YWxfaW4gPj4gMTYgJiAyNTUpLCB5KGEsIGUudG90YWxfaW4gPj4gMjQgJiAyNTUpKSA6IChkZShhLCBlLmFkbGVyID4+PiAxNiksIGRlKGEsIGUuYWRsZXIgJiA2NTUzNSkpLCBQKGUpLCBhLndyYXAgPiAwICYmIChhLndyYXAgPSAtYS53cmFwKSwgYS5wZW5kaW5nICE9PSAwID8gTSA6IEF0KTsKfSwgWGEgPSAoZSk9PnsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSkgcmV0dXJuIEw7CiAgICBsZXQgaSA9IGUuc3RhdGUuc3RhdHVzOwogICAgcmV0dXJuIGkgIT09IFhlICYmIGkgIT09IGh0ICYmIGkgIT09IENlICYmIGkgIT09IEZlICYmIGkgIT09IE1lICYmIGkgIT09IHEgJiYgaSAhPT0gc2UgPyBHKGUsIEwpIDogKGUuc3RhdGUgPSBudWxsLCBpID09PSBxID8gRyhlLCBnYSkgOiBNKTsKfSwgWWEgPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gaS5sZW5ndGg7CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBMOwogICAgbGV0IG4gPSBlLnN0YXRlLCBhID0gbi53cmFwOwogICAgaWYgKGEgPT09IDIgfHwgYSA9PT0gMSAmJiBuLnN0YXR1cyAhPT0gWGUgfHwgbi5sb29rYWhlYWQpIHJldHVybiBMOwogICAgaWYgKGEgPT09IDEgJiYgKGUuYWRsZXIgPSB2ZShlLmFkbGVyLCBpLCB0LCAwKSksIG4ud3JhcCA9IDAsIHQgPj0gbi53X3NpemUpIHsKICAgICAgICBhID09PSAwICYmIChYKG4uaGVhZCksIG4uc3Ryc3RhcnQgPSAwLCBuLmJsb2NrX3N0YXJ0ID0gMCwgbi5pbnNlcnQgPSAwKTsKICAgICAgICBsZXQgYyA9IG5ldyBVaW50OEFycmF5KG4ud19zaXplKTsKICAgICAgICBjLnNldChpLnN1YmFycmF5KHQgLSBuLndfc2l6ZSwgdCksIDApLCBpID0gYywgdCA9IG4ud19zaXplOwogICAgfQogICAgbGV0IGwgPSBlLmF2YWlsX2luLCBvID0gZS5uZXh0X2luLCBmID0gZS5pbnB1dDsKICAgIGZvcihlLmF2YWlsX2luID0gdCwgZS5uZXh0X2luID0gMCwgZS5pbnB1dCA9IGksIGllKG4pOyBuLmxvb2thaGVhZCA+PSBrOyl7CiAgICAgICAgbGV0IGMgPSBuLnN0cnN0YXJ0LCByID0gbi5sb29rYWhlYWQgLSAoayAtIDEpOwogICAgICAgIGRvIG4uaW5zX2ggPSBWKG4sIG4uaW5zX2gsIG4ud2luZG93W2MgKyBrIC0gMV0pLCBuLnByZXZbYyAmIG4ud19tYXNrXSA9IG4uaGVhZFtuLmluc19oXSwgbi5oZWFkW24uaW5zX2hdID0gYywgYysrOwogICAgICAgIHdoaWxlICgtLXIpCiAgICAgICAgbi5zdHJzdGFydCA9IGMsIG4ubG9va2FoZWFkID0gayAtIDEsIGllKG4pOwogICAgfQogICAgcmV0dXJuIG4uc3Ryc3RhcnQgKz0gbi5sb29rYWhlYWQsIG4uYmxvY2tfc3RhcnQgPSBuLnN0cnN0YXJ0LCBuLmluc2VydCA9IG4ubG9va2FoZWFkLCBuLmxvb2thaGVhZCA9IDAsIG4ubWF0Y2hfbGVuZ3RoID0gbi5wcmV2X2xlbmd0aCA9IGsgLSAxLCBuLm1hdGNoX2F2YWlsYWJsZSA9IDAsIGUubmV4dF9pbiA9IG8sIGUuaW5wdXQgPSBmLCBlLmF2YWlsX2luID0gbCwgbi53cmFwID0gYSwgTTsKfSwgR2EgPSBLYSwgamEgPSB2aSwgV2EgPSBraSwgVmEgPSB4aSwgSmEgPSBCYSwgUWEgPSBQYSwgcWEgPSBYYSwgZW4gPSBZYSwgdG4gPSAicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSIsIGJlID0gewogICAgZGVmbGF0ZUluaXQ6IEdhLAogICAgZGVmbGF0ZUluaXQyOiBqYSwKICAgIGRlZmxhdGVSZXNldDogV2EsCiAgICBkZWZsYXRlUmVzZXRLZWVwOiBWYSwKICAgIGRlZmxhdGVTZXRIZWFkZXI6IEphLAogICAgZGVmbGF0ZTogUWEsCiAgICBkZWZsYXRlRW5kOiBxYSwKICAgIGRlZmxhdGVTZXREaWN0aW9uYXJ5OiBlbiwKICAgIGRlZmxhdGVJbmZvOiB0bgp9LCBhbiA9IChlLCBpKT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIGkpLCBubiA9IGZ1bmN0aW9uKGUpIHsKICAgIGxldCBpID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGZvcig7IGkubGVuZ3RoOyl7CiAgICAgICAgbGV0IHQgPSBpLnNoaWZ0KCk7CiAgICAgICAgaWYgKHQpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0ICE9ICJvYmplY3QiKSB0aHJvdyBuZXcgVHlwZUVycm9yKHQgKyAibXVzdCBiZSBub24tb2JqZWN0Iik7CiAgICAgICAgICAgIGZvcihsZXQgbiBpbiB0KWFuKHQsIG4pICYmIChlW25dID0gdFtuXSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGU7Cn0sIGxuID0gKGUpPT57CiAgICBsZXQgaSA9IDA7CiAgICBmb3IobGV0IG4gPSAwLCBhID0gZS5sZW5ndGg7IG4gPCBhOyBuKyspaSArPSBlW25dLmxlbmd0aDsKICAgIGxldCB0ID0gbmV3IFVpbnQ4QXJyYXkoaSk7CiAgICBmb3IobGV0IG4gPSAwLCBhID0gMCwgbCA9IGUubGVuZ3RoOyBuIDwgbDsgbisrKXsKICAgICAgICBsZXQgbyA9IGVbbl07CiAgICAgICAgdC5zZXQobywgYSksIGEgKz0gby5sZW5ndGg7CiAgICB9CiAgICByZXR1cm4gdDsKfSwgWWUgPSB7CiAgICBhc3NpZ246IG5uLAogICAgZmxhdHRlbkNodW5rczogbG4KfSwgRWkgPSAhMDsKdHJ5IHsKICAgIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoMSkpOwp9IGNhdGNoICB7CiAgICBFaSA9ICExOwp9CnZhciBFZSA9IG5ldyBVaW50OEFycmF5KDI1Nik7CmZvcihsZXQgZSA9IDA7IGUgPCAyNTY7IGUrKylFZVtlXSA9IGUgPj0gMjUyID8gNiA6IGUgPj0gMjQ4ID8gNSA6IGUgPj0gMjQwID8gNCA6IGUgPj0gMjI0ID8gMyA6IGUgPj0gMTkyID8gMiA6IDE7CkVlWzI1NF0gPSBFZVsyNTRdID0gMTsKdmFyIHJuID0gKGUpPT57CiAgICBpZiAodHlwZW9mIFRleHRFbmNvZGVyID09ICJmdW5jdGlvbiIgJiYgVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSkgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShlKTsKICAgIGxldCBpLCB0LCBuLCBhLCBsLCBvID0gZS5sZW5ndGgsIGYgPSAwOwogICAgZm9yKGEgPSAwOyBhIDwgbzsgYSsrKXQgPSBlLmNoYXJDb2RlQXQoYSksICh0ICYgNjQ1MTIpID09PSA1NTI5NiAmJiBhICsgMSA8IG8gJiYgKG4gPSBlLmNoYXJDb2RlQXQoYSArIDEpLCAobiAmIDY0NTEyKSA9PT0gNTYzMjAgJiYgKHQgPSA2NTUzNiArICh0IC0gNTUyOTYgPDwgMTApICsgKG4gLSA1NjMyMCksIGErKykpLCBmICs9IHQgPCAxMjggPyAxIDogdCA8IDIwNDggPyAyIDogdCA8IDY1NTM2ID8gMyA6IDQ7CiAgICBmb3IoaSA9IG5ldyBVaW50OEFycmF5KGYpLCBsID0gMCwgYSA9IDA7IGwgPCBmOyBhKyspdCA9IGUuY2hhckNvZGVBdChhKSwgKHQgJiA2NDUxMikgPT09IDU1Mjk2ICYmIGEgKyAxIDwgbyAmJiAobiA9IGUuY2hhckNvZGVBdChhICsgMSksIChuICYgNjQ1MTIpID09PSA1NjMyMCAmJiAodCA9IDY1NTM2ICsgKHQgLSA1NTI5NiA8PCAxMCkgKyAobiAtIDU2MzIwKSwgYSsrKSksIHQgPCAxMjggPyBpW2wrK10gPSB0IDogdCA8IDIwNDggPyAoaVtsKytdID0gMTkyIHwgdCA+Pj4gNiwgaVtsKytdID0gMTI4IHwgdCAmIDYzKSA6IHQgPCA2NTUzNiA/IChpW2wrK10gPSAyMjQgfCB0ID4+PiAxMiwgaVtsKytdID0gMTI4IHwgdCA+Pj4gNiAmIDYzLCBpW2wrK10gPSAxMjggfCB0ICYgNjMpIDogKGlbbCsrXSA9IDI0MCB8IHQgPj4+IDE4LCBpW2wrK10gPSAxMjggfCB0ID4+PiAxMiAmIDYzLCBpW2wrK10gPSAxMjggfCB0ID4+PiA2ICYgNjMsIGlbbCsrXSA9IDEyOCB8IHQgJiA2Myk7CiAgICByZXR1cm4gaTsKfSwgZm4gPSAoZSwgaSk9PnsKICAgIGlmIChpIDwgNjU1MzQgJiYgZS5zdWJhcnJheSAmJiBFaSkgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgZS5sZW5ndGggPT09IGkgPyBlIDogZS5zdWJhcnJheSgwLCBpKSk7CiAgICBsZXQgdCA9ICIiOwogICAgZm9yKGxldCBuID0gMDsgbiA8IGk7IG4rKyl0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZVtuXSk7CiAgICByZXR1cm4gdDsKfSwgb24gPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gaSB8fCBlLmxlbmd0aDsKICAgIGlmICh0eXBlb2YgVGV4dERlY29kZXIgPT0gImZ1bmN0aW9uIiAmJiBUZXh0RGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlKSByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGUuc3ViYXJyYXkoMCwgaSkpOwogICAgbGV0IG4sIGEsIGwgPSBuZXcgQXJyYXkodCAqIDIpOwogICAgZm9yKGEgPSAwLCBuID0gMDsgbiA8IHQ7KXsKICAgICAgICBsZXQgbyA9IGVbbisrXTsKICAgICAgICBpZiAobyA8IDEyOCkgewogICAgICAgICAgICBsW2ErK10gPSBvOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IGYgPSBFZVtvXTsKICAgICAgICBpZiAoZiA+IDQpIHsKICAgICAgICAgICAgbFthKytdID0gNjU1MzMsIG4gKz0gZiAtIDE7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBmb3IobyAmPSBmID09PSAyID8gMzEgOiBmID09PSAzID8gMTUgOiA3OyBmID4gMSAmJiBuIDwgdDspbyA9IG8gPDwgNiB8IGVbbisrXSAmIDYzLCBmLS07CiAgICAgICAgaWYgKGYgPiAxKSB7CiAgICAgICAgICAgIGxbYSsrXSA9IDY1NTMzOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbyA8IDY1NTM2ID8gbFthKytdID0gbyA6IChvIC09IDY1NTM2LCBsW2ErK10gPSA1NTI5NiB8IG8gPj4gMTAgJiAxMDIzLCBsW2ErK10gPSA1NjMyMCB8IG8gJiAxMDIzKTsKICAgIH0KICAgIHJldHVybiBmbihsLCBhKTsKfSwgX24gPSAoZSwgaSk9PnsKICAgIGkgPSBpIHx8IGUubGVuZ3RoLCBpID4gZS5sZW5ndGggJiYgKGkgPSBlLmxlbmd0aCk7CiAgICBsZXQgdCA9IGkgLSAxOwogICAgZm9yKDsgdCA+PSAwICYmIChlW3RdICYgMTkyKSA9PT0gMTI4Oyl0LS07CiAgICByZXR1cm4gdCA8IDAgfHwgdCA9PT0gMCA/IGkgOiB0ICsgRWVbZVt0XV0gPiBpID8gdCA6IGk7Cn0sIHllID0gewogICAgc3RyaW5nMmJ1Zjogcm4sCiAgICBidWYyc3RyaW5nOiBvbiwKICAgIHV0Zjhib3JkZXI6IF9uCn07CmZ1bmN0aW9uIGhuKCkgewogICAgdGhpcy5pbnB1dCA9IG51bGwsIHRoaXMubmV4dF9pbiA9IDAsIHRoaXMuYXZhaWxfaW4gPSAwLCB0aGlzLnRvdGFsX2luID0gMCwgdGhpcy5vdXRwdXQgPSBudWxsLCB0aGlzLm5leHRfb3V0ID0gMCwgdGhpcy5hdmFpbF9vdXQgPSAwLCB0aGlzLnRvdGFsX291dCA9IDAsIHRoaXMubXNnID0gIiIsIHRoaXMuc3RhdGUgPSBudWxsLCB0aGlzLmRhdGFfdHlwZSA9IDIsIHRoaXMuYWRsZXIgPSAwOwp9CnZhciB5aSA9IGhuLCBTaSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsIHsgWl9OT19GTFVTSDogZG4gLCBaX1NZTkNfRkxVU0g6IHNuICwgWl9GVUxMX0ZMVVNIOiBjbiAsIFpfRklOSVNIOiB1biAsIFpfT0s6IEJlICwgWl9TVFJFQU1fRU5EOiBibiAsIFpfREVGQVVMVF9DT01QUkVTU0lPTjogd24gLCBaX0RFRkFVTFRfU1RSQVRFR1k6IGduICwgWl9ERUZMQVRFRDogcG4gIH0gPSBuZTsKZnVuY3Rpb24gemUoZSkgewogICAgdGhpcy5vcHRpb25zID0gWWUuYXNzaWduKHsKICAgICAgICBsZXZlbDogd24sCiAgICAgICAgbWV0aG9kOiBwbiwKICAgICAgICBjaHVua1NpemU6IDE2Mzg0LAogICAgICAgIHdpbmRvd0JpdHM6IDE1LAogICAgICAgIG1lbUxldmVsOiA4LAogICAgICAgIHN0cmF0ZWd5OiBnbgogICAgfSwgZSB8fCB7fSk7CiAgICBsZXQgaSA9IHRoaXMub3B0aW9uczsKICAgIGkucmF3ICYmIGkud2luZG93Qml0cyA+IDAgPyBpLndpbmRvd0JpdHMgPSAtaS53aW5kb3dCaXRzIDogaS5nemlwICYmIGkud2luZG93Qml0cyA+IDAgJiYgaS53aW5kb3dCaXRzIDwgMTYgJiYgKGkud2luZG93Qml0cyArPSAxNiksIHRoaXMuZXJyID0gMCwgdGhpcy5tc2cgPSAiIiwgdGhpcy5lbmRlZCA9ICExLCB0aGlzLmNodW5rcyA9IFtdLCB0aGlzLnN0cm0gPSBuZXcgeWksIHRoaXMuc3RybS5hdmFpbF9vdXQgPSAwOwogICAgbGV0IHQgPSBiZS5kZWZsYXRlSW5pdDIodGhpcy5zdHJtLCBpLmxldmVsLCBpLm1ldGhvZCwgaS53aW5kb3dCaXRzLCBpLm1lbUxldmVsLCBpLnN0cmF0ZWd5KTsKICAgIGlmICh0ICE9PSBCZSkgdGhyb3cgbmV3IEVycm9yKGVlW3RdKTsKICAgIGlmIChpLmhlYWRlciAmJiBiZS5kZWZsYXRlU2V0SGVhZGVyKHRoaXMuc3RybSwgaS5oZWFkZXIpLCBpLmRpY3Rpb25hcnkpIHsKICAgICAgICBsZXQgbjsKICAgICAgICBpZiAodHlwZW9mIGkuZGljdGlvbmFyeSA9PSAic3RyaW5nIiA/IG4gPSB5ZS5zdHJpbmcyYnVmKGkuZGljdGlvbmFyeSkgOiBTaS5jYWxsKGkuZGljdGlvbmFyeSkgPT09ICJbb2JqZWN0IEFycmF5QnVmZmVyXSIgPyBuID0gbmV3IFVpbnQ4QXJyYXkoaS5kaWN0aW9uYXJ5KSA6IG4gPSBpLmRpY3Rpb25hcnksIHQgPSBiZS5kZWZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sIG4pLCB0ICE9PSBCZSkgdGhyb3cgbmV3IEVycm9yKGVlW3RdKTsKICAgICAgICB0aGlzLl9kaWN0X3NldCA9ICEwOwogICAgfQp9CnplLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oZSwgaSkgewogICAgbGV0IHQgPSB0aGlzLnN0cm0sIG4gPSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplLCBhLCBsOwogICAgaWYgKHRoaXMuZW5kZWQpIHJldHVybiAhMTsKICAgIGZvcihpID09PSB+fmkgPyBsID0gaSA6IGwgPSBpID09PSAhMCA/IHVuIDogZG4sIHR5cGVvZiBlID09ICJzdHJpbmciID8gdC5pbnB1dCA9IHllLnN0cmluZzJidWYoZSkgOiBTaS5jYWxsKGUpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID8gdC5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGUpIDogdC5pbnB1dCA9IGUsIHQubmV4dF9pbiA9IDAsIHQuYXZhaWxfaW4gPSB0LmlucHV0Lmxlbmd0aDs7KXsKICAgICAgICBpZiAodC5hdmFpbF9vdXQgPT09IDAgJiYgKHQub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobiksIHQubmV4dF9vdXQgPSAwLCB0LmF2YWlsX291dCA9IG4pLCAobCA9PT0gc24gfHwgbCA9PT0gY24pICYmIHQuYXZhaWxfb3V0IDw9IDYpIHsKICAgICAgICAgICAgdGhpcy5vbkRhdGEodC5vdXRwdXQuc3ViYXJyYXkoMCwgdC5uZXh0X291dCkpLCB0LmF2YWlsX291dCA9IDA7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYSA9IGJlLmRlZmxhdGUodCwgbCksIGEgPT09IGJuKSByZXR1cm4gdC5uZXh0X291dCA+IDAgJiYgdGhpcy5vbkRhdGEodC5vdXRwdXQuc3ViYXJyYXkoMCwgdC5uZXh0X291dCkpLCBhID0gYmUuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLCB0aGlzLm9uRW5kKGEpLCB0aGlzLmVuZGVkID0gITAsIGEgPT09IEJlOwogICAgICAgIGlmICh0LmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLm9uRGF0YSh0Lm91dHB1dCk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAobCA+IDAgJiYgdC5uZXh0X291dCA+IDApIHsKICAgICAgICAgICAgdGhpcy5vbkRhdGEodC5vdXRwdXQuc3ViYXJyYXkoMCwgdC5uZXh0X291dCkpLCB0LmF2YWlsX291dCA9IDA7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAodC5hdmFpbF9pbiA9PT0gMCkgYnJlYWs7CiAgICB9CiAgICByZXR1cm4gITA7Cn07CnplLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbihlKSB7CiAgICB0aGlzLmNodW5rcy5wdXNoKGUpOwp9Owp6ZS5wcm90b3R5cGUub25FbmQgPSBmdW5jdGlvbihlKSB7CiAgICBlID09PSBCZSAmJiAodGhpcy5yZXN1bHQgPSBZZS5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKSksIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuZXJyID0gZSwgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwp9OwpmdW5jdGlvbiBidChlLCBpKSB7CiAgICBsZXQgdCA9IG5ldyB6ZShpKTsKICAgIGlmICh0LnB1c2goZSwgITApLCB0LmVycikgdGhyb3cgdC5tc2cgfHwgZWVbdC5lcnJdOwogICAgcmV0dXJuIHQucmVzdWx0Owp9CmZ1bmN0aW9uIHhuKGUsIGkpIHsKICAgIHJldHVybiBpID0gaSB8fCB7fSwgaS5yYXcgPSAhMCwgYnQoZSwgaSk7Cn0KZnVuY3Rpb24ga24oZSwgaSkgewogICAgcmV0dXJuIGkgPSBpIHx8IHt9LCBpLmd6aXAgPSAhMCwgYnQoZSwgaSk7Cn0KdmFyIHZuID0gemUsIEVuID0gYnQsIHluID0geG4sIFNuID0ga24sIEFuID0gbmUsIFJuID0gewogICAgRGVmbGF0ZTogdm4sCiAgICBkZWZsYXRlOiBFbiwKICAgIGRlZmxhdGVSYXc6IHluLAogICAgZ3ppcDogU24sCiAgICBjb25zdGFudHM6IEFuCn0sIE9lID0gMzAsIHpuID0gMTIsIFRuID0gZnVuY3Rpb24oaSwgdCkgewogICAgbGV0IG4sIGEsIGwsIG8sIGYsIGMsIHIsIF8sIEUsIHMsIGgsIHUsIG0sIHYsIHcsIEEsIHgsIGQsIFMsIFosIGIsIHosIFIsIGcsIHAgPSBpLnN0YXRlOwogICAgbiA9IGkubmV4dF9pbiwgUiA9IGkuaW5wdXQsIGEgPSBuICsgKGkuYXZhaWxfaW4gLSA1KSwgbCA9IGkubmV4dF9vdXQsIGcgPSBpLm91dHB1dCwgbyA9IGwgLSAodCAtIGkuYXZhaWxfb3V0KSwgZiA9IGwgKyAoaS5hdmFpbF9vdXQgLSAyNTcpLCBjID0gcC5kbWF4LCByID0gcC53c2l6ZSwgXyA9IHAud2hhdmUsIEUgPSBwLnduZXh0LCBzID0gcC53aW5kb3csIGggPSBwLmhvbGQsIHUgPSBwLmJpdHMsIG0gPSBwLmxlbmNvZGUsIHYgPSBwLmRpc3Rjb2RlLCB3ID0gKDEgPDwgcC5sZW5iaXRzKSAtIDEsIEEgPSAoMSA8PCBwLmRpc3RiaXRzKSAtIDE7CiAgICBlOiBkbyB7CiAgICAgICAgdSA8IDE1ICYmIChoICs9IFJbbisrXSA8PCB1LCB1ICs9IDgsIGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCksIHggPSBtW2ggJiB3XTsKICAgICAgICB0OiBmb3IoOzspewogICAgICAgICAgICBpZiAoZCA9IHggPj4+IDI0LCBoID4+Pj0gZCwgdSAtPSBkLCBkID0geCA+Pj4gMTYgJiAyNTUsIGQgPT09IDApIGdbbCsrXSA9IHggJiA2NTUzNTsKICAgICAgICAgICAgZWxzZSBpZiAoZCAmIDE2KSB7CiAgICAgICAgICAgICAgICBTID0geCAmIDY1NTM1LCBkICY9IDE1LCBkICYmICh1IDwgZCAmJiAoaCArPSBSW24rK10gPDwgdSwgdSArPSA4KSwgUyArPSBoICYgKDEgPDwgZCkgLSAxLCBoID4+Pj0gZCwgdSAtPSBkKSwgdSA8IDE1ICYmIChoICs9IFJbbisrXSA8PCB1LCB1ICs9IDgsIGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCksIHggPSB2W2ggJiBBXTsKICAgICAgICAgICAgICAgIGk6IGZvcig7Oyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSB4ID4+PiAyNCwgaCA+Pj49IGQsIHUgLT0gZCwgZCA9IHggPj4+IDE2ICYgMjU1LCBkICYgMTYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFogPSB4ICYgNjU1MzUsIGQgJj0gMTUsIHUgPCBkICYmIChoICs9IFJbbisrXSA8PCB1LCB1ICs9IDgsIHUgPCBkICYmIChoICs9IFJbbisrXSA8PCB1LCB1ICs9IDgpKSwgWiArPSBoICYgKDEgPDwgZCkgLSAxLCBaID4gYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCBwLm1vZGUgPSBPZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGggPj4+PSBkLCB1IC09IGQsIGQgPSBsIC0gbywgWiA+IGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID0gWiAtIGQsIGQgPiBfICYmIHAuc2FuZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIiwgcC5tb2RlID0gT2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiID0gMCwgeiA9IHMsIEUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiArPSByIC0gZCwgZCA8IFMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUyAtPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyBnW2wrK10gPSBzW2IrK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgtLWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBsIC0gWiwgeiA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChFIDwgZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiICs9IHIgKyBFIC0gZCwgZCAtPSBFLCBkIDwgUykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTIC09IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIGdbbCsrXSA9IHNbYisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKC0tZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgPSAwLCBFIDwgUykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IEUsIFMgLT0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIGdbbCsrXSA9IHNbYisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgtLWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gbCAtIFosIHogPSBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChiICs9IEUgLSBkLCBkIDwgUykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgLT0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyBnW2wrK10gPSBzW2IrK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKC0tZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gbCAtIFosIHogPSBnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKDsgUyA+IDI7KWdbbCsrXSA9IHpbYisrXSwgZ1tsKytdID0geltiKytdLCBnW2wrK10gPSB6W2IrK10sIFMgLT0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgJiYgKGdbbCsrXSA9IHpbYisrXSwgUyA+IDEgJiYgKGdbbCsrXSA9IHpbYisrXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGwgLSBaOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gZ1tsKytdID0gZ1tiKytdLCBnW2wrK10gPSBnW2IrK10sIGdbbCsrXSA9IGdbYisrXSwgUyAtPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKFMgPiAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUyAmJiAoZ1tsKytdID0gZ1tiKytdLCBTID4gMSAmJiAoZ1tsKytdID0gZ1tiKytdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQgJiA2NCkgewogICAgICAgICAgICAgICAgICAgICAgICBpLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIGNvZGUiLCBwLm1vZGUgPSBPZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB4ID0gdlsoeCAmIDY1NTM1KSArIChoICYgKDEgPDwgZCkgLSAxKV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIGk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGQgJiA2NCkgaWYgKGQgJiAzMikgewogICAgICAgICAgICAgICAgcC5tb2RlID0gem47CiAgICAgICAgICAgICAgICBicmVhayBlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIiwgcC5tb2RlID0gT2U7CiAgICAgICAgICAgICAgICBicmVhayBlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgeCA9IG1bKHggJiA2NTUzNSkgKyAoaCAmICgxIDw8IGQpIC0gMSldOwogICAgICAgICAgICAgICAgY29udGludWUgdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9d2hpbGUgKG4gPCBhICYmIGwgPCBmKQogICAgUyA9IHUgPj4gMywgbiAtPSBTLCB1IC09IFMgPDwgMywgaCAmPSAoMSA8PCB1KSAtIDEsIGkubmV4dF9pbiA9IG4sIGkubmV4dF9vdXQgPSBsLCBpLmF2YWlsX2luID0gbiA8IGEgPyA1ICsgKGEgLSBuKSA6IDUgLSAobiAtIGEpLCBpLmF2YWlsX291dCA9IGwgPCBmID8gMjU3ICsgKGYgLSBsKSA6IDI1NyAtIChsIC0gZiksIHAuaG9sZCA9IGgsIHAuYml0cyA9IHU7Cn0sIGZlID0gMTUsIHp0ID0gODUyLCBUdCA9IDU5MiwgbXQgPSAwLCBxZSA9IDEsIER0ID0gMiwgbW4gPSBuZXcgVWludDE2QXJyYXkoWwogICAgMywKICAgIDQsCiAgICA1LAogICAgNiwKICAgIDcsCiAgICA4LAogICAgOSwKICAgIDEwLAogICAgMTEsCiAgICAxMywKICAgIDE1LAogICAgMTcsCiAgICAxOSwKICAgIDIzLAogICAgMjcsCiAgICAzMSwKICAgIDM1LAogICAgNDMsCiAgICA1MSwKICAgIDU5LAogICAgNjcsCiAgICA4MywKICAgIDk5LAogICAgMTE1LAogICAgMTMxLAogICAgMTYzLAogICAgMTk1LAogICAgMjI3LAogICAgMjU4LAogICAgMCwKICAgIDAKXSksIERuID0gbmV3IFVpbnQ4QXJyYXkoWwogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE3LAogICAgMTcsCiAgICAxNywKICAgIDE3LAogICAgMTgsCiAgICAxOCwKICAgIDE4LAogICAgMTgsCiAgICAxOSwKICAgIDE5LAogICAgMTksCiAgICAxOSwKICAgIDIwLAogICAgMjAsCiAgICAyMCwKICAgIDIwLAogICAgMjEsCiAgICAyMSwKICAgIDIxLAogICAgMjEsCiAgICAxNiwKICAgIDcyLAogICAgNzgKXSksIFpuID0gbmV3IFVpbnQxNkFycmF5KFsKICAgIDEsCiAgICAyLAogICAgMywKICAgIDQsCiAgICA1LAogICAgNywKICAgIDksCiAgICAxMywKICAgIDE3LAogICAgMjUsCiAgICAzMywKICAgIDQ5LAogICAgNjUsCiAgICA5NywKICAgIDEyOSwKICAgIDE5MywKICAgIDI1NywKICAgIDM4NSwKICAgIDUxMywKICAgIDc2OSwKICAgIDEwMjUsCiAgICAxNTM3LAogICAgMjA0OSwKICAgIDMwNzMsCiAgICA0MDk3LAogICAgNjE0NSwKICAgIDgxOTMsCiAgICAxMjI4OSwKICAgIDE2Mzg1LAogICAgMjQ1NzcsCiAgICAwLAogICAgMApdKSwgSW4gPSBuZXcgVWludDhBcnJheShbCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE3LAogICAgMTcsCiAgICAxOCwKICAgIDE4LAogICAgMTksCiAgICAxOSwKICAgIDIwLAogICAgMjAsCiAgICAyMSwKICAgIDIxLAogICAgMjIsCiAgICAyMiwKICAgIDIzLAogICAgMjMsCiAgICAyNCwKICAgIDI0LAogICAgMjUsCiAgICAyNSwKICAgIDI2LAogICAgMjYsCiAgICAyNywKICAgIDI3LAogICAgMjgsCiAgICAyOCwKICAgIDI5LAogICAgMjksCiAgICA2NCwKICAgIDY0Cl0pLCBPbiA9IChlLCBpLCB0LCBuLCBhLCBsLCBvLCBmKT0+ewogICAgbGV0IGMgPSBmLmJpdHMsIHIgPSAwLCBfID0gMCwgRSA9IDAsIHMgPSAwLCBoID0gMCwgdSA9IDAsIG0gPSAwLCB2ID0gMCwgdyA9IDAsIEEgPSAwLCB4LCBkLCBTLCBaLCBiLCB6ID0gbnVsbCwgUiA9IDAsIGcsIHAgPSBuZXcgVWludDE2QXJyYXkoZmUgKyAxKSwgSiA9IG5ldyBVaW50MTZBcnJheShmZSArIDEpLCBtZSA9IG51bGwsIGd0ID0gMCwgcHQsIERlLCBaZTsKICAgIGZvcihyID0gMDsgciA8PSBmZTsgcisrKXBbcl0gPSAwOwogICAgZm9yKF8gPSAwOyBfIDwgbjsgXysrKXBbaVt0ICsgX11dKys7CiAgICBmb3IoaCA9IGMsIHMgPSBmZTsgcyA+PSAxICYmIHBbc10gPT09IDA7IHMtLSk7CiAgICBpZiAoaCA+IHMgJiYgKGggPSBzKSwgcyA9PT0gMCkgcmV0dXJuIGFbbCsrXSA9IDEgPDwgMjQgfCA2NCA8PCAxNiB8IDAsIGFbbCsrXSA9IDEgPDwgMjQgfCA2NCA8PCAxNiB8IDAsIGYuYml0cyA9IDEsIDA7CiAgICBmb3IoRSA9IDE7IEUgPCBzICYmIHBbRV0gPT09IDA7IEUrKyk7CiAgICBmb3IoaCA8IEUgJiYgKGggPSBFKSwgdiA9IDEsIHIgPSAxOyByIDw9IGZlOyByKyspaWYgKHYgPDw9IDEsIHYgLT0gcFtyXSwgdiA8IDApIHJldHVybiAtMTsKICAgIGlmICh2ID4gMCAmJiAoZSA9PT0gbXQgfHwgcyAhPT0gMSkpIHJldHVybiAtMTsKICAgIGZvcihKWzFdID0gMCwgciA9IDE7IHIgPCBmZTsgcisrKUpbciArIDFdID0gSltyXSArIHBbcl07CiAgICBmb3IoXyA9IDA7IF8gPCBuOyBfKyspaVt0ICsgX10gIT09IDAgJiYgKG9bSltpW3QgKyBfXV0rK10gPSBfKTsKICAgIGlmIChlID09PSBtdCA/ICh6ID0gbWUgPSBvLCBnID0gMTkpIDogZSA9PT0gcWUgPyAoeiA9IG1uLCBSIC09IDI1NywgbWUgPSBEbiwgZ3QgLT0gMjU3LCBnID0gMjU2KSA6ICh6ID0gWm4sIG1lID0gSW4sIGcgPSAtMSksIEEgPSAwLCBfID0gMCwgciA9IEUsIGIgPSBsLCB1ID0gaCwgbSA9IDAsIFMgPSAtMSwgdyA9IDEgPDwgaCwgWiA9IHcgLSAxLCBlID09PSBxZSAmJiB3ID4genQgfHwgZSA9PT0gRHQgJiYgdyA+IFR0KSByZXR1cm4gMTsKICAgIGZvcig7Oyl7CiAgICAgICAgcHQgPSByIC0gbSwgb1tfXSA8IGcgPyAoRGUgPSAwLCBaZSA9IG9bX10pIDogb1tfXSA+IGcgPyAoRGUgPSBtZVtndCArIG9bX11dLCBaZSA9IHpbUiArIG9bX11dKSA6IChEZSA9IDMyICsgNjQsIFplID0gMCksIHggPSAxIDw8IHIgLSBtLCBkID0gMSA8PCB1LCBFID0gZDsKICAgICAgICBkbyBkIC09IHgsIGFbYiArIChBID4+IG0pICsgZF0gPSBwdCA8PCAyNCB8IERlIDw8IDE2IHwgWmUgfCAwOwogICAgICAgIHdoaWxlIChkICE9PSAwKQogICAgICAgIGZvcih4ID0gMSA8PCByIC0gMTsgQSAmIHg7KXggPj49IDE7CiAgICAgICAgaWYgKHggIT09IDAgPyAoQSAmPSB4IC0gMSwgQSArPSB4KSA6IEEgPSAwLCBfKyssIC0tcFtyXSA9PT0gMCkgewogICAgICAgICAgICBpZiAociA9PT0gcykgYnJlYWs7CiAgICAgICAgICAgIHIgPSBpW3QgKyBvW19dXTsKICAgICAgICB9CiAgICAgICAgaWYgKHIgPiBoICYmIChBICYgWikgIT09IFMpIHsKICAgICAgICAgICAgZm9yKG0gPT09IDAgJiYgKG0gPSBoKSwgYiArPSBFLCB1ID0gciAtIG0sIHYgPSAxIDw8IHU7IHUgKyBtIDwgcyAmJiAodiAtPSBwW3UgKyBtXSwgISh2IDw9IDApKTspdSsrLCB2IDw8PSAxOwogICAgICAgICAgICBpZiAodyArPSAxIDw8IHUsIGUgPT09IHFlICYmIHcgPiB6dCB8fCBlID09PSBEdCAmJiB3ID4gVHQpIHJldHVybiAxOwogICAgICAgICAgICBTID0gQSAmIFosIGFbU10gPSBoIDw8IDI0IHwgdSA8PCAxNiB8IGIgLSBsIHwgMDsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gQSAhPT0gMCAmJiAoYVtiICsgQV0gPSByIC0gbSA8PCAyNCB8IDY0IDw8IDE2IHwgMCksIGYuYml0cyA9IGgsIDA7Cn0sIHdlID0gT24sIE5uID0gMCwgQWkgPSAxLCBSaSA9IDIsIHsgWl9GSU5JU0g6IFp0ICwgWl9CTE9DSzogTG4gLCBaX1RSRUVTOiBOZSAsIFpfT0s6IGFlICwgWl9TVFJFQU1fRU5EOiBVbiAsIFpfTkVFRF9ESUNUOiAkbiAsIFpfU1RSRUFNX0VSUk9SOiBVICwgWl9EQVRBX0VSUk9SOiB6aSAsIFpfTUVNX0VSUk9SOiBUaSAsIFpfQlVGX0VSUk9SOiBDbiAsIFpfREVGTEFURUQ6IEl0ICB9ID0gbmUsIG1pID0gMSwgT3QgPSAyLCBOdCA9IDMsIEx0ID0gNCwgVXQgPSA1LCAkdCA9IDYsIEN0ID0gNywgRnQgPSA4LCBNdCA9IDksIEh0ID0gMTAsIEtlID0gMTEsIEggPSAxMiwgZXQgPSAxMywgQnQgPSAxNCwgdHQgPSAxNSwgS3QgPSAxNiwgUHQgPSAxNywgWHQgPSAxOCwgWXQgPSAxOSwgTGUgPSAyMCwgVWUgPSAyMSwgR3QgPSAyMiwganQgPSAyMywgV3QgPSAyNCwgVnQgPSAyNSwgSnQgPSAyNiwgaXQgPSAyNywgUXQgPSAyOCwgcXQgPSAyOSwgVCA9IDMwLCBEaSA9IDMxLCBGbiA9IDMyLCBNbiA9IDg1MiwgSG4gPSA1OTIsIEJuID0gMTUsIEtuID0gQm4sIGVpID0gKGUpPT4oZSA+Pj4gMjQgJiAyNTUpICsgKGUgPj4+IDggJiA2NTI4MCkgKyAoKGUgJiA2NTI4MCkgPDwgOCkgKyAoKGUgJiAyNTUpIDw8IDI0KTsKZnVuY3Rpb24gUG4oKSB7CiAgICB0aGlzLm1vZGUgPSAwLCB0aGlzLmxhc3QgPSAhMSwgdGhpcy53cmFwID0gMCwgdGhpcy5oYXZlZGljdCA9ICExLCB0aGlzLmZsYWdzID0gMCwgdGhpcy5kbWF4ID0gMCwgdGhpcy5jaGVjayA9IDAsIHRoaXMudG90YWwgPSAwLCB0aGlzLmhlYWQgPSBudWxsLCB0aGlzLndiaXRzID0gMCwgdGhpcy53c2l6ZSA9IDAsIHRoaXMud2hhdmUgPSAwLCB0aGlzLnduZXh0ID0gMCwgdGhpcy53aW5kb3cgPSBudWxsLCB0aGlzLmhvbGQgPSAwLCB0aGlzLmJpdHMgPSAwLCB0aGlzLmxlbmd0aCA9IDAsIHRoaXMub2Zmc2V0ID0gMCwgdGhpcy5leHRyYSA9IDAsIHRoaXMubGVuY29kZSA9IG51bGwsIHRoaXMuZGlzdGNvZGUgPSBudWxsLCB0aGlzLmxlbmJpdHMgPSAwLCB0aGlzLmRpc3RiaXRzID0gMCwgdGhpcy5uY29kZSA9IDAsIHRoaXMubmxlbiA9IDAsIHRoaXMubmRpc3QgPSAwLCB0aGlzLmhhdmUgPSAwLCB0aGlzLm5leHQgPSBudWxsLCB0aGlzLmxlbnMgPSBuZXcgVWludDE2QXJyYXkoMzIwKSwgdGhpcy53b3JrID0gbmV3IFVpbnQxNkFycmF5KDI4OCksIHRoaXMubGVuZHluID0gbnVsbCwgdGhpcy5kaXN0ZHluID0gbnVsbCwgdGhpcy5zYW5lID0gMCwgdGhpcy5iYWNrID0gMCwgdGhpcy53YXMgPSAwOwp9CnZhciBaaSA9IChlKT0+ewogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gVTsKICAgIGxldCBpID0gZS5zdGF0ZTsKICAgIHJldHVybiBlLnRvdGFsX2luID0gZS50b3RhbF9vdXQgPSBpLnRvdGFsID0gMCwgZS5tc2cgPSAiIiwgaS53cmFwICYmIChlLmFkbGVyID0gaS53cmFwICYgMSksIGkubW9kZSA9IG1pLCBpLmxhc3QgPSAwLCBpLmhhdmVkaWN0ID0gMCwgaS5kbWF4ID0gMzI3NjgsIGkuaGVhZCA9IG51bGwsIGkuaG9sZCA9IDAsIGkuYml0cyA9IDAsIGkubGVuY29kZSA9IGkubGVuZHluID0gbmV3IEludDMyQXJyYXkoTW4pLCBpLmRpc3Rjb2RlID0gaS5kaXN0ZHluID0gbmV3IEludDMyQXJyYXkoSG4pLCBpLnNhbmUgPSAxLCBpLmJhY2sgPSAtMSwgYWU7Cn0sIElpID0gKGUpPT57CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBVOwogICAgbGV0IGkgPSBlLnN0YXRlOwogICAgcmV0dXJuIGkud3NpemUgPSAwLCBpLndoYXZlID0gMCwgaS53bmV4dCA9IDAsIFppKGUpOwp9LCBPaSA9IChlLCBpKT0+ewogICAgbGV0IHQ7CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBVOwogICAgbGV0IG4gPSBlLnN0YXRlOwogICAgcmV0dXJuIGkgPCAwID8gKHQgPSAwLCBpID0gLWkpIDogKHQgPSAoaSA+PiA0KSArIDEsIGkgPCA0OCAmJiAoaSAmPSAxNSkpLCBpICYmIChpIDwgOCB8fCBpID4gMTUpID8gVSA6IChuLndpbmRvdyAhPT0gbnVsbCAmJiBuLndiaXRzICE9PSBpICYmIChuLndpbmRvdyA9IG51bGwpLCBuLndyYXAgPSB0LCBuLndiaXRzID0gaSwgSWkoZSkpOwp9LCBOaSA9IChlLCBpKT0+ewogICAgaWYgKCFlKSByZXR1cm4gVTsKICAgIGxldCB0ID0gbmV3IFBuOwogICAgZS5zdGF0ZSA9IHQsIHQud2luZG93ID0gbnVsbDsKICAgIGxldCBuID0gT2koZSwgaSk7CiAgICByZXR1cm4gbiAhPT0gYWUgJiYgKGUuc3RhdGUgPSBudWxsKSwgbjsKfSwgWG4gPSAoZSk9Pk5pKGUsIEtuKSwgdGkgPSAhMCwgYXQsIG50LCBZbiA9IChlKT0+ewogICAgaWYgKHRpKSB7CiAgICAgICAgYXQgPSBuZXcgSW50MzJBcnJheSg1MTIpLCBudCA9IG5ldyBJbnQzMkFycmF5KDMyKTsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgZm9yKDsgaSA8IDE0NDspZS5sZW5zW2krK10gPSA4OwogICAgICAgIGZvcig7IGkgPCAyNTY7KWUubGVuc1tpKytdID0gOTsKICAgICAgICBmb3IoOyBpIDwgMjgwOyllLmxlbnNbaSsrXSA9IDc7CiAgICAgICAgZm9yKDsgaSA8IDI4ODspZS5sZW5zW2krK10gPSA4OwogICAgICAgIGZvcih3ZShBaSwgZS5sZW5zLCAwLCAyODgsIGF0LCAwLCBlLndvcmssIHsKICAgICAgICAgICAgYml0czogOQogICAgICAgIH0pLCBpID0gMDsgaSA8IDMyOyllLmxlbnNbaSsrXSA9IDU7CiAgICAgICAgd2UoUmksIGUubGVucywgMCwgMzIsIG50LCAwLCBlLndvcmssIHsKICAgICAgICAgICAgYml0czogNQogICAgICAgIH0pLCB0aSA9ICExOwogICAgfQogICAgZS5sZW5jb2RlID0gYXQsIGUubGVuYml0cyA9IDksIGUuZGlzdGNvZGUgPSBudCwgZS5kaXN0Yml0cyA9IDU7Cn0sIExpID0gKGUsIGksIHQsIG4pPT57CiAgICBsZXQgYSwgbCA9IGUuc3RhdGU7CiAgICByZXR1cm4gbC53aW5kb3cgPT09IG51bGwgJiYgKGwud3NpemUgPSAxIDw8IGwud2JpdHMsIGwud25leHQgPSAwLCBsLndoYXZlID0gMCwgbC53aW5kb3cgPSBuZXcgVWludDhBcnJheShsLndzaXplKSksIG4gPj0gbC53c2l6ZSA/IChsLndpbmRvdy5zZXQoaS5zdWJhcnJheSh0IC0gbC53c2l6ZSwgdCksIDApLCBsLnduZXh0ID0gMCwgbC53aGF2ZSA9IGwud3NpemUpIDogKGEgPSBsLndzaXplIC0gbC53bmV4dCwgYSA+IG4gJiYgKGEgPSBuKSwgbC53aW5kb3cuc2V0KGkuc3ViYXJyYXkodCAtIG4sIHQgLSBuICsgYSksIGwud25leHQpLCBuIC09IGEsIG4gPyAobC53aW5kb3cuc2V0KGkuc3ViYXJyYXkodCAtIG4sIHQpLCAwKSwgbC53bmV4dCA9IG4sIGwud2hhdmUgPSBsLndzaXplKSA6IChsLnduZXh0ICs9IGEsIGwud25leHQgPT09IGwud3NpemUgJiYgKGwud25leHQgPSAwKSwgbC53aGF2ZSA8IGwud3NpemUgJiYgKGwud2hhdmUgKz0gYSkpKSwgMDsKfSwgR24gPSAoZSwgaSk9PnsKICAgIGxldCB0LCBuLCBhLCBsLCBvLCBmLCBjLCByLCBfLCBFLCBzLCBoLCB1LCBtLCB2ID0gMCwgdywgQSwgeCwgZCwgUywgWiwgYiwgeiwgUiA9IG5ldyBVaW50OEFycmF5KDQpLCBnLCBwLCBKID0gbmV3IFVpbnQ4QXJyYXkoWwogICAgICAgIDE2LAogICAgICAgIDE3LAogICAgICAgIDE4LAogICAgICAgIDAsCiAgICAgICAgOCwKICAgICAgICA3LAogICAgICAgIDksCiAgICAgICAgNiwKICAgICAgICAxMCwKICAgICAgICA1LAogICAgICAgIDExLAogICAgICAgIDQsCiAgICAgICAgMTIsCiAgICAgICAgMywKICAgICAgICAxMywKICAgICAgICAyLAogICAgICAgIDE0LAogICAgICAgIDEsCiAgICAgICAgMTUKICAgIF0pOwogICAgaWYgKCFlIHx8ICFlLnN0YXRlIHx8ICFlLm91dHB1dCB8fCAhZS5pbnB1dCAmJiBlLmF2YWlsX2luICE9PSAwKSByZXR1cm4gVTsKICAgIHQgPSBlLnN0YXRlLCB0Lm1vZGUgPT09IEggJiYgKHQubW9kZSA9IGV0KSwgbyA9IGUubmV4dF9vdXQsIGEgPSBlLm91dHB1dCwgYyA9IGUuYXZhaWxfb3V0LCBsID0gZS5uZXh0X2luLCBuID0gZS5pbnB1dCwgZiA9IGUuYXZhaWxfaW4sIHIgPSB0LmhvbGQsIF8gPSB0LmJpdHMsIEUgPSBmLCBzID0gYywgeiA9IGFlOwogICAgZTogZm9yKDs7KXN3aXRjaCh0Lm1vZGUpewogICAgICAgIGNhc2UgbWk6CiAgICAgICAgICAgIGlmICh0LndyYXAgPT09IDApIHsKICAgICAgICAgICAgICAgIHQubW9kZSA9IGV0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LndyYXAgJiAyICYmIHIgPT09IDM1NjE1KSB7CiAgICAgICAgICAgICAgICB0LmNoZWNrID0gMCwgUlswXSA9IHIgJiAyNTUsIFJbMV0gPSByID4+PiA4ICYgMjU1LCB0LmNoZWNrID0gSSh0LmNoZWNrLCBSLCAyLCAwKSwgciA9IDAsIF8gPSAwLCB0Lm1vZGUgPSBPdDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LmZsYWdzID0gMCwgdC5oZWFkICYmICh0LmhlYWQuZG9uZSA9ICExKSwgISh0LndyYXAgJiAxKSB8fCAoKChyICYgMjU1KSA8PCA4KSArIChyID4+IDgpKSAlIDMxKSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbmNvcnJlY3QgaGVhZGVyIGNoZWNrIiwgdC5tb2RlID0gVDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgociAmIDE1KSAhPT0gSXQpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gInVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIiwgdC5tb2RlID0gVDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyID4+Pj0gNCwgXyAtPSA0LCBiID0gKHIgJiAxNSkgKyA4LCB0LndiaXRzID09PSAwKSB0LndiaXRzID0gYjsKICAgICAgICAgICAgZWxzZSBpZiAoYiA+IHQud2JpdHMpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgd2luZG93IHNpemUiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5kbWF4ID0gMSA8PCB0LndiaXRzLCBlLmFkbGVyID0gdC5jaGVjayA9IDEsIHQubW9kZSA9IHIgJiA1MTIgPyBIdCA6IEgsIHIgPSAwLCBfID0gMDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBPdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LmZsYWdzID0gciwgKHQuZmxhZ3MgJiAyNTUpICE9PSBJdCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAidW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQuZmxhZ3MgJiA1NzM0NCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAidW5rbm93biBoZWFkZXIgZmxhZ3Mgc2V0IiwgdC5tb2RlID0gVDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQuaGVhZCAmJiAodC5oZWFkLnRleHQgPSByID4+IDggJiAxKSwgdC5mbGFncyAmIDUxMiAmJiAoUlswXSA9IHIgJiAyNTUsIFJbMV0gPSByID4+PiA4ICYgMjU1LCB0LmNoZWNrID0gSSh0LmNoZWNrLCBSLCAyLCAwKSksIHIgPSAwLCBfID0gMCwgdC5tb2RlID0gTnQ7CiAgICAgICAgY2FzZSBOdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDMyOyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQuaGVhZCAmJiAodC5oZWFkLnRpbWUgPSByKSwgdC5mbGFncyAmIDUxMiAmJiAoUlswXSA9IHIgJiAyNTUsIFJbMV0gPSByID4+PiA4ICYgMjU1LCBSWzJdID0gciA+Pj4gMTYgJiAyNTUsIFJbM10gPSByID4+PiAyNCAmIDI1NSwgdC5jaGVjayA9IEkodC5jaGVjaywgUiwgNCwgMCkpLCByID0gMCwgXyA9IDAsIHQubW9kZSA9IEx0OwogICAgICAgIGNhc2UgTHQ6CiAgICAgICAgICAgIGZvcig7IF8gPCAxNjspewogICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICB0LmhlYWQgJiYgKHQuaGVhZC54ZmxhZ3MgPSByICYgMjU1LCB0LmhlYWQub3MgPSByID4+IDgpLCB0LmZsYWdzICYgNTEyICYmIChSWzBdID0gciAmIDI1NSwgUlsxXSA9IHIgPj4+IDggJiAyNTUsIHQuY2hlY2sgPSBJKHQuY2hlY2ssIFIsIDIsIDApKSwgciA9IDAsIF8gPSAwLCB0Lm1vZGUgPSBVdDsKICAgICAgICBjYXNlIFV0OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDEwMjQpIHsKICAgICAgICAgICAgICAgIGZvcig7IF8gPCAxNjspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdC5sZW5ndGggPSByLCB0LmhlYWQgJiYgKHQuaGVhZC5leHRyYV9sZW4gPSByKSwgdC5mbGFncyAmIDUxMiAmJiAoUlswXSA9IHIgJiAyNTUsIFJbMV0gPSByID4+PiA4ICYgMjU1LCB0LmNoZWNrID0gSSh0LmNoZWNrLCBSLCAyLCAwKSksIHIgPSAwLCBfID0gMDsKICAgICAgICAgICAgfSBlbHNlIHQuaGVhZCAmJiAodC5oZWFkLmV4dHJhID0gbnVsbCk7CiAgICAgICAgICAgIHQubW9kZSA9ICR0OwogICAgICAgIGNhc2UgJHQ6CiAgICAgICAgICAgIGlmICh0LmZsYWdzICYgMTAyNCAmJiAoaCA9IHQubGVuZ3RoLCBoID4gZiAmJiAoaCA9IGYpLCBoICYmICh0LmhlYWQgJiYgKGIgPSB0LmhlYWQuZXh0cmFfbGVuIC0gdC5sZW5ndGgsIHQuaGVhZC5leHRyYSB8fCAodC5oZWFkLmV4dHJhID0gbmV3IFVpbnQ4QXJyYXkodC5oZWFkLmV4dHJhX2xlbikpLCB0LmhlYWQuZXh0cmEuc2V0KG4uc3ViYXJyYXkobCwgbCArIGgpLCBiKSksIHQuZmxhZ3MgJiA1MTIgJiYgKHQuY2hlY2sgPSBJKHQuY2hlY2ssIG4sIGgsIGwpKSwgZiAtPSBoLCBsICs9IGgsIHQubGVuZ3RoIC09IGgpLCB0Lmxlbmd0aCkpIGJyZWFrIGU7CiAgICAgICAgICAgIHQubGVuZ3RoID0gMCwgdC5tb2RlID0gQ3Q7CiAgICAgICAgY2FzZSBDdDoKICAgICAgICAgICAgaWYgKHQuZmxhZ3MgJiAyMDQ4KSB7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGggPSAwOwogICAgICAgICAgICAgICAgZG8gYiA9IG5bbCArIGgrK10sIHQuaGVhZCAmJiBiICYmIHQubGVuZ3RoIDwgNjU1MzYgJiYgKHQuaGVhZC5uYW1lICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYikpOwogICAgICAgICAgICAgICAgd2hpbGUgKGIgJiYgaCA8IGYpCiAgICAgICAgICAgICAgICBpZiAodC5mbGFncyAmIDUxMiAmJiAodC5jaGVjayA9IEkodC5jaGVjaywgbiwgaCwgbCkpLCBmIC09IGgsIGwgKz0gaCwgYikgYnJlYWsgZTsKICAgICAgICAgICAgfSBlbHNlIHQuaGVhZCAmJiAodC5oZWFkLm5hbWUgPSBudWxsKTsKICAgICAgICAgICAgdC5sZW5ndGggPSAwLCB0Lm1vZGUgPSBGdDsKICAgICAgICBjYXNlIEZ0OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDQwOTYpIHsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgaCA9IDA7CiAgICAgICAgICAgICAgICBkbyBiID0gbltsICsgaCsrXSwgdC5oZWFkICYmIGIgJiYgdC5sZW5ndGggPCA2NTUzNiAmJiAodC5oZWFkLmNvbW1lbnQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShiKSk7CiAgICAgICAgICAgICAgICB3aGlsZSAoYiAmJiBoIDwgZikKICAgICAgICAgICAgICAgIGlmICh0LmZsYWdzICYgNTEyICYmICh0LmNoZWNrID0gSSh0LmNoZWNrLCBuLCBoLCBsKSksIGYgLT0gaCwgbCArPSBoLCBiKSBicmVhayBlOwogICAgICAgICAgICB9IGVsc2UgdC5oZWFkICYmICh0LmhlYWQuY29tbWVudCA9IG51bGwpOwogICAgICAgICAgICB0Lm1vZGUgPSBNdDsKICAgICAgICBjYXNlIE10OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAociAhPT0gKHQuY2hlY2sgJiA2NTUzNSkpIHsKICAgICAgICAgICAgICAgICAgICBlLm1zZyA9ICJoZWFkZXIgY3JjIG1pc21hdGNoIiwgdC5tb2RlID0gVDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHIgPSAwLCBfID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0LmhlYWQgJiYgKHQuaGVhZC5oY3JjID0gdC5mbGFncyA+PiA5ICYgMSwgdC5oZWFkLmRvbmUgPSAhMCksIGUuYWRsZXIgPSB0LmNoZWNrID0gMCwgdC5tb2RlID0gSDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBIdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDMyOyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUuYWRsZXIgPSB0LmNoZWNrID0gZWkociksIHIgPSAwLCBfID0gMCwgdC5tb2RlID0gS2U7CiAgICAgICAgY2FzZSBLZToKICAgICAgICAgICAgaWYgKHQuaGF2ZWRpY3QgPT09IDApIHJldHVybiBlLm5leHRfb3V0ID0gbywgZS5hdmFpbF9vdXQgPSBjLCBlLm5leHRfaW4gPSBsLCBlLmF2YWlsX2luID0gZiwgdC5ob2xkID0gciwgdC5iaXRzID0gXywgJG47CiAgICAgICAgICAgIGUuYWRsZXIgPSB0LmNoZWNrID0gMSwgdC5tb2RlID0gSDsKICAgICAgICBjYXNlIEg6CiAgICAgICAgICAgIGlmIChpID09PSBMbiB8fCBpID09PSBOZSkgYnJlYWsgZTsKICAgICAgICBjYXNlIGV0OgogICAgICAgICAgICBpZiAodC5sYXN0KSB7CiAgICAgICAgICAgICAgICByID4+Pj0gXyAmIDcsIF8gLT0gXyAmIDcsIHQubW9kZSA9IGl0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKDsgXyA8IDM7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoKHQubGFzdCA9IHIgJiAxLCByID4+Pj0gMSwgXyAtPSAxLCByICYgMyl7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgdC5tb2RlID0gQnQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgaWYgKFluKHQpLCB0Lm1vZGUgPSBMZSwgaSA9PT0gTmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgciA+Pj49IDIsIF8gLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgdC5tb2RlID0gUHQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBibG9jayB0eXBlIiwgdC5tb2RlID0gVDsKICAgICAgICAgICAgfQogICAgICAgICAgICByID4+Pj0gMiwgXyAtPSAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEJ0OgogICAgICAgICAgICBmb3IociA+Pj49IF8gJiA3LCBfIC09IF8gJiA3OyBfIDwgMzI7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChyICYgNjU1MzUpICE9PSAociA+Pj4gMTYgXiA2NTUzNSkpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgc3RvcmVkIGJsb2NrIGxlbmd0aHMiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubGVuZ3RoID0gciAmIDY1NTM1LCByID0gMCwgXyA9IDAsIHQubW9kZSA9IHR0LCBpID09PSBOZSkgYnJlYWsgZTsKICAgICAgICBjYXNlIHR0OgogICAgICAgICAgICB0Lm1vZGUgPSBLdDsKICAgICAgICBjYXNlIEt0OgogICAgICAgICAgICBpZiAoaCA9IHQubGVuZ3RoLCBoKSB7CiAgICAgICAgICAgICAgICBpZiAoaCA+IGYgJiYgKGggPSBmKSwgaCA+IGMgJiYgKGggPSBjKSwgaCA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGEuc2V0KG4uc3ViYXJyYXkobCwgbCArIGgpLCBvKSwgZiAtPSBoLCBsICs9IGgsIGMgLT0gaCwgbyArPSBoLCB0Lmxlbmd0aCAtPSBoOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5tb2RlID0gSDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBQdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDE0Oyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0Lm5sZW4gPSAociAmIDMxKSArIDI1NywgciA+Pj49IDUsIF8gLT0gNSwgdC5uZGlzdCA9IChyICYgMzEpICsgMSwgciA+Pj49IDUsIF8gLT0gNSwgdC5uY29kZSA9IChyICYgMTUpICsgNCwgciA+Pj49IDQsIF8gLT0gNCwgdC5ubGVuID4gMjg2IHx8IHQubmRpc3QgPiAzMCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAidG9vIG1hbnkgbGVuZ3RoIG9yIGRpc3RhbmNlIHN5bWJvbHMiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5oYXZlID0gMCwgdC5tb2RlID0gWHQ7CiAgICAgICAgY2FzZSBYdDoKICAgICAgICAgICAgZm9yKDsgdC5oYXZlIDwgdC5uY29kZTspewogICAgICAgICAgICAgICAgZm9yKDsgXyA8IDM7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHQubGVuc1tKW3QuaGF2ZSsrXV0gPSByICYgNywgciA+Pj49IDMsIF8gLT0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IoOyB0LmhhdmUgPCAxOTspdC5sZW5zW0pbdC5oYXZlKytdXSA9IDA7CiAgICAgICAgICAgIGlmICh0LmxlbmNvZGUgPSB0LmxlbmR5biwgdC5sZW5iaXRzID0gNywgZyA9IHsKICAgICAgICAgICAgICAgIGJpdHM6IHQubGVuYml0cwogICAgICAgICAgICB9LCB6ID0gd2UoTm4sIHQubGVucywgMCwgMTksIHQubGVuY29kZSwgMCwgdC53b3JrLCBnKSwgdC5sZW5iaXRzID0gZy5iaXRzLCB6KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGNvZGUgbGVuZ3RocyBzZXQiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5oYXZlID0gMCwgdC5tb2RlID0gWXQ7CiAgICAgICAgY2FzZSBZdDoKICAgICAgICAgICAgZm9yKDsgdC5oYXZlIDwgdC5ubGVuICsgdC5uZGlzdDspewogICAgICAgICAgICAgICAgZm9yKDsgdiA9IHQubGVuY29kZVtyICYgKDEgPDwgdC5sZW5iaXRzKSAtIDFdLCB3ID0gdiA+Pj4gMjQsIEEgPSB2ID4+PiAxNiAmIDI1NSwgeCA9IHYgJiA2NTUzNSwgISh3IDw9IF8pOyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoeCA8IDE2KSByID4+Pj0gdywgXyAtPSB3LCB0LmxlbnNbdC5oYXZlKytdID0geDsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh4ID09PSAxNikgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IocCA9IHcgKyAyOyBfIDwgcDspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAociA+Pj49IHcsIF8gLT0gdywgdC5oYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGJpdCBsZW5ndGggcmVwZWF0IiwgdC5tb2RlID0gVDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSB0LmxlbnNbdC5oYXZlIC0gMV0sIGggPSAzICsgKHIgJiAzKSwgciA+Pj49IDIsIF8gLT0gMjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHggPT09IDE3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihwID0gdyArIDM7IF8gPCBwOyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHIgPj4+PSB3LCBfIC09IHcsIGIgPSAwLCBoID0gMyArIChyICYgNyksIHIgPj4+PSAzLCBfIC09IDM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHAgPSB3ICsgNzsgXyA8IHA7KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgciA+Pj49IHcsIF8gLT0gdywgYiA9IDAsIGggPSAxMSArIChyICYgMTI3KSwgciA+Pj49IDcsIF8gLT0gNzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHQuaGF2ZSArIGggPiB0Lm5sZW4gKyB0Lm5kaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgYml0IGxlbmd0aCByZXBlYXQiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yKDsgaC0tOyl0LmxlbnNbdC5oYXZlKytdID0gYjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5tb2RlID09PSBUKSBicmVhazsKICAgICAgICAgICAgaWYgKHQubGVuc1syNTZdID09PSAwKSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGNvZGUgLS0gbWlzc2luZyBlbmQtb2YtYmxvY2siLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubGVuYml0cyA9IDksIGcgPSB7CiAgICAgICAgICAgICAgICBiaXRzOiB0LmxlbmJpdHMKICAgICAgICAgICAgfSwgeiA9IHdlKEFpLCB0LmxlbnMsIDAsIHQubmxlbiwgdC5sZW5jb2RlLCAwLCB0LndvcmssIGcpLCB0LmxlbmJpdHMgPSBnLmJpdHMsIHopIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgbGl0ZXJhbC9sZW5ndGhzIHNldCIsIHQubW9kZSA9IFQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5kaXN0Yml0cyA9IDYsIHQuZGlzdGNvZGUgPSB0LmRpc3RkeW4sIGcgPSB7CiAgICAgICAgICAgICAgICBiaXRzOiB0LmRpc3RiaXRzCiAgICAgICAgICAgIH0sIHogPSB3ZShSaSwgdC5sZW5zLCB0Lm5sZW4sIHQubmRpc3QsIHQuZGlzdGNvZGUsIDAsIHQud29yaywgZyksIHQuZGlzdGJpdHMgPSBnLmJpdHMsIHopIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgZGlzdGFuY2VzIHNldCIsIHQubW9kZSA9IFQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5tb2RlID0gTGUsIGkgPT09IE5lKSBicmVhayBlOwogICAgICAgIGNhc2UgTGU6CiAgICAgICAgICAgIHQubW9kZSA9IFVlOwogICAgICAgIGNhc2UgVWU6CiAgICAgICAgICAgIGlmIChmID49IDYgJiYgYyA+PSAyNTgpIHsKICAgICAgICAgICAgICAgIGUubmV4dF9vdXQgPSBvLCBlLmF2YWlsX291dCA9IGMsIGUubmV4dF9pbiA9IGwsIGUuYXZhaWxfaW4gPSBmLCB0LmhvbGQgPSByLCB0LmJpdHMgPSBfLCBUbihlLCBzKSwgbyA9IGUubmV4dF9vdXQsIGEgPSBlLm91dHB1dCwgYyA9IGUuYXZhaWxfb3V0LCBsID0gZS5uZXh0X2luLCBuID0gZS5pbnB1dCwgZiA9IGUuYXZhaWxfaW4sIHIgPSB0LmhvbGQsIF8gPSB0LmJpdHMsIHQubW9kZSA9PT0gSCAmJiAodC5iYWNrID0gLTEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKHQuYmFjayA9IDA7IHYgPSB0LmxlbmNvZGVbciAmICgxIDw8IHQubGVuYml0cykgLSAxXSwgdyA9IHYgPj4+IDI0LCBBID0gdiA+Pj4gMTYgJiAyNTUsIHggPSB2ICYgNjU1MzUsICEodyA8PSBfKTspewogICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoQSAmJiAhKEEgJiAyNDApKSB7CiAgICAgICAgICAgICAgICBmb3IoZCA9IHcsIFMgPSBBLCBaID0geDsgdiA9IHQubGVuY29kZVtaICsgKChyICYgKDEgPDwgZCArIFMpIC0gMSkgPj4gZCldLCB3ID0gdiA+Pj4gMjQsIEEgPSB2ID4+PiAxNiAmIDI1NSwgeCA9IHYgJiA2NTUzNSwgIShkICsgdyA8PSBfKTspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgciA+Pj49IGQsIF8gLT0gZCwgdC5iYWNrICs9IGQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHIgPj4+PSB3LCBfIC09IHcsIHQuYmFjayArPSB3LCB0Lmxlbmd0aCA9IHgsIEEgPT09IDApIHsKICAgICAgICAgICAgICAgIHQubW9kZSA9IEp0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEEgJiAzMikgewogICAgICAgICAgICAgICAgdC5iYWNrID0gLTEsIHQubW9kZSA9IEg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoQSAmIDY0KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5leHRyYSA9IEEgJiAxNSwgdC5tb2RlID0gR3Q7CiAgICAgICAgY2FzZSBHdDoKICAgICAgICAgICAgaWYgKHQuZXh0cmEpIHsKICAgICAgICAgICAgICAgIGZvcihwID0gdC5leHRyYTsgXyA8IHA7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHQubGVuZ3RoICs9IHIgJiAoMSA8PCB0LmV4dHJhKSAtIDEsIHIgPj4+PSB0LmV4dHJhLCBfIC09IHQuZXh0cmEsIHQuYmFjayArPSB0LmV4dHJhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQud2FzID0gdC5sZW5ndGgsIHQubW9kZSA9IGp0OwogICAgICAgIGNhc2UganQ6CiAgICAgICAgICAgIGZvcig7IHYgPSB0LmRpc3Rjb2RlW3IgJiAoMSA8PCB0LmRpc3RiaXRzKSAtIDFdLCB3ID0gdiA+Pj4gMjQsIEEgPSB2ID4+PiAxNiAmIDI1NSwgeCA9IHYgJiA2NTUzNSwgISh3IDw9IF8pOyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghKEEgJiAyNDApKSB7CiAgICAgICAgICAgICAgICBmb3IoZCA9IHcsIFMgPSBBLCBaID0geDsgdiA9IHQuZGlzdGNvZGVbWiArICgociAmICgxIDw8IGQgKyBTKSAtIDEpID4+IGQpXSwgdyA9IHYgPj4+IDI0LCBBID0gdiA+Pj4gMTYgJiAyNTUsIHggPSB2ICYgNjU1MzUsICEoZCArIHcgPD0gXyk7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHIgPj4+PSBkLCBfIC09IGQsIHQuYmFjayArPSBkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyID4+Pj0gdywgXyAtPSB3LCB0LmJhY2sgKz0gdywgQSAmIDY0KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIGNvZGUiLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5vZmZzZXQgPSB4LCB0LmV4dHJhID0gQSAmIDE1LCB0Lm1vZGUgPSBXdDsKICAgICAgICBjYXNlIFd0OgogICAgICAgICAgICBpZiAodC5leHRyYSkgewogICAgICAgICAgICAgICAgZm9yKHAgPSB0LmV4dHJhOyBfIDwgcDspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdC5vZmZzZXQgKz0gciAmICgxIDw8IHQuZXh0cmEpIC0gMSwgciA+Pj49IHQuZXh0cmEsIF8gLT0gdC5leHRyYSwgdC5iYWNrICs9IHQuZXh0cmE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQub2Zmc2V0ID4gdC5kbWF4KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsIHQubW9kZSA9IFQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0Lm1vZGUgPSBWdDsKICAgICAgICBjYXNlIFZ0OgogICAgICAgICAgICBpZiAoYyA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgaWYgKGggPSBzIC0gYywgdC5vZmZzZXQgPiBoKSB7CiAgICAgICAgICAgICAgICBpZiAoaCA9IHQub2Zmc2V0IC0gaCwgaCA+IHQud2hhdmUgJiYgdC5zYW5lKSB7CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCB0Lm1vZGUgPSBUOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaCA+IHQud25leHQgPyAoaCAtPSB0LnduZXh0LCB1ID0gdC53c2l6ZSAtIGgpIDogdSA9IHQud25leHQgLSBoLCBoID4gdC5sZW5ndGggJiYgKGggPSB0Lmxlbmd0aCksIG0gPSB0LndpbmRvdzsKICAgICAgICAgICAgfSBlbHNlIG0gPSBhLCB1ID0gbyAtIHQub2Zmc2V0LCBoID0gdC5sZW5ndGg7CiAgICAgICAgICAgIGggPiBjICYmIChoID0gYyksIGMgLT0gaCwgdC5sZW5ndGggLT0gaDsKICAgICAgICAgICAgZG8gYVtvKytdID0gbVt1KytdOwogICAgICAgICAgICB3aGlsZSAoLS1oKQogICAgICAgICAgICB0Lmxlbmd0aCA9PT0gMCAmJiAodC5tb2RlID0gVWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEp0OgogICAgICAgICAgICBpZiAoYyA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgYVtvKytdID0gdC5sZW5ndGgsIGMtLSwgdC5tb2RlID0gVWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgaXQ6CiAgICAgICAgICAgIGlmICh0LndyYXApIHsKICAgICAgICAgICAgICAgIGZvcig7IF8gPCAzMjspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciB8PSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHMgLT0gYywgZS50b3RhbF9vdXQgKz0gcywgdC50b3RhbCArPSBzLCBzICYmIChlLmFkbGVyID0gdC5jaGVjayA9IHQuZmxhZ3MgPyBJKHQuY2hlY2ssIGEsIHMsIG8gLSBzKSA6IHZlKHQuY2hlY2ssIGEsIHMsIG8gLSBzKSksIHMgPSBjLCAodC5mbGFncyA/IHIgOiBlaShyKSkgIT09IHQuY2hlY2spIHsKICAgICAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbmNvcnJlY3QgZGF0YSBjaGVjayIsIHQubW9kZSA9IFQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByID0gMCwgXyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5tb2RlID0gUXQ7CiAgICAgICAgY2FzZSBRdDoKICAgICAgICAgICAgaWYgKHQud3JhcCAmJiB0LmZsYWdzKSB7CiAgICAgICAgICAgICAgICBmb3IoOyBfIDwgMzI7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyICE9PSAodC50b3RhbCAmIDQyOTQ5NjcyOTUpKSB7CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW5jb3JyZWN0IGxlbmd0aCBjaGVjayIsIHQubW9kZSA9IFQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByID0gMCwgXyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5tb2RlID0gcXQ7CiAgICAgICAgY2FzZSBxdDoKICAgICAgICAgICAgeiA9IFVuOwogICAgICAgICAgICBicmVhayBlOwogICAgICAgIGNhc2UgVDoKICAgICAgICAgICAgeiA9IHppOwogICAgICAgICAgICBicmVhayBlOwogICAgICAgIGNhc2UgRGk6CiAgICAgICAgICAgIHJldHVybiBUaTsKICAgICAgICBjYXNlIEZuOgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBVOwogICAgfQogICAgcmV0dXJuIGUubmV4dF9vdXQgPSBvLCBlLmF2YWlsX291dCA9IGMsIGUubmV4dF9pbiA9IGwsIGUuYXZhaWxfaW4gPSBmLCB0LmhvbGQgPSByLCB0LmJpdHMgPSBfLCAodC53c2l6ZSB8fCBzICE9PSBlLmF2YWlsX291dCAmJiB0Lm1vZGUgPCBUICYmICh0Lm1vZGUgPCBpdCB8fCBpICE9PSBadCkpICYmIExpKGUsIGUub3V0cHV0LCBlLm5leHRfb3V0LCBzIC0gZS5hdmFpbF9vdXQpLCBFIC09IGUuYXZhaWxfaW4sIHMgLT0gZS5hdmFpbF9vdXQsIGUudG90YWxfaW4gKz0gRSwgZS50b3RhbF9vdXQgKz0gcywgdC50b3RhbCArPSBzLCB0LndyYXAgJiYgcyAmJiAoZS5hZGxlciA9IHQuY2hlY2sgPSB0LmZsYWdzID8gSSh0LmNoZWNrLCBhLCBzLCBlLm5leHRfb3V0IC0gcykgOiB2ZSh0LmNoZWNrLCBhLCBzLCBlLm5leHRfb3V0IC0gcykpLCBlLmRhdGFfdHlwZSA9IHQuYml0cyArICh0Lmxhc3QgPyA2NCA6IDApICsgKHQubW9kZSA9PT0gSCA/IDEyOCA6IDApICsgKHQubW9kZSA9PT0gTGUgfHwgdC5tb2RlID09PSB0dCA/IDI1NiA6IDApLCAoRSA9PT0gMCAmJiBzID09PSAwIHx8IGkgPT09IFp0KSAmJiB6ID09PSBhZSAmJiAoeiA9IENuKSwgejsKfSwgam4gPSAoZSk9PnsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSkgcmV0dXJuIFU7CiAgICBsZXQgaSA9IGUuc3RhdGU7CiAgICByZXR1cm4gaS53aW5kb3cgJiYgKGkud2luZG93ID0gbnVsbCksIGUuc3RhdGUgPSBudWxsLCBhZTsKfSwgV24gPSAoZSwgaSk9PnsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSkgcmV0dXJuIFU7CiAgICBsZXQgdCA9IGUuc3RhdGU7CiAgICByZXR1cm4gdC53cmFwICYgMiA/ICh0LmhlYWQgPSBpLCBpLmRvbmUgPSAhMSwgYWUpIDogVTsKfSwgVm4gPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gaS5sZW5ndGgsIG4sIGEsIGw7CiAgICByZXR1cm4gIWUgfHwgIWUuc3RhdGUgfHwgKG4gPSBlLnN0YXRlLCBuLndyYXAgIT09IDAgJiYgbi5tb2RlICE9PSBLZSkgPyBVIDogbi5tb2RlID09PSBLZSAmJiAoYSA9IDEsIGEgPSB2ZShhLCBpLCB0LCAwKSwgYSAhPT0gbi5jaGVjaykgPyB6aSA6IChsID0gTGkoZSwgaSwgdCwgdCksIGwgPyAobi5tb2RlID0gRGksIFRpKSA6IChuLmhhdmVkaWN0ID0gMSwgYWUpKTsKfSwgSm4gPSBJaSwgUW4gPSBPaSwgcW4gPSBaaSwgZWwgPSBYbiwgdGwgPSBOaSwgaWwgPSBHbiwgYWwgPSBqbiwgbmwgPSBXbiwgbGwgPSBWbiwgcmwgPSAicGFrbyBpbmZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSIsIEsgPSB7CiAgICBpbmZsYXRlUmVzZXQ6IEpuLAogICAgaW5mbGF0ZVJlc2V0MjogUW4sCiAgICBpbmZsYXRlUmVzZXRLZWVwOiBxbiwKICAgIGluZmxhdGVJbml0OiBlbCwKICAgIGluZmxhdGVJbml0MjogdGwsCiAgICBpbmZsYXRlOiBpbCwKICAgIGluZmxhdGVFbmQ6IGFsLAogICAgaW5mbGF0ZUdldEhlYWRlcjogbmwsCiAgICBpbmZsYXRlU2V0RGljdGlvbmFyeTogbGwsCiAgICBpbmZsYXRlSW5mbzogcmwKfTsKZnVuY3Rpb24gZmwoKSB7CiAgICB0aGlzLnRleHQgPSAwLCB0aGlzLnRpbWUgPSAwLCB0aGlzLnhmbGFncyA9IDAsIHRoaXMub3MgPSAwLCB0aGlzLmV4dHJhID0gbnVsbCwgdGhpcy5leHRyYV9sZW4gPSAwLCB0aGlzLm5hbWUgPSAiIiwgdGhpcy5jb21tZW50ID0gIiIsIHRoaXMuaGNyYyA9IDAsIHRoaXMuZG9uZSA9ICExOwp9CnZhciBvbCA9IGZsLCBVaSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsIHsgWl9OT19GTFVTSDogX2wgLCBaX0ZJTklTSDogaGwgLCBaX09LOiBTZSAsIFpfU1RSRUFNX0VORDogbHQgLCBaX05FRURfRElDVDogcnQgLCBaX1NUUkVBTV9FUlJPUjogZGwgLCBaX0RBVEFfRVJST1I6IGlpICwgWl9NRU1fRVJST1I6IHNsICB9ID0gbmU7CmZ1bmN0aW9uIFRlKGUpIHsKICAgIHRoaXMub3B0aW9ucyA9IFllLmFzc2lnbih7CiAgICAgICAgY2h1bmtTaXplOiAxMDI0ICogNjQsCiAgICAgICAgd2luZG93Qml0czogMTUsCiAgICAgICAgdG86ICIiCiAgICB9LCBlIHx8IHt9KTsKICAgIGxldCBpID0gdGhpcy5vcHRpb25zOwogICAgaS5yYXcgJiYgaS53aW5kb3dCaXRzID49IDAgJiYgaS53aW5kb3dCaXRzIDwgMTYgJiYgKGkud2luZG93Qml0cyA9IC1pLndpbmRvd0JpdHMsIGkud2luZG93Qml0cyA9PT0gMCAmJiAoaS53aW5kb3dCaXRzID0gLTE1KSksIGkud2luZG93Qml0cyA+PSAwICYmIGkud2luZG93Qml0cyA8IDE2ICYmICEoZSAmJiBlLndpbmRvd0JpdHMpICYmIChpLndpbmRvd0JpdHMgKz0gMzIpLCBpLndpbmRvd0JpdHMgPiAxNSAmJiBpLndpbmRvd0JpdHMgPCA0OCAmJiAoaS53aW5kb3dCaXRzICYgMTUgfHwgKGkud2luZG93Qml0cyB8PSAxNSkpLCB0aGlzLmVyciA9IDAsIHRoaXMubXNnID0gIiIsIHRoaXMuZW5kZWQgPSAhMSwgdGhpcy5jaHVua3MgPSBbXSwgdGhpcy5zdHJtID0gbmV3IHlpLCB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKICAgIGxldCB0ID0gSy5pbmZsYXRlSW5pdDIodGhpcy5zdHJtLCBpLndpbmRvd0JpdHMpOwogICAgaWYgKHQgIT09IFNlKSB0aHJvdyBuZXcgRXJyb3IoZWVbdF0pOwogICAgaWYgKHRoaXMuaGVhZGVyID0gbmV3IG9sLCBLLmluZmxhdGVHZXRIZWFkZXIodGhpcy5zdHJtLCB0aGlzLmhlYWRlciksIGkuZGljdGlvbmFyeSAmJiAodHlwZW9mIGkuZGljdGlvbmFyeSA9PSAic3RyaW5nIiA/IGkuZGljdGlvbmFyeSA9IHllLnN0cmluZzJidWYoaS5kaWN0aW9uYXJ5KSA6IFVpLmNhbGwoaS5kaWN0aW9uYXJ5KSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIiAmJiAoaS5kaWN0aW9uYXJ5ID0gbmV3IFVpbnQ4QXJyYXkoaS5kaWN0aW9uYXJ5KSksIGkucmF3ICYmICh0ID0gSy5pbmZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sIGkuZGljdGlvbmFyeSksIHQgIT09IFNlKSkpIHRocm93IG5ldyBFcnJvcihlZVt0XSk7Cn0KVGUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihlLCBpKSB7CiAgICBsZXQgdCA9IHRoaXMuc3RybSwgbiA9IHRoaXMub3B0aW9ucy5jaHVua1NpemUsIGEgPSB0aGlzLm9wdGlvbnMuZGljdGlvbmFyeSwgbCwgbywgZjsKICAgIGlmICh0aGlzLmVuZGVkKSByZXR1cm4gITE7CiAgICBmb3IoaSA9PT0gfn5pID8gbyA9IGkgOiBvID0gaSA9PT0gITAgPyBobCA6IF9sLCBVaS5jYWxsKGUpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID8gdC5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGUpIDogdC5pbnB1dCA9IGUsIHQubmV4dF9pbiA9IDAsIHQuYXZhaWxfaW4gPSB0LmlucHV0Lmxlbmd0aDs7KXsKICAgICAgICBmb3IodC5hdmFpbF9vdXQgPT09IDAgJiYgKHQub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobiksIHQubmV4dF9vdXQgPSAwLCB0LmF2YWlsX291dCA9IG4pLCBsID0gSy5pbmZsYXRlKHQsIG8pLCBsID09PSBydCAmJiBhICYmIChsID0gSy5pbmZsYXRlU2V0RGljdGlvbmFyeSh0LCBhKSwgbCA9PT0gU2UgPyBsID0gSy5pbmZsYXRlKHQsIG8pIDogbCA9PT0gaWkgJiYgKGwgPSBydCkpOyB0LmF2YWlsX2luID4gMCAmJiBsID09PSBsdCAmJiB0LnN0YXRlLndyYXAgPiAwICYmIGVbdC5uZXh0X2luXSAhPT0gMDspSy5pbmZsYXRlUmVzZXQodCksIGwgPSBLLmluZmxhdGUodCwgbyk7CiAgICAgICAgc3dpdGNoKGwpewogICAgICAgICAgICBjYXNlIGRsOgogICAgICAgICAgICBjYXNlIGlpOgogICAgICAgICAgICBjYXNlIHJ0OgogICAgICAgICAgICBjYXNlIHNsOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub25FbmQobCksIHRoaXMuZW5kZWQgPSAhMCwgITE7CiAgICAgICAgfQogICAgICAgIGlmIChmID0gdC5hdmFpbF9vdXQsIHQubmV4dF9vdXQgJiYgKHQuYXZhaWxfb3V0ID09PSAwIHx8IGwgPT09IGx0KSkgaWYgKHRoaXMub3B0aW9ucy50byA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgbGV0IGMgPSB5ZS51dGY4Ym9yZGVyKHQub3V0cHV0LCB0Lm5leHRfb3V0KSwgciA9IHQubmV4dF9vdXQgLSBjLCBfID0geWUuYnVmMnN0cmluZyh0Lm91dHB1dCwgYyk7CiAgICAgICAgICAgIHQubmV4dF9vdXQgPSByLCB0LmF2YWlsX291dCA9IG4gLSByLCByICYmIHQub3V0cHV0LnNldCh0Lm91dHB1dC5zdWJhcnJheShjLCBjICsgciksIDApLCB0aGlzLm9uRGF0YShfKTsKICAgICAgICB9IGVsc2UgdGhpcy5vbkRhdGEodC5vdXRwdXQubGVuZ3RoID09PSB0Lm5leHRfb3V0ID8gdC5vdXRwdXQgOiB0Lm91dHB1dC5zdWJhcnJheSgwLCB0Lm5leHRfb3V0KSk7CiAgICAgICAgaWYgKCEobCA9PT0gU2UgJiYgZiA9PT0gMCkpIHsKICAgICAgICAgICAgaWYgKGwgPT09IGx0KSByZXR1cm4gbCA9IEsuaW5mbGF0ZUVuZCh0aGlzLnN0cm0pLCB0aGlzLm9uRW5kKGwpLCB0aGlzLmVuZGVkID0gITAsICEwOwogICAgICAgICAgICBpZiAodC5hdmFpbF9pbiA9PT0gMCkgYnJlYWs7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuICEwOwp9OwpUZS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24oZSkgewogICAgdGhpcy5jaHVua3MucHVzaChlKTsKfTsKVGUucHJvdG90eXBlLm9uRW5kID0gZnVuY3Rpb24oZSkgewogICAgZSA9PT0gU2UgJiYgKHRoaXMub3B0aW9ucy50byA9PT0gInN0cmluZyIgPyB0aGlzLnJlc3VsdCA9IHRoaXMuY2h1bmtzLmpvaW4oIiIpIDogdGhpcy5yZXN1bHQgPSBZZS5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKSksIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuZXJyID0gZSwgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwp9OwpmdW5jdGlvbiB3dChlLCBpKSB7CiAgICBsZXQgdCA9IG5ldyBUZShpKTsKICAgIGlmICh0LnB1c2goZSksIHQuZXJyKSB0aHJvdyB0Lm1zZyB8fCBlZVt0LmVycl07CiAgICByZXR1cm4gdC5yZXN1bHQ7Cn0KZnVuY3Rpb24gY2woZSwgaSkgewogICAgcmV0dXJuIGkgPSBpIHx8IHt9LCBpLnJhdyA9ICEwLCB3dChlLCBpKTsKfQp2YXIgdWwgPSBUZSwgYmwgPSB3dCwgd2wgPSBjbCwgZ2wgPSB3dCwgcGwgPSBuZSwgeGwgPSB7CiAgICBJbmZsYXRlOiB1bCwKICAgIGluZmxhdGU6IGJsLAogICAgaW5mbGF0ZVJhdzogd2wsCiAgICB1bmd6aXA6IGdsLAogICAgY29uc3RhbnRzOiBwbAp9LCB7IERlZmxhdGU6IGtsICwgZGVmbGF0ZTogdmwgLCBkZWZsYXRlUmF3OiBFbCAsIGd6aXA6IHlsICB9ID0gUm4sIHsgSW5mbGF0ZTogU2wgLCBpbmZsYXRlOiBBbCAsIGluZmxhdGVSYXc6IFJsICwgdW5nemlwOiB6bCAgfSA9IHhsLCBtbCA9IHZsLCBPbCA9IEFsOwpjb25zdCBVcGRhdGVPYnNlcnZhYmxlID0gIjAiOwpjbGFzcyBSZXRhaW4gewogICAgY29uc3RydWN0b3IodmFsdWUpewogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KfQpjb25zdCBPbmpzQ2FsbGJhY2sgPSAiMSI7CmNvbnN0IEV2YWxKYXZhc2NyaXB0ID0gIjIiOwpjb25zdCBKYXZhc2NyaXB0RXJyb3IgPSAiMyI7CmNvbnN0IEphdmFzY3JpcHRXYXJuaW5nID0gIjQiOwpjb25zdCBSZWdpc3Rlck9ic2VydmFibGUgPSAiNSI7CmNvbnN0IEpTRG9uZUxvYWRpbmcgPSAiOCI7CmNvbnN0IEZ1c2VkTWVzc2FnZSA9ICI5IjsKY29uc3QgQ2xvc2VTZXNzaW9uID0gIjEwIjsKY29uc3QgUGluZ1BvbmcgPSAiMTEiOwpjb25zdCBVcGRhdGVTZXNzaW9uID0gIjEyIjsKY29uc3QgQ09OTkVDVElPTiA9IHsKICAgIHNlbmRfbWVzc2FnZTogdW5kZWZpbmVkLAogICAgcXVldWU6IFtdLAogICAgc3RhdHVzOiAiY2xvc2VkIgp9OwpmdW5jdGlvbiBvbl9jb25uZWN0aW9uX29wZW4oc2VuZF9tZXNzYWdlX2NhbGxiYWNrLCBjb21wcmVzc2lvbl9lbmFibGVkKSB7CiAgICBDT05ORUNUSU9OLnNlbmRfbWVzc2FnZSA9IHNlbmRfbWVzc2FnZV9jYWxsYmFjazsKICAgIENPTk5FQ1RJT04uc3RhdHVzID0gIm9wZW4iOwogICAgQ09OTkVDVElPTi5jb21wcmVzc2lvbl9lbmFibGVkID0gY29tcHJlc3Npb25fZW5hYmxlZDsKICAgIENPTk5FQ1RJT04ucXVldWUuZm9yRWFjaCgobWVzc2FnZSk9PnNlbmRfdG9fanVsaWEobWVzc2FnZSkpOwp9CmZ1bmN0aW9uIG9uX2Nvbm5lY3Rpb25fY2xvc2UoKSB7CiAgICBDT05ORUNUSU9OLnN0YXR1cyA9ICJjbG9zZWQiOwp9CmZ1bmN0aW9uIGNhbl9zZW5kX3RvX2p1bGlhKCkgewogICAgcmV0dXJuIENPTk5FQ1RJT04uc3RhdHVzID09PSAib3BlbiI7Cn0KY29uc3QgRVhURU5TSU9OX0NPREVDID0gbmV3IEV4dGVuc2lvbkNvZGVjKCk7CndpbmRvdy5FWFRFTlNJT05fQ09ERUMgPSBFWFRFTlNJT05fQ09ERUM7CmZ1bmN0aW9uIHVucGFjayh1aW50OGFycmF5KSB7CiAgICByZXR1cm4gZGVjb2RlKHVpbnQ4YXJyYXksIHsKICAgICAgICBleHRlbnNpb25Db2RlYzogRVhURU5TSU9OX0NPREVDCiAgICB9KTsKfQpmdW5jdGlvbiBwYWNrKG9iamVjdCkgewogICAgcmV0dXJuIGVuY29kZShvYmplY3QsIHsKICAgICAgICBleHRlbnNpb25Db2RlYzogRVhURU5TSU9OX0NPREVDCiAgICB9KTsKfQpmdW5jdGlvbiByZWludGVycHJldF9hcnJheShBcnJheVR5cGUsIHVpbnQ4YXJyYXkpIHsKICAgIGlmIChBcnJheVR5cGUgPT09IFVpbnQ4QXJyYXkpIHsKICAgICAgICByZXR1cm4gdWludDhhcnJheTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYm8gPSB1aW50OGFycmF5LmJ5dGVPZmZzZXQ7CiAgICAgICAgY29uc3QgYnBlID0gQXJyYXlUeXBlLkJZVEVTX1BFUl9FTEVNRU5UOwogICAgICAgIGNvbnN0IG5ld19hcnJheV9sZW5ndGggPSB1aW50OGFycmF5LmJ5dGVMZW5ndGggLyBicGU7CiAgICAgICAgY29uc3QgYnVmZmVyID0gdWludDhhcnJheS5idWZmZXIuc2xpY2UoYm8sIGJvICsgdWludDhhcnJheS5ieXRlTGVuZ3RoKTsKICAgICAgICByZXR1cm4gbmV3IEFycmF5VHlwZShidWZmZXIsIDAsIG5ld19hcnJheV9sZW5ndGgpOwogICAgfQp9CmZ1bmN0aW9uIHJlZ2lzdGVyX2V4dF9hcnJheSh0eXBlX3RhZywgYXJyYXlfdHlwZSkgewogICAgRVhURU5TSU9OX0NPREVDLnJlZ2lzdGVyKHsKICAgICAgICB0eXBlOiB0eXBlX3RhZywKICAgICAgICBkZWNvZGU6ICh1aW50OGFycmF5KT0+cmVpbnRlcnByZXRfYXJyYXkoYXJyYXlfdHlwZSwgdWludDhhcnJheSksCiAgICAgICAgZW5jb2RlOiAob2JqZWN0KT0+ewogICAgICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgYXJyYXlfdHlwZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KG9iamVjdC5idWZmZXIsIG9iamVjdC5ieXRlT2Zmc2V0LCBvYmplY3QuYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwp9CnJlZ2lzdGVyX2V4dF9hcnJheSgweDExLCBJbnQ4QXJyYXkpOwpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxMiwgVWludDhBcnJheSk7CnJlZ2lzdGVyX2V4dF9hcnJheSgweDEzLCBJbnQxNkFycmF5KTsKcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTQsIFVpbnQxNkFycmF5KTsKcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTUsIEludDMyQXJyYXkpOwpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxNiwgVWludDMyQXJyYXkpOwpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxNywgRmxvYXQzMkFycmF5KTsKcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTgsIEZsb2F0NjRBcnJheSk7CmZ1bmN0aW9uIHJlZ2lzdGVyX2V4dCh0eXBlX3RhZywgZGVjb2RlLCBlbmNvZGUpIHsKICAgIEVYVEVOU0lPTl9DT0RFQy5yZWdpc3Rlcih7CiAgICAgICAgdHlwZTogdHlwZV90YWcsCiAgICAgICAgZGVjb2RlLAogICAgICAgIGVuY29kZQogICAgfSk7Cn0KY2xhc3MgSkxBcnJheSB7CiAgICBjb25zdHJ1Y3RvcihzaXplLCBhcnJheSl7CiAgICAgICAgdGhpcy5zaXplID0gc2l6ZTsKICAgICAgICB0aGlzLmFycmF5ID0gYXJyYXk7CiAgICB9Cn0KcmVnaXN0ZXJfZXh0KDk5LCAodWludF84X2FycmF5KT0+ewogICAgY29uc3QgW3NpemUsIGFycmF5XSA9IHVucGFjayh1aW50XzhfYXJyYXkpOwogICAgcmV0dXJuIG5ldyBKTEFycmF5KHNpemUsIGFycmF5KTsKfSwgKG9iamVjdCk9PnsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBKTEFycmF5KSB7CiAgICAgICAgcmV0dXJuIHBhY2soWwogICAgICAgICAgICBvYmplY3Quc2l6ZSwKICAgICAgICAgICAgb2JqZWN0LmFycmF5CiAgICAgICAgXSk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQp9KTsKZnVuY3Rpb24gc2VuZF9lcnJvcihtZXNzYWdlLCBleGNlcHRpb24pIHsKICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7CiAgICBjb25zb2xlLmVycm9yKGV4Y2VwdGlvbik7CiAgICBzZW5kX3RvX2p1bGlhKHsKICAgICAgICBtc2dfdHlwZTogSmF2YXNjcmlwdEVycm9yLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgZXhjZXB0aW9uOiBTdHJpbmcoZXhjZXB0aW9uKSwKICAgICAgICBzdGFja3RyYWNlOiBleGNlcHRpb24gPT09IG51bGwgPyAiIiA6IGV4Y2VwdGlvbi5zdGFjawogICAgfSk7Cn0KY29uc3QgU0VTU0lPTlMgPSB7fTsKY29uc3QgR0xPQkFMX09CSkVDVF9DQUNIRSA9IHt9OwpmdW5jdGlvbiBzZW5kX3Bpbmdwb25nKCkgewogICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgbXNnX3R5cGU6IFBpbmdQb25nCiAgICB9KTsKfQpmdW5jdGlvbiBlbmNvZGVfYmluYXJ5KGRhdGEsIGNvbXByZXNzaW9uX2VuYWJsZWQpIHsKICAgIGlmIChjb21wcmVzc2lvbl9lbmFibGVkKSB7CiAgICAgICAgcmV0dXJuIHBhY2sobWwocGFjayhkYXRhKSkpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gcGFjayhkYXRhKTsKICAgIH0KfQpmdW5jdGlvbiBzZW5kX3RvX2p1bGlhKG1lc3NhZ2UpIHsKICAgIGNvbnN0IHsgc2VuZF9tZXNzYWdlICwgc3RhdHVzICwgY29tcHJlc3Npb25fZW5hYmxlZCAgfSA9IENPTk5FQ1RJT047CiAgICBpZiAoc2VuZF9tZXNzYWdlICYmIHN0YXR1cyA9PT0gIm9wZW4iKSB7CiAgICAgICAgc2VuZF9tZXNzYWdlKGVuY29kZV9iaW5hcnkobWVzc2FnZSwgY29tcHJlc3Npb25fZW5hYmxlZCkpOwogICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICJjbG9zZWQiKSB7CiAgICAgICAgQ09OTkVDVElPTi5xdWV1ZS5wdXNoKG1lc3NhZ2UpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygiVHJ5aW5nIHRvIHNlbmQgbWVzc2FnZXMgd2hpbGUgY29ubmVjdGlvbiBpcyBvZmZsaW5lIik7CiAgICB9Cn0KY2xhc3MgT2JzZXJ2YWJsZSB7CiAgICAjY2FsbGJhY2tzID0gW107CiAgICBjb25zdHJ1Y3RvcihpZCwgdmFsdWUpewogICAgICAgIHRoaXMuaWQgPSBpZDsKICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBub3RpZnkodmFsdWUsIGRvbnRfbm90aWZ5X2p1bGlhKSB7CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgdGhpcy4jY2FsbGJhY2tzLmZvckVhY2goKGNhbGxiYWNrKT0+ewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgZGVyZWdpc3RlciA9IGNhbGxiYWNrKHZhbHVlKTsKICAgICAgICAgICAgICAgIGlmIChkZXJlZ2lzdGVyID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4jY2FsbGJhY2tzLnNwbGljZSh0aGlzLiNjYWxsYmFja3MuaW5kZXhPZihjYWxsYmFjayksIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIHNlbmRfZXJyb3IoIkVycm9yIGR1cmluZyBydW5uaW5nIG9uanMgY2FsbGJhY2tcbiIgKyAiQ2FsbGJhY2s6XG4iICsgY2FsbGJhY2sudG9TdHJpbmcoKSwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmICghZG9udF9ub3RpZnlfanVsaWEpIHsKICAgICAgICAgICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgICAgICAgICBtc2dfdHlwZTogVXBkYXRlT2JzZXJ2YWJsZSwKICAgICAgICAgICAgICAgIGlkOiB0aGlzLmlkLAogICAgICAgICAgICAgICAgcGF5bG9hZDogdmFsdWUKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgb24oY2FsbGJhY2spIHsKICAgICAgICB0aGlzLiNjYWxsYmFja3MucHVzaChjYWxsYmFjayk7CiAgICB9Cn0KcmVnaXN0ZXJfZXh0KDEwMSwgKHVpbnRfOF9hcnJheSk9PnsKICAgIGNvbnN0IFtpZCwgdmFsdWVdID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoaWQsIHZhbHVlKTsKfSk7CnJlZ2lzdGVyX2V4dCgxMDIsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbaW50ZXJwb2xhdGVkX29iamVjdHMsIHNvdXJjZSwganVsaWFfZmlsZV0gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIGNvbnN0IGxvb2t1cF9pbnRlcnBvbGF0ZWQgPSAoaWQpPT5pbnRlcnBvbGF0ZWRfb2JqZWN0c1tpZF07CiAgICB0cnkgewogICAgICAgIGNvbnN0IGV2YWxfZnVuYyA9IG5ldyBGdW5jdGlvbigiX19sb29rdXBfaW50ZXJwb2xhdGVkIiwgIkJvbml0byIsIHNvdXJjZSk7CiAgICAgICAgcmV0dXJuICgpPT57CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbF9mdW5jKGxvb2t1cF9pbnRlcnBvbGF0ZWQsIHdpbmRvdy5Cb25pdG8pOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBlcnJvciBpbiBjbG9zdXJlIGZyb206ICR7anVsaWFfZmlsZX1gKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTb3VyY2U6YCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzb3VyY2UpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUubG9nKGBlcnJvciBpbiBjbG9zdXJlIGZyb206ICR7anVsaWFfZmlsZX1gKTsKICAgICAgICBjb25zb2xlLmxvZyhgU291cmNlOmApOwogICAgICAgIGNvbnNvbGUubG9nKHNvdXJjZSk7CiAgICAgICAgdGhyb3cgZXJyOwogICAgfQp9KTsKcmVnaXN0ZXJfZXh0KDEwMywgKHVpbnRfOF9hcnJheSk9PnsKICAgIGNvbnN0IHJlYWxfdmFsdWUgPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIHJldHVybiBuZXcgUmV0YWluKHJlYWxfdmFsdWUpOwp9KTsKZnVuY3Rpb24gc2VuZF93YXJuaW5nKG1lc3NhZ2UpIHsKICAgIGNvbnNvbGUud2FybihtZXNzYWdlKTsKICAgIHNlbmRfdG9fanVsaWEoewogICAgICAgIG1zZ190eXBlOiBKYXZhc2NyaXB0V2FybmluZywKICAgICAgICBtZXNzYWdlOiBtZXNzYWdlCiAgICB9KTsKfQpmdW5jdGlvbiBzZW5kX2RvbmVfbG9hZGluZyhzZXNzaW9uLCBleGNlcHRpb24pIHsKICAgIHNlbmRfdG9fanVsaWEoewogICAgICAgIG1zZ190eXBlOiBKU0RvbmVMb2FkaW5nLAogICAgICAgIHNlc3Npb24sCiAgICAgICAgbWVzc2FnZTogIiIsCiAgICAgICAgZXhjZXB0aW9uOiBleGNlcHRpb24gPT09IG51bGwgPyAibm90aGluZyIgOiBTdHJpbmcoZXhjZXB0aW9uKSwKICAgICAgICBzdGFja3RyYWNlOiBleGNlcHRpb24gPT09IG51bGwgPyAiIiA6IGV4Y2VwdGlvbi5zdGFjawogICAgfSk7Cn0KZnVuY3Rpb24gc2VuZF9jbG9zZV9zZXNzaW9uKHNlc3Npb24sIHN1YnNlc3Npb24pIHsKICAgIHNlbmRfdG9fanVsaWEoewogICAgICAgIG1zZ190eXBlOiBDbG9zZVNlc3Npb24sCiAgICAgICAgc2Vzc2lvbiwKICAgICAgICBzdWJzZXNzaW9uCiAgICB9KTsKfQpjbGFzcyBMb2NrIHsKICAgIGNvbnN0cnVjdG9yKCl7CiAgICAgICAgdGhpcy5sb2NrZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLnF1ZXVlID0gW107CiAgICAgICAgdGhpcy5sb2NraW5nX3Rhc2tzID0gbmV3IFNldCgpOwogICAgfQogICAgdW5sb2NrKCkgewogICAgICAgIHRoaXMubG9ja2VkID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMucXVldWUubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBqb2IgPSB0aGlzLnF1ZXVlLnBvcCgpOwogICAgICAgICAgICB0aGlzLmxvY2soam9iKTsKICAgICAgICB9CiAgICB9CiAgICB0YXNrX2xvY2sodGFza19pZCkgewogICAgICAgIHRoaXMubG9ja2VkID0gdHJ1ZTsKICAgICAgICB0aGlzLmxvY2tpbmdfdGFza3MuYWRkKHRhc2tfaWQpOwogICAgfQogICAgdGFza191bmxvY2sodGFza19pZCkgewogICAgICAgIHRoaXMubG9ja2luZ190YXNrcy5kZWxldGUodGFza19pZCk7CiAgICAgICAgaWYgKHRoaXMubG9ja2luZ190YXNrcy5zaXplID09IDApIHsKICAgICAgICAgICAgdGhpcy51bmxvY2soKTsKICAgICAgICB9CiAgICB9CiAgICBsb2NrKGZ1bmMpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpPT57CiAgICAgICAgICAgIGlmICh0aGlzLmxvY2tlZCkgewogICAgICAgICAgICAgICAgY29uc3QgZnVuY19yZXMgPSAoKT0+UHJvbWlzZS5yZXNvbHZlKGZ1bmMoKSkudGhlbihyZXNvbHZlKTsKICAgICAgICAgICAgICAgIHRoaXMucXVldWUucHVzaChmdW5jX3Jlcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvY2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoZnVuYygpKS50aGVuKCh4KT0+ewogICAgICAgICAgICAgICAgICAgIHRoaXMudW5sb2NrKCk7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0KZnVuY3Rpb24gcHJvY2Vzc19tZXNzYWdlKGRhdGEpIHsKICAgIHRyeSB7CiAgICAgICAgc3dpdGNoKGRhdGEubXNnX3R5cGUpewogICAgICAgICAgICBjYXNlIFVwZGF0ZU9ic2VydmFibGU6CiAgICAgICAgICAgICAgICBsb29rdXBfZ2xvYmFsX29iamVjdChkYXRhLmlkKS5ub3RpZnkoZGF0YS5wYXlsb2FkLCB0cnVlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIE9uanNDYWxsYmFjazoKICAgICAgICAgICAgICAgIGRhdGEub2JzLm9uKGRhdGEucGF5bG9hZCgpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEV2YWxKYXZhc2NyaXB0OgogICAgICAgICAgICAgICAgZGF0YS5wYXlsb2FkKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBGdXNlZE1lc3NhZ2U6CiAgICAgICAgICAgICAgICBkYXRhLnBheWxvYWQuZm9yRWFjaChwcm9jZXNzX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUGluZ1Bvbmc6CiAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnKCJwaW5nIik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBVcGRhdGVTZXNzaW9uOgogICAgICAgICAgICAgICAgdXBkYXRlX3Nlc3Npb25fZG9tKGRhdGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCBtZXNzYWdlIHR5cGU6ICIgKyBkYXRhLm1zZ190eXBlICsgIi4iKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgc2VuZF9lcnJvcihgRXJyb3Igd2hpbGUgcHJvY2Vzc2luZyBtZXNzYWdlICR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9YCwgZSk7CiAgICB9Cn0KY29uc3QgbW9kID0gewogICAgVXBkYXRlT2JzZXJ2YWJsZTogVXBkYXRlT2JzZXJ2YWJsZSwKICAgIE9uanNDYWxsYmFjazogT25qc0NhbGxiYWNrLAogICAgRXZhbEphdmFzY3JpcHQ6IEV2YWxKYXZhc2NyaXB0LAogICAgSmF2YXNjcmlwdEVycm9yOiBKYXZhc2NyaXB0RXJyb3IsCiAgICBKYXZhc2NyaXB0V2FybmluZzogSmF2YXNjcmlwdFdhcm5pbmcsCiAgICBSZWdpc3Rlck9ic2VydmFibGU6IFJlZ2lzdGVyT2JzZXJ2YWJsZSwKICAgIEpTRG9uZUxvYWRpbmc6IEpTRG9uZUxvYWRpbmcsCiAgICBGdXNlZE1lc3NhZ2U6IEZ1c2VkTWVzc2FnZSwKICAgIG9uX2Nvbm5lY3Rpb25fb3Blbjogb25fY29ubmVjdGlvbl9vcGVuLAogICAgb25fY29ubmVjdGlvbl9jbG9zZTogb25fY29ubmVjdGlvbl9jbG9zZSwKICAgIGNhbl9zZW5kX3RvX2p1bGlhOiBjYW5fc2VuZF90b19qdWxpYSwKICAgIHNlbmRfdG9fanVsaWE6IHNlbmRfdG9fanVsaWEsCiAgICBzZW5kX3Bpbmdwb25nOiBzZW5kX3Bpbmdwb25nLAogICAgc2VuZF9lcnJvcjogc2VuZF9lcnJvciwKICAgIHNlbmRfd2FybmluZzogc2VuZF93YXJuaW5nLAogICAgc2VuZF9kb25lX2xvYWRpbmc6IHNlbmRfZG9uZV9sb2FkaW5nLAogICAgc2VuZF9jbG9zZV9zZXNzaW9uOiBzZW5kX2Nsb3NlX3Nlc3Npb24sCiAgICBMb2NrOiBMb2NrLAogICAgcHJvY2Vzc19tZXNzYWdlOiBwcm9jZXNzX21lc3NhZ2UKfTsKY29uc3QgT0JKRUNUX0ZSRUVJTkdfTE9DSyA9IG5ldyBMb2NrKCk7CmZ1bmN0aW9uIGxvY2tfbG9hZGluZyhmKSB7CiAgICBPQkpFQ1RfRlJFRUlOR19MT0NLLmxvY2soZik7Cn0KZnVuY3Rpb24gbG9va3VwX2dsb2JhbF9vYmplY3Qoa2V5KSB7CiAgICBjb25zdCBvYmplY3QgPSBHTE9CQUxfT0JKRUNUX0NBQ0hFW2tleV07CiAgICBpZiAob2JqZWN0KSB7CiAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIFJldGFpbikgewogICAgICAgICAgICByZXR1cm4gb2JqZWN0LnZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBvYmplY3Q7CiAgICAgICAgfQogICAgfQogICAgdGhyb3cgbmV3IEVycm9yKGBLZXkgJHtrZXl9IG5vdCBmb3VuZCEgJHtvYmplY3R9YCk7Cn0KZnVuY3Rpb24gaXNfc3RpbGxfcmVmZXJlbmNlZChpZCkgewogICAgZm9yKGNvbnN0IHNlc3Npb25faWQgaW4gU0VTU0lPTlMpewogICAgICAgIGNvbnN0IFt0cmFja2VkX29iamVjdHMsIGFsbG93X2RlbGV0ZV0gPSBTRVNTSU9OU1tzZXNzaW9uX2lkXTsKICAgICAgICBpZiAoYWxsb3dfZGVsZXRlICYmIHRyYWNrZWRfb2JqZWN0cy5oYXMoaWQpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQpmdW5jdGlvbiBmcmVlX29iamVjdChpZCkgewogICAgY29uc3QgZGF0YSA9IEdMT0JBTF9PQkpFQ1RfQ0FDSEVbaWRdOwogICAgaWYgKGRhdGEpIHsKICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIFByb21pc2UpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIFJldGFpbikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICghaXNfc3RpbGxfcmVmZXJlbmNlZChpZCkpIHsKICAgICAgICAgICAgZGVsZXRlIEdMT0JBTF9PQkpFQ1RfQ0FDSEVbaWRdOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUud2FybihgVHJ5aW5nIHRvIGRlbGV0ZSBvYmplY3QgJHtpZH0sIHdoaWNoIGlzIG5vdCBpbiBnbG9iYWwgc2Vzc2lvbiBjYWNoZS5gKTsKICAgIH0KICAgIHJldHVybjsKfQpsZXQgREVMRVRFX09CU0VSVkVSID0gdW5kZWZpbmVkOwpmdW5jdGlvbiB0cmFja19kZWxldGVkX3Nlc3Npb25zKCkgewogICAgaWYgKCFERUxFVEVfT0JTRVJWRVIpIHsKICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgICBsZXQgcmVtb3ZhbF9vY2N1cmVkID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHRvX2RlbGV0ZSA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goKG11dGF0aW9uKT0+ewogICAgICAgICAgICAgICAgbXV0YXRpb24ucmVtb3ZlZE5vZGVzLmZvckVhY2goKHgpPT57CiAgICAgICAgICAgICAgICAgICAgaWYgKHguaWQgaW4gU0VTU0lPTlMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gU0VTU0lPTlNbeC5pZF1bMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICJkZWxldGUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b19kZWxldGUuYWRkKHguaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZhbF9vY2N1cmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChyZW1vdmFsX29jY3VyZWQpIHsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKFNFU1NJT05TKS5mb3JFYWNoKChpZCk9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBTRVNTSU9OU1tpZF1bMV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gImRlbGV0ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoYGFkZGluZyBzZXNzaW9uIHRvIGRlbGV0ZSBjYW5kaWRhdGVzOiAke2lkfWApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9fZGVsZXRlLmFkZChpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0b19kZWxldGUuZm9yRWFjaCgoaWQpPT57CiAgICAgICAgICAgICAgICBjbG9zZV9zZXNzaW9uKGlkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudCwgewogICAgICAgICAgICBhdHRyaWJ1dGVzOiBmYWxzZSwKICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLAogICAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiBmYWxzZSwKICAgICAgICAgICAgc3VidHJlZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIERFTEVURV9PQlNFUlZFUiA9IG9ic2VydmVyOwogICAgfQp9CmZ1bmN0aW9uIGRvbmVfaW5pdGlhbGl6aW5nX3Nlc3Npb24oc2Vzc2lvbl9pZCkgewogICAgaWYgKCEoc2Vzc2lvbl9pZCBpbiBTRVNTSU9OUykpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlNlc3Npb24gIik7CiAgICB9CiAgICBzZW5kX2RvbmVfbG9hZGluZyhzZXNzaW9uX2lkLCBudWxsKTsKICAgIGlmIChTRVNTSU9OU1tzZXNzaW9uX2lkXVsxXSAhPSAicm9vdCIpIHsKICAgICAgICBTRVNTSU9OU1tzZXNzaW9uX2lkXVsxXSA9ICJkZWxldGUiOwogICAgfQogICAgY29uc29sZS5sb2coYHNlc3Npb24gJHtzZXNzaW9uX2lkfSBmdWxseSBpbml0aWFsaXplZGApOwp9CnJlZ2lzdGVyX2V4dCgxMDQsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBrZXkgPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIHJldHVybiBsb29rdXBfZ2xvYmFsX29iamVjdChrZXkpOwp9KTsKZnVuY3Rpb24gY3JlYXRlX3RhZyh0YWcsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChhdHRyaWJ1dGVzLmp1bGlhc3Znbm9kZSkgewogICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgdGFnKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsKICAgIH0KfQpyZWdpc3Rlcl9leHQoMTA1LCAodWludF84X2FycmF5KT0+ewogICAgY29uc3QgW3RhZywgY2hpbGRyZW4sIGF0dHJpYnV0ZXNdID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICBjb25zdCBub2RlID0gY3JlYXRlX3RhZyh0YWcsIGF0dHJpYnV0ZXMpOwogICAgT2JqZWN0LmtleXMoYXR0cmlidXRlcykuZm9yRWFjaCgoa2V5KT0+ewogICAgICAgIGlmIChrZXkgPT0gImp1bGlhc3Znbm9kZSIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoa2V5ID09ICJjbGFzcyIpIHsKICAgICAgICAgICAgbm9kZS5jbGFzc05hbWUgPSBhdHRyaWJ1dGVzW2tleV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoa2V5LCBhdHRyaWJ1dGVzW2tleV0pOwogICAgICAgIH0KICAgIH0pOwogICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQpPT5ub2RlLmFwcGVuZChjaGlsZCkpOwogICAgcmV0dXJuIG5vZGU7Cn0pOwpyZWdpc3Rlcl9leHQoMTA4LCAodWludF84X2FycmF5KT0+ewogICAgY29uc3QgaHRtbCA9IHVucGFjayh1aW50XzhfYXJyYXkpOwogICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBkaXYuaW5uZXJIVE1MID0gaHRtbDsKICAgIHJldHVybiBkaXY7Cn0pOwpmdW5jdGlvbiBkZWNvZGVfYmluYXJ5KGJpbmFyeSwgY29tcHJlc3Npb25fZW5hYmxlZCkgewogICAgY29uc3Qgc2VyaWFsaXplZF9tZXNzYWdlID0gdW5wYWNrX2JpbmFyeShiaW5hcnksIGNvbXByZXNzaW9uX2VuYWJsZWQpOwogICAgY29uc3QgW3Nlc3Npb25faWQsIG1lc3NhZ2VfZGF0YV0gPSBzZXJpYWxpemVkX21lc3NhZ2U7CiAgICByZXR1cm4gbWVzc2FnZV9kYXRhOwp9CmZ1bmN0aW9uIGluaXRfc2Vzc2lvbihzZXNzaW9uX2lkLCBiaW5hcnlfbWVzc2FnZXMsIHNlc3Npb25fc3RhdHVzKSB7CiAgICB0cmFja19kZWxldGVkX3Nlc3Npb25zKCk7CiAgICBPQkpFQ1RfRlJFRUlOR19MT0NLLnRhc2tfbG9jayhzZXNzaW9uX2lkKTsKICAgIHRyeSB7CiAgICAgICAgU0VTU0lPTlNbc2Vzc2lvbl9pZF0gPSBbCiAgICAgICAgICAgIG5ldyBTZXQoKSwKICAgICAgICAgICAgc2Vzc2lvbl9zdGF0dXMKICAgICAgICBdOwogICAgICAgIGNvbnNvbGUubG9nKGBpbml0IHNlc3Npb246ICR7c2Vzc2lvbl9pZH0sICR7c2Vzc2lvbl9zdGF0dXN9YCk7CiAgICAgICAgaWYgKGJpbmFyeV9tZXNzYWdlcykgewogICAgICAgICAgICBwcm9jZXNzX21lc3NhZ2UoZGVjb2RlX2JpbmFyeShiaW5hcnlfbWVzc2FnZXMpKTsKICAgICAgICB9CiAgICAgICAgZG9uZV9pbml0aWFsaXppbmdfc2Vzc2lvbihzZXNzaW9uX2lkKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgc2VuZF9kb25lX2xvYWRpbmcoc2Vzc2lvbl9pZCwgZXJyb3IpOwogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3Iuc3RhY2spOwogICAgICAgIHRocm93IGVycm9yOwogICAgfSBmaW5hbGx5ewogICAgICAgIE9CSkVDVF9GUkVFSU5HX0xPQ0sudGFza191bmxvY2soc2Vzc2lvbl9pZCk7CiAgICB9Cn0KZnVuY3Rpb24gY2xvc2Vfc2Vzc2lvbihzZXNzaW9uX2lkKSB7CiAgICBjb25zdCBzZXNzaW9uID0gU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICBpZiAoIXNlc3Npb24pIHsKICAgICAgICBjb25zb2xlLndhcm4oImRvdWJsZSBmcmVlaW5nIHNlc3Npb24gZnJvbSBKUyEiKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBbc2Vzc2lvbl9vYmplY3RzLCBzdGF0dXNdID0gc2Vzc2lvbjsKICAgIGNvbnN0IHJvb3Rfbm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlc3Npb25faWQpOwogICAgaWYgKHJvb3Rfbm9kZSkgewogICAgICAgIHJvb3Rfbm9kZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIHJvb3Rfbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvb3Rfbm9kZSk7CiAgICB9CiAgICBpZiAoc3RhdHVzID09PSAiZGVsZXRlIikgewogICAgICAgIHNlbmRfY2xvc2Vfc2Vzc2lvbihzZXNzaW9uX2lkLCBzdGF0dXMpOwogICAgICAgIFNFU1NJT05TW3Nlc3Npb25faWRdID0gWwogICAgICAgICAgICBzZXNzaW9uX29iamVjdHMsCiAgICAgICAgICAgIGZhbHNlCiAgICAgICAgXTsKICAgIH0KICAgIHJldHVybjsKfQpmdW5jdGlvbiBmcmVlX3Nlc3Npb24oc2Vzc2lvbl9pZCkgewogICAgT0JKRUNUX0ZSRUVJTkdfTE9DSy5sb2NrKCgpPT57CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IFNFU1NJT05TW3Nlc3Npb25faWRdOwogICAgICAgIGlmICghc2Vzc2lvbikgewogICAgICAgICAgICBjb25zb2xlLndhcm4oImRvdWJsZSBmcmVlaW5nIHNlc3Npb24gZnJvbSBKdWxpYSEiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBbdHJhY2tlZF9vYmplY3RzLCBzdGF0dXNdID0gc2Vzc2lvbjsKICAgICAgICBkZWxldGUgU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICAgICAgdHJhY2tlZF9vYmplY3RzLmZvckVhY2goZnJlZV9vYmplY3QpOwogICAgICAgIHRyYWNrZWRfb2JqZWN0cy5jbGVhcigpOwogICAgfSk7Cn0KZnVuY3Rpb24gb25fbm9kZV9hdmFpbGFibGUobm9kZV9pZCwgdGltZW91dCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKT0+ewogICAgICAgIGZ1bmN0aW9uIHRlc3Rfbm9kZSh0aW1lb3V0KSB7CiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1qc2NhbGwtaWQ9JyR7bm9kZV9pZH0nXWApOwogICAgICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgICAgICAgcmVzb2x2ZShub2RlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld190aW1lb3V0ID0gMiAqIHRpbWVvdXQ7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdfdGltZW91dCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHRlc3Rfbm9kZSwgbmV3X3RpbWVvdXQsIG5ld190aW1lb3V0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0ZXN0X25vZGUodGltZW91dCk7CiAgICB9KTsKfQpmdW5jdGlvbiB1cGRhdGVfb3JfcmVwbGFjZShub2RlLCBuZXdfaHRtbCwgcmVwbGFjZSkgewogICAgaWYgKHJlcGxhY2UpIHsKICAgICAgICBub2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld19odG1sLCBub2RlKTsKICAgIH0gZWxzZSB7CiAgICAgICAgd2hpbGUobm9kZS5jaGlsZEVsZW1lbnRDb3VudCA+IDApewogICAgICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuZmlyc3RDaGlsZCk7CiAgICAgICAgfQogICAgICAgIG5vZGUuYXBwZW5kKG5ld19odG1sKTsKICAgIH0KfQpmdW5jdGlvbiB1cGRhdGVfc2Vzc2lvbl9kb20obWVzc2FnZSkgewogICAgY29uc3QgeyBzZXNzaW9uX2lkICwgbWVzc2FnZXMgLCBodG1sICwgZG9tX25vZGVfc2VsZWN0b3IgLCByZXBsYWNlICB9ID0gbWVzc2FnZTsKICAgIG9uX25vZGVfYXZhaWxhYmxlKGRvbV9ub2RlX3NlbGVjdG9yLCAxKS50aGVuKChkb20pPT57CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdXBkYXRlX29yX3JlcGxhY2UoZG9tLCBodG1sLCByZXBsYWNlKTsKICAgICAgICAgICAgcHJvY2Vzc19tZXNzYWdlKG1lc3NhZ2VzKTsKICAgICAgICAgICAgZG9uZV9pbml0aWFsaXppbmdfc2Vzc2lvbihzZXNzaW9uX2lkKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBzZW5kX2RvbmVfbG9hZGluZyhzZXNzaW9uX2lkLCBlcnJvcik7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3Iuc3RhY2spOwogICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIE9CSkVDVF9GUkVFSU5HX0xPQ0sudGFza191bmxvY2soc2Vzc2lvbl9pZCk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm47Cn0KZnVuY3Rpb24gdXBkYXRlX3Nlc3Npb25fY2FjaGUoc2Vzc2lvbl9pZCwgbmV3X2psX29iamVjdHMsIHNlc3Npb25fc3RhdHVzKSB7CiAgICBmdW5jdGlvbiB1cGRhdGVfY2FjaGUodHJhY2tlZF9vYmplY3RzKSB7CiAgICAgICAgZm9yKGNvbnN0IGtleSBpbiBuZXdfamxfb2JqZWN0cyl7CiAgICAgICAgICAgIHRyYWNrZWRfb2JqZWN0cy5hZGQoa2V5KTsKICAgICAgICAgICAgY29uc3QgbmV3X29iamVjdCA9IG5ld19qbF9vYmplY3RzW2tleV07CiAgICAgICAgICAgIGlmIChuZXdfb2JqZWN0ID09ICJ0cmFja2luZy1vbmx5IikgewogICAgICAgICAgICAgICAgaWYgKCEoa2V5IGluIEdMT0JBTF9PQkpFQ1RfQ0FDSEUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBLZXkgJHtrZXl9IG9ubHkgc2VuZCBmb3IgdHJhY2tpbmcsIGJ1dCBub3QgYWxyZWFkeSB0cmFja2VkISEhYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoa2V5IGluIEdMT0JBTF9PQkpFQ1RfQ0FDSEUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYCR7a2V5fSBpbiBzZXNzaW9uIGNhY2hlIGFuZCBzZW5kIGFnYWluISEgJHtuZXdfb2JqZWN0fWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgR0xPQkFMX09CSkVDVF9DQUNIRVtrZXldID0gbmV3X29iamVjdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNvbnN0IHNlc3Npb24gPSBTRVNTSU9OU1tzZXNzaW9uX2lkXTsKICAgIGlmIChzZXNzaW9uKSB7CiAgICAgICAgdXBkYXRlX2NhY2hlKHNlc3Npb25bMF0pOwogICAgfSBlbHNlIHsKICAgICAgICBPQkpFQ1RfRlJFRUlOR19MT0NLLnRhc2tfbG9jayhzZXNzaW9uX2lkKTsKICAgICAgICBjb25zdCB0cmFja2VkX2l0ZW1zID0gbmV3IFNldCgpOwogICAgICAgIFNFU1NJT05TW3Nlc3Npb25faWRdID0gWwogICAgICAgICAgICB0cmFja2VkX2l0ZW1zLAogICAgICAgICAgICBzZXNzaW9uX3N0YXR1cwogICAgICAgIF07CiAgICAgICAgdXBkYXRlX2NhY2hlKHRyYWNrZWRfaXRlbXMpOwogICAgfQp9CmNvbnN0IG1vZDEgPSB7CiAgICBTRVNTSU9OUzogU0VTU0lPTlMsCiAgICBHTE9CQUxfT0JKRUNUX0NBQ0hFOiBHTE9CQUxfT0JKRUNUX0NBQ0hFLAogICAgT0JKRUNUX0ZSRUVJTkdfTE9DSzogT0JKRUNUX0ZSRUVJTkdfTE9DSywKICAgIGxvY2tfbG9hZGluZzogbG9ja19sb2FkaW5nLAogICAgbG9va3VwX2dsb2JhbF9vYmplY3Q6IGxvb2t1cF9nbG9iYWxfb2JqZWN0LAogICAgZnJlZV9vYmplY3Q6IGZyZWVfb2JqZWN0LAogICAgdHJhY2tfZGVsZXRlZF9zZXNzaW9uczogdHJhY2tfZGVsZXRlZF9zZXNzaW9ucywKICAgIGRvbmVfaW5pdGlhbGl6aW5nX3Nlc3Npb246IGRvbmVfaW5pdGlhbGl6aW5nX3Nlc3Npb24sCiAgICBpbml0X3Nlc3Npb246IGluaXRfc2Vzc2lvbiwKICAgIGNsb3NlX3Nlc3Npb246IGNsb3NlX3Nlc3Npb24sCiAgICBmcmVlX3Nlc3Npb246IGZyZWVfc2Vzc2lvbiwKICAgIG9uX25vZGVfYXZhaWxhYmxlOiBvbl9ub2RlX2F2YWlsYWJsZSwKICAgIHVwZGF0ZV9vcl9yZXBsYWNlOiB1cGRhdGVfb3JfcmVwbGFjZSwKICAgIHVwZGF0ZV9zZXNzaW9uX2RvbTogdXBkYXRlX3Nlc3Npb25fZG9tLAogICAgdXBkYXRlX3Nlc3Npb25fY2FjaGU6IHVwZGF0ZV9zZXNzaW9uX2NhY2hlCn07CnJlZ2lzdGVyX2V4dCgxMDYsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbc2Vzc2lvbl9pZCwgb2JqZWN0cywgc2Vzc2lvbl9zdGF0dXNdID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICB1cGRhdGVfc2Vzc2lvbl9jYWNoZShzZXNzaW9uX2lkLCBvYmplY3RzLCBzZXNzaW9uX3N0YXR1cyk7CiAgICByZXR1cm4gc2Vzc2lvbl9pZDsKfSk7CnJlZ2lzdGVyX2V4dCgxMDcsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbc2Vzc2lvbl9pZCwgbWVzc2FnZV0gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIHJldHVybiBtZXNzYWdlOwp9KTsKZnVuY3Rpb24gYmFzZTY0ZW5jb2RlKGRhdGFfYXNfdWludDhhcnJheSkgewogICAgY29uc3QgYmFzZTY0X3Byb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PnsKICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBsZW4gPSAzNzsKICAgICAgICAgICAgY29uc3QgYmFzZTY0dXJsID0gcmVhZGVyLnJlc3VsdDsKICAgICAgICAgICAgcmVzb2x2ZShiYXNlNjR1cmwuc2xpY2UobGVuLCBiYXNlNjR1cmwubGVuZ3RoKSk7CiAgICAgICAgfTsKICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChuZXcgQmxvYihbCiAgICAgICAgICAgIGRhdGFfYXNfdWludDhhcnJheQogICAgICAgIF0pKTsKICAgIH0pOwogICAgcmV0dXJuIGJhc2U2NF9wcm9taXNlOwp9CmZ1bmN0aW9uIGJhc2U2NGRlY29kZShiYXNlNjRfc3RyKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpPT57CiAgICAgICAgZmV0Y2goImRhdGE6YXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO2Jhc2U2NCwiICsgYmFzZTY0X3N0cikudGhlbigocmVzcG9uc2UpPT57CiAgICAgICAgICAgIHJlc3BvbnNlLmFycmF5QnVmZmVyKCkudGhlbigoYXJyYXkpPT57CiAgICAgICAgICAgICAgICByZXNvbHZlKG5ldyBVaW50OEFycmF5KGFycmF5KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSk7Cn0KZnVuY3Rpb24gZGVjb2RlX2Jhc2U2NF9tZXNzYWdlKGJhc2U2NF9zdHJpbmcsIGNvbXByZXNzaW9uX2VuYWJsZWQpIHsKICAgIHJldHVybiBiYXNlNjRkZWNvZGUoYmFzZTY0X3N0cmluZykudGhlbigoeCk9PmRlY29kZV9iaW5hcnkoeCwgY29tcHJlc3Npb25fZW5hYmxlZCkpOwp9CmZ1bmN0aW9uIHVucGFja19iaW5hcnkoYmluYXJ5LCBjb21wcmVzc2lvbl9lbmFibGVkKSB7CiAgICBpZiAoY29tcHJlc3Npb25fZW5hYmxlZCkgewogICAgICAgIHJldHVybiB1bnBhY2soT2woYmluYXJ5KSk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB1bnBhY2soYmluYXJ5KTsKICAgIH0KfQpjb25zdCBtb2QyID0gewogICAgUmV0YWluOiBSZXRhaW4sCiAgICBiYXNlNjRlbmNvZGU6IGJhc2U2NGVuY29kZSwKICAgIGJhc2U2NGRlY29kZTogYmFzZTY0ZGVjb2RlLAogICAgZGVjb2RlX2Jhc2U2NF9tZXNzYWdlOiBkZWNvZGVfYmFzZTY0X21lc3NhZ2UsCiAgICBkZWNvZGVfYmluYXJ5OiBkZWNvZGVfYmluYXJ5LAogICAgdW5wYWNrX2JpbmFyeTogdW5wYWNrX2JpbmFyeSwKICAgIGVuY29kZV9iaW5hcnk6IGVuY29kZV9iaW5hcnkKfTsKZnVuY3Rpb24gb25hbnkob2JzZXJ2YWJsZXMsIGYpIHsKICAgIGNvbnN0IGNhbGxiYWNrID0gKHgpPT5mKG9ic2VydmFibGVzLm1hcCgoeCk9PngudmFsdWUpKTsKICAgIG9ic2VydmFibGVzLmZvckVhY2goKG9icyk9PnsKICAgICAgICBvYnMub24oY2FsbGJhY2spOwogICAgfSk7Cn0KY29uc3QgeyBzZW5kX2Vycm9yOiBzZW5kX2Vycm9yMSAsIHNlbmRfd2FybmluZzogc2VuZF93YXJuaW5nMSAsIHByb2Nlc3NfbWVzc2FnZTogcHJvY2Vzc19tZXNzYWdlMSAsIG9uX2Nvbm5lY3Rpb25fb3Blbjogb25fY29ubmVjdGlvbl9vcGVuMSAsIG9uX2Nvbm5lY3Rpb25fY2xvc2U6IG9uX2Nvbm5lY3Rpb25fY2xvc2UxICwgc2VuZF9jbG9zZV9zZXNzaW9uOiBzZW5kX2Nsb3NlX3Nlc3Npb24xICwgc2VuZF9waW5ncG9uZzogc2VuZF9waW5ncG9uZzEgLCBjYW5fc2VuZF90b19qdWxpYTogY2FuX3NlbmRfdG9fanVsaWExICwgc2VuZF90b19qdWxpYTogc2VuZF90b19qdWxpYTEgIH0gPSBtb2Q7CmNvbnN0IHsgYmFzZTY0ZGVjb2RlOiBiYXNlNjRkZWNvZGUxICwgYmFzZTY0ZW5jb2RlOiBiYXNlNjRlbmNvZGUxICwgZGVjb2RlX2JpbmFyeTogZGVjb2RlX2JpbmFyeTEgLCBlbmNvZGVfYmluYXJ5OiBlbmNvZGVfYmluYXJ5MSAsIGRlY29kZV9iYXNlNjRfbWVzc2FnZTogZGVjb2RlX2Jhc2U2NF9tZXNzYWdlMSAgfSA9IG1vZDI7CmNvbnN0IHsgaW5pdF9zZXNzaW9uOiBpbml0X3Nlc3Npb24xICwgZnJlZV9zZXNzaW9uOiBmcmVlX3Nlc3Npb24xICwgbG9va3VwX2dsb2JhbF9vYmplY3Q6IGxvb2t1cF9nbG9iYWxfb2JqZWN0MSAsIHVwZGF0ZV9vcl9yZXBsYWNlOiB1cGRhdGVfb3JfcmVwbGFjZTEgLCBsb2NrX2xvYWRpbmc6IGxvY2tfbG9hZGluZzEgLCBPQkpFQ1RfRlJFRUlOR19MT0NLOiBPQkpFQ1RfRlJFRUlOR19MT0NLMSAsIGZyZWVfb2JqZWN0OiBmcmVlX29iamVjdDEgIH0gPSBtb2QxOwpmdW5jdGlvbiB1cGRhdGVfbm9kZV9hdHRyaWJ1dGUobm9kZSwgYXR0cmlidXRlLCB2YWx1ZSkgewogICAgaWYgKG5vZGUpIHsKICAgICAgICBpZiAobm9kZVthdHRyaWJ1dGVdICE9IHZhbHVlKSB7CiAgICAgICAgICAgIG5vZGVbYXR0cmlidXRlXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmZ1bmN0aW9uIHVwZGF0ZV9kb21fbm9kZShkb20sIGh0bWwpIHsKICAgIGlmIChkb20pIHsKICAgICAgICBkb20uaW5uZXJIVE1MID0gaHRtbDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmZ1bmN0aW9uIGZldGNoX2JpbmFyeSh1cmwpIHsKICAgIHJldHVybiBmZXRjaCh1cmwpLnRoZW4oKHJlc3BvbnNlKT0+ewogICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJIVFRQIGVycm9yLCBzdGF0dXMgPSAiICsgcmVzcG9uc2Uuc3RhdHVzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7CiAgICB9KTsKfQpjb25zdCBCb25pdG8gPSB7CiAgICBQcm90b2NvbDogbW9kMiwKICAgIGJhc2U2NGRlY29kZTogYmFzZTY0ZGVjb2RlMSwKICAgIGJhc2U2NGVuY29kZTogYmFzZTY0ZW5jb2RlMSwKICAgIGRlY29kZV9iaW5hcnk6IGRlY29kZV9iaW5hcnkxLAogICAgZW5jb2RlX2JpbmFyeTogZW5jb2RlX2JpbmFyeTEsCiAgICBkZWNvZGVfYmFzZTY0X21lc3NhZ2U6IGRlY29kZV9iYXNlNjRfbWVzc2FnZTEsCiAgICBmZXRjaF9iaW5hcnksCiAgICBDb25uZWN0aW9uOiBtb2QsCiAgICBzZW5kX2Vycm9yOiBzZW5kX2Vycm9yMSwKICAgIHNlbmRfd2FybmluZzogc2VuZF93YXJuaW5nMSwKICAgIHByb2Nlc3NfbWVzc2FnZTogcHJvY2Vzc19tZXNzYWdlMSwKICAgIG9uX2Nvbm5lY3Rpb25fb3Blbjogb25fY29ubmVjdGlvbl9vcGVuMSwKICAgIG9uX2Nvbm5lY3Rpb25fY2xvc2U6IG9uX2Nvbm5lY3Rpb25fY2xvc2UxLAogICAgc2VuZF9jbG9zZV9zZXNzaW9uOiBzZW5kX2Nsb3NlX3Nlc3Npb24xLAogICAgc2VuZF9waW5ncG9uZzogc2VuZF9waW5ncG9uZzEsCiAgICBTZXNzaW9uczogbW9kMSwKICAgIGluaXRfc2Vzc2lvbjogaW5pdF9zZXNzaW9uMSwKICAgIGZyZWVfc2Vzc2lvbjogZnJlZV9zZXNzaW9uMSwKICAgIGxvY2tfbG9hZGluZzogbG9ja19sb2FkaW5nMSwKICAgIHVwZGF0ZV9ub2RlX2F0dHJpYnV0ZSwKICAgIHVwZGF0ZV9kb21fbm9kZSwKICAgIGxvb2t1cF9nbG9iYWxfb2JqZWN0OiBsb29rdXBfZ2xvYmFsX29iamVjdDEsCiAgICB1cGRhdGVfb3JfcmVwbGFjZTogdXBkYXRlX29yX3JlcGxhY2UxLAogICAgT0JKRUNUX0ZSRUVJTkdfTE9DSzogT0JKRUNUX0ZSRUVJTkdfTE9DSzEsCiAgICBjYW5fc2VuZF90b19qdWxpYTogY2FuX3NlbmRfdG9fanVsaWExLAogICAgb25hbnksCiAgICBmcmVlX29iamVjdDogZnJlZV9vYmplY3QxLAogICAgc2VuZF90b19qdWxpYTogc2VuZF90b19qdWxpYTEKfTsKd2luZG93LkJvbml0byA9IEJvbml0bzsKZXhwb3J0IHsgbW9kMiBhcyBQcm90b2NvbCwgYmFzZTY0ZGVjb2RlMSBhcyBiYXNlNjRkZWNvZGUsIGJhc2U2NGVuY29kZTEgYXMgYmFzZTY0ZW5jb2RlLCBkZWNvZGVfYmluYXJ5MSBhcyBkZWNvZGVfYmluYXJ5LCBlbmNvZGVfYmluYXJ5MSBhcyBlbmNvZGVfYmluYXJ5LCBkZWNvZGVfYmFzZTY0X21lc3NhZ2UxIGFzIGRlY29kZV9iYXNlNjRfbWVzc2FnZSwgbW9kIGFzIENvbm5lY3Rpb24sIHNlbmRfZXJyb3IxIGFzIHNlbmRfZXJyb3IsIHNlbmRfd2FybmluZzEgYXMgc2VuZF93YXJuaW5nLCBwcm9jZXNzX21lc3NhZ2UxIGFzIHByb2Nlc3NfbWVzc2FnZSwgb25fY29ubmVjdGlvbl9vcGVuMSBhcyBvbl9jb25uZWN0aW9uX29wZW4sIG9uX2Nvbm5lY3Rpb25fY2xvc2UxIGFzIG9uX2Nvbm5lY3Rpb25fY2xvc2UsIHNlbmRfY2xvc2Vfc2Vzc2lvbjEgYXMgc2VuZF9jbG9zZV9zZXNzaW9uLCBzZW5kX3Bpbmdwb25nMSBhcyBzZW5kX3Bpbmdwb25nLCBtb2QxIGFzIFNlc3Npb25zLCBpbml0X3Nlc3Npb24xIGFzIGluaXRfc2Vzc2lvbiwgZnJlZV9zZXNzaW9uMSBhcyBmcmVlX3Nlc3Npb24sIGxvY2tfbG9hZGluZzEgYXMgbG9ja19sb2FkaW5nLCB1cGRhdGVfbm9kZV9hdHRyaWJ1dGUgYXMgdXBkYXRlX25vZGVfYXR0cmlidXRlLCB1cGRhdGVfZG9tX25vZGUgYXMgdXBkYXRlX2RvbV9ub2RlLCBsb29rdXBfZ2xvYmFsX29iamVjdDEgYXMgbG9va3VwX2dsb2JhbF9vYmplY3QsIHVwZGF0ZV9vcl9yZXBsYWNlMSBhcyB1cGRhdGVfb3JfcmVwbGFjZSwgb25hbnkgYXMgb25hbnksIE9CSkVDVF9GUkVFSU5HX0xPQ0sxIGFzIE9CSkVDVF9GUkVFSU5HX0xPQ0ssIGNhbl9zZW5kX3RvX2p1bGlhMSBhcyBjYW5fc2VuZF90b19qdWxpYSwgZnJlZV9vYmplY3QxIGFzIGZyZWVfb2JqZWN0LCBzZW5kX3RvX2p1bGlhMSBhcyBzZW5kX3RvX2p1bGlhIH07Cgo=" type="module"></script>
      <style></style>
      <div></div>
    </div>
    <div>
      <script src="data:application/javascript;base64,Qm9uaXRvLmxvY2tfbG9hZGluZygoKSA9PiBCb25pdG8uaW5pdF9zZXNzaW9uKCc1OTNkY2VjNS0wMDhlLTQ5MjMtOTk5My0zMDc5NTM4NzEwN2QnLCBudWxsLCAncm9vdCcpKQ==" type="module"></script>
      <span></span>
    </div>
  </div>
  <div class="bonito-fragment" id="38458911-4be8-454d-ab33-e206df48fa15" data-jscall-id="subsession-application-dom">
    <div>
      <style></style>
      <div></div>
    </div>
    <div>
      <script src="data:application/javascript;base64,Qm9uaXRvLmxvY2tfbG9hZGluZygoKSA9PiBCb25pdG8uaW5pdF9zZXNzaW9uKCczODQ1ODkxMS00YmU4LTQ1NGQtYWIzMy1lMjA2ZGY0OGZhMTUnLCBudWxsLCAnc3ViJykp" type="module"></script>
      <span></span>
    </div>
  </div>
</div>    </body>
</html>

